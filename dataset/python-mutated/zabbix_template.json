[
    {
        "func_name": "__virtual__",
        "original": "def __virtual__():\n    \"\"\"\n    Only make these states available if Zabbix module and run_query function is available\n    and all 3rd party modules imported.\n    \"\"\"\n    if 'zabbix.run_query' in __salt__:\n        return True\n    return (False, 'Import zabbix or other needed modules failed.')",
        "mutated": [
            "def __virtual__():\n    if False:\n        i = 10\n    '\\n    Only make these states available if Zabbix module and run_query function is available\\n    and all 3rd party modules imported.\\n    '\n    if 'zabbix.run_query' in __salt__:\n        return True\n    return (False, 'Import zabbix or other needed modules failed.')",
            "def __virtual__():\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    '\\n    Only make these states available if Zabbix module and run_query function is available\\n    and all 3rd party modules imported.\\n    '\n    if 'zabbix.run_query' in __salt__:\n        return True\n    return (False, 'Import zabbix or other needed modules failed.')",
            "def __virtual__():\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    '\\n    Only make these states available if Zabbix module and run_query function is available\\n    and all 3rd party modules imported.\\n    '\n    if 'zabbix.run_query' in __salt__:\n        return True\n    return (False, 'Import zabbix or other needed modules failed.')",
            "def __virtual__():\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    '\\n    Only make these states available if Zabbix module and run_query function is available\\n    and all 3rd party modules imported.\\n    '\n    if 'zabbix.run_query' in __salt__:\n        return True\n    return (False, 'Import zabbix or other needed modules failed.')",
            "def __virtual__():\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    '\\n    Only make these states available if Zabbix module and run_query function is available\\n    and all 3rd party modules imported.\\n    '\n    if 'zabbix.run_query' in __salt__:\n        return True\n    return (False, 'Import zabbix or other needed modules failed.')"
        ]
    },
    {
        "func_name": "_diff_and_merge_host_list",
        "original": "def _diff_and_merge_host_list(defined, existing):\n    \"\"\"\n    If Zabbix template is to be updated then list of assigned hosts must be provided in all or nothing manner to prevent\n    some externally assigned hosts to be detached.\n\n    :param defined: list of hosts defined in sls\n    :param existing: list of hosts taken from live Zabbix\n    :return: list to be updated (combinated or empty list)\n    \"\"\"\n    try:\n        defined_host_ids = {host['hostid'] for host in defined}\n        existing_host_ids = {host['hostid'] for host in existing}\n    except KeyError:\n        raise SaltException('List of hosts in template not defined correctly.')\n    diff = defined_host_ids - existing_host_ids\n    return [{'hostid': str(hostid)} for hostid in diff | existing_host_ids] if diff else []",
        "mutated": [
            "def _diff_and_merge_host_list(defined, existing):\n    if False:\n        i = 10\n    '\\n    If Zabbix template is to be updated then list of assigned hosts must be provided in all or nothing manner to prevent\\n    some externally assigned hosts to be detached.\\n\\n    :param defined: list of hosts defined in sls\\n    :param existing: list of hosts taken from live Zabbix\\n    :return: list to be updated (combinated or empty list)\\n    '\n    try:\n        defined_host_ids = {host['hostid'] for host in defined}\n        existing_host_ids = {host['hostid'] for host in existing}\n    except KeyError:\n        raise SaltException('List of hosts in template not defined correctly.')\n    diff = defined_host_ids - existing_host_ids\n    return [{'hostid': str(hostid)} for hostid in diff | existing_host_ids] if diff else []",
            "def _diff_and_merge_host_list(defined, existing):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    '\\n    If Zabbix template is to be updated then list of assigned hosts must be provided in all or nothing manner to prevent\\n    some externally assigned hosts to be detached.\\n\\n    :param defined: list of hosts defined in sls\\n    :param existing: list of hosts taken from live Zabbix\\n    :return: list to be updated (combinated or empty list)\\n    '\n    try:\n        defined_host_ids = {host['hostid'] for host in defined}\n        existing_host_ids = {host['hostid'] for host in existing}\n    except KeyError:\n        raise SaltException('List of hosts in template not defined correctly.')\n    diff = defined_host_ids - existing_host_ids\n    return [{'hostid': str(hostid)} for hostid in diff | existing_host_ids] if diff else []",
            "def _diff_and_merge_host_list(defined, existing):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    '\\n    If Zabbix template is to be updated then list of assigned hosts must be provided in all or nothing manner to prevent\\n    some externally assigned hosts to be detached.\\n\\n    :param defined: list of hosts defined in sls\\n    :param existing: list of hosts taken from live Zabbix\\n    :return: list to be updated (combinated or empty list)\\n    '\n    try:\n        defined_host_ids = {host['hostid'] for host in defined}\n        existing_host_ids = {host['hostid'] for host in existing}\n    except KeyError:\n        raise SaltException('List of hosts in template not defined correctly.')\n    diff = defined_host_ids - existing_host_ids\n    return [{'hostid': str(hostid)} for hostid in diff | existing_host_ids] if diff else []",
            "def _diff_and_merge_host_list(defined, existing):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    '\\n    If Zabbix template is to be updated then list of assigned hosts must be provided in all or nothing manner to prevent\\n    some externally assigned hosts to be detached.\\n\\n    :param defined: list of hosts defined in sls\\n    :param existing: list of hosts taken from live Zabbix\\n    :return: list to be updated (combinated or empty list)\\n    '\n    try:\n        defined_host_ids = {host['hostid'] for host in defined}\n        existing_host_ids = {host['hostid'] for host in existing}\n    except KeyError:\n        raise SaltException('List of hosts in template not defined correctly.')\n    diff = defined_host_ids - existing_host_ids\n    return [{'hostid': str(hostid)} for hostid in diff | existing_host_ids] if diff else []",
            "def _diff_and_merge_host_list(defined, existing):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    '\\n    If Zabbix template is to be updated then list of assigned hosts must be provided in all or nothing manner to prevent\\n    some externally assigned hosts to be detached.\\n\\n    :param defined: list of hosts defined in sls\\n    :param existing: list of hosts taken from live Zabbix\\n    :return: list to be updated (combinated or empty list)\\n    '\n    try:\n        defined_host_ids = {host['hostid'] for host in defined}\n        existing_host_ids = {host['hostid'] for host in existing}\n    except KeyError:\n        raise SaltException('List of hosts in template not defined correctly.')\n    diff = defined_host_ids - existing_host_ids\n    return [{'hostid': str(hostid)} for hostid in diff | existing_host_ids] if diff else []"
        ]
    },
    {
        "func_name": "_get_existing_template_c_list",
        "original": "def _get_existing_template_c_list(component, parent_id, **kwargs):\n    \"\"\"\n    Make a list of given component type not inherited from other templates because Zabbix API returns only list of all\n    and list of inherited component items so we have to do a difference list.\n\n    :param component: Template component (application, item, etc...)\n    :param parent_id: ID of existing template the component is assigned to\n    :return List of non-inherited (own) components\n    \"\"\"\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    q_params = dict(c_def['output'])\n    q_params.update({c_def['qselectpid']: parent_id})\n    existing_clist_all = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    if c_def['inherited'] == 'inherited':\n        q_params.update({c_def['inherited']: 'true'})\n        existing_clist_inherited = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    else:\n        existing_clist_inherited = []\n    if existing_clist_inherited:\n        return [c_all for c_all in existing_clist_all if c_all not in existing_clist_inherited]\n    return existing_clist_all",
        "mutated": [
            "def _get_existing_template_c_list(component, parent_id, **kwargs):\n    if False:\n        i = 10\n    '\\n    Make a list of given component type not inherited from other templates because Zabbix API returns only list of all\\n    and list of inherited component items so we have to do a difference list.\\n\\n    :param component: Template component (application, item, etc...)\\n    :param parent_id: ID of existing template the component is assigned to\\n    :return List of non-inherited (own) components\\n    '\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    q_params = dict(c_def['output'])\n    q_params.update({c_def['qselectpid']: parent_id})\n    existing_clist_all = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    if c_def['inherited'] == 'inherited':\n        q_params.update({c_def['inherited']: 'true'})\n        existing_clist_inherited = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    else:\n        existing_clist_inherited = []\n    if existing_clist_inherited:\n        return [c_all for c_all in existing_clist_all if c_all not in existing_clist_inherited]\n    return existing_clist_all",
            "def _get_existing_template_c_list(component, parent_id, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    '\\n    Make a list of given component type not inherited from other templates because Zabbix API returns only list of all\\n    and list of inherited component items so we have to do a difference list.\\n\\n    :param component: Template component (application, item, etc...)\\n    :param parent_id: ID of existing template the component is assigned to\\n    :return List of non-inherited (own) components\\n    '\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    q_params = dict(c_def['output'])\n    q_params.update({c_def['qselectpid']: parent_id})\n    existing_clist_all = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    if c_def['inherited'] == 'inherited':\n        q_params.update({c_def['inherited']: 'true'})\n        existing_clist_inherited = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    else:\n        existing_clist_inherited = []\n    if existing_clist_inherited:\n        return [c_all for c_all in existing_clist_all if c_all not in existing_clist_inherited]\n    return existing_clist_all",
            "def _get_existing_template_c_list(component, parent_id, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    '\\n    Make a list of given component type not inherited from other templates because Zabbix API returns only list of all\\n    and list of inherited component items so we have to do a difference list.\\n\\n    :param component: Template component (application, item, etc...)\\n    :param parent_id: ID of existing template the component is assigned to\\n    :return List of non-inherited (own) components\\n    '\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    q_params = dict(c_def['output'])\n    q_params.update({c_def['qselectpid']: parent_id})\n    existing_clist_all = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    if c_def['inherited'] == 'inherited':\n        q_params.update({c_def['inherited']: 'true'})\n        existing_clist_inherited = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    else:\n        existing_clist_inherited = []\n    if existing_clist_inherited:\n        return [c_all for c_all in existing_clist_all if c_all not in existing_clist_inherited]\n    return existing_clist_all",
            "def _get_existing_template_c_list(component, parent_id, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    '\\n    Make a list of given component type not inherited from other templates because Zabbix API returns only list of all\\n    and list of inherited component items so we have to do a difference list.\\n\\n    :param component: Template component (application, item, etc...)\\n    :param parent_id: ID of existing template the component is assigned to\\n    :return List of non-inherited (own) components\\n    '\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    q_params = dict(c_def['output'])\n    q_params.update({c_def['qselectpid']: parent_id})\n    existing_clist_all = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    if c_def['inherited'] == 'inherited':\n        q_params.update({c_def['inherited']: 'true'})\n        existing_clist_inherited = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    else:\n        existing_clist_inherited = []\n    if existing_clist_inherited:\n        return [c_all for c_all in existing_clist_all if c_all not in existing_clist_inherited]\n    return existing_clist_all",
            "def _get_existing_template_c_list(component, parent_id, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    '\\n    Make a list of given component type not inherited from other templates because Zabbix API returns only list of all\\n    and list of inherited component items so we have to do a difference list.\\n\\n    :param component: Template component (application, item, etc...)\\n    :param parent_id: ID of existing template the component is assigned to\\n    :return List of non-inherited (own) components\\n    '\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    q_params = dict(c_def['output'])\n    q_params.update({c_def['qselectpid']: parent_id})\n    existing_clist_all = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    if c_def['inherited'] == 'inherited':\n        q_params.update({c_def['inherited']: 'true'})\n        existing_clist_inherited = __salt__['zabbix.run_query'](c_def['qtype'] + '.get', q_params, **kwargs)\n    else:\n        existing_clist_inherited = []\n    if existing_clist_inherited:\n        return [c_all for c_all in existing_clist_all if c_all not in existing_clist_inherited]\n    return existing_clist_all"
        ]
    },
    {
        "func_name": "_adjust_object_lists",
        "original": "def _adjust_object_lists(obj):\n    \"\"\"\n    For creation or update of object that have attribute which contains a list Zabbix awaits plain list of IDs while\n    querying Zabbix for same object returns list of dicts\n\n    :param obj: Zabbix object parameters\n    \"\"\"\n    for subcomp in TEMPLATE_COMPONENT_DEF:\n        if subcomp in obj and TEMPLATE_COMPONENT_DEF[subcomp]['adjust']:\n            obj[subcomp] = [item[TEMPLATE_COMPONENT_DEF[subcomp]['qidname']] for item in obj[subcomp]]",
        "mutated": [
            "def _adjust_object_lists(obj):\n    if False:\n        i = 10\n    '\\n    For creation or update of object that have attribute which contains a list Zabbix awaits plain list of IDs while\\n    querying Zabbix for same object returns list of dicts\\n\\n    :param obj: Zabbix object parameters\\n    '\n    for subcomp in TEMPLATE_COMPONENT_DEF:\n        if subcomp in obj and TEMPLATE_COMPONENT_DEF[subcomp]['adjust']:\n            obj[subcomp] = [item[TEMPLATE_COMPONENT_DEF[subcomp]['qidname']] for item in obj[subcomp]]",
            "def _adjust_object_lists(obj):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    '\\n    For creation or update of object that have attribute which contains a list Zabbix awaits plain list of IDs while\\n    querying Zabbix for same object returns list of dicts\\n\\n    :param obj: Zabbix object parameters\\n    '\n    for subcomp in TEMPLATE_COMPONENT_DEF:\n        if subcomp in obj and TEMPLATE_COMPONENT_DEF[subcomp]['adjust']:\n            obj[subcomp] = [item[TEMPLATE_COMPONENT_DEF[subcomp]['qidname']] for item in obj[subcomp]]",
            "def _adjust_object_lists(obj):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    '\\n    For creation or update of object that have attribute which contains a list Zabbix awaits plain list of IDs while\\n    querying Zabbix for same object returns list of dicts\\n\\n    :param obj: Zabbix object parameters\\n    '\n    for subcomp in TEMPLATE_COMPONENT_DEF:\n        if subcomp in obj and TEMPLATE_COMPONENT_DEF[subcomp]['adjust']:\n            obj[subcomp] = [item[TEMPLATE_COMPONENT_DEF[subcomp]['qidname']] for item in obj[subcomp]]",
            "def _adjust_object_lists(obj):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    '\\n    For creation or update of object that have attribute which contains a list Zabbix awaits plain list of IDs while\\n    querying Zabbix for same object returns list of dicts\\n\\n    :param obj: Zabbix object parameters\\n    '\n    for subcomp in TEMPLATE_COMPONENT_DEF:\n        if subcomp in obj and TEMPLATE_COMPONENT_DEF[subcomp]['adjust']:\n            obj[subcomp] = [item[TEMPLATE_COMPONENT_DEF[subcomp]['qidname']] for item in obj[subcomp]]",
            "def _adjust_object_lists(obj):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    '\\n    For creation or update of object that have attribute which contains a list Zabbix awaits plain list of IDs while\\n    querying Zabbix for same object returns list of dicts\\n\\n    :param obj: Zabbix object parameters\\n    '\n    for subcomp in TEMPLATE_COMPONENT_DEF:\n        if subcomp in obj and TEMPLATE_COMPONENT_DEF[subcomp]['adjust']:\n            obj[subcomp] = [item[TEMPLATE_COMPONENT_DEF[subcomp]['qidname']] for item in obj[subcomp]]"
        ]
    },
    {
        "func_name": "_manage_component",
        "original": "def _manage_component(component, parent_id, defined, existing, template_id=None, **kwargs):\n    \"\"\"\n    Takes particular component list, compares it with existing, call appropriate API methods - create, update, delete.\n\n    :param component: component name\n    :param parent_id: ID of parent entity under which component should be created\n    :param defined: list of defined items of named component\n    :param existing: list of existing items of named component\n    :param template_id: In case that component need also template ID for creation (although parent_id is given?!?!?)\n    \"\"\"\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    compare_key = c_def['filter']\n    defined_set = {item[compare_key] for item in defined}\n    existing_set = {item[compare_key] for item in existing}\n    create_set = defined_set - existing_set\n    update_set = defined_set & existing_set\n    delete_set = existing_set - defined_set\n    create_list = [item for item in defined if item[compare_key] in create_set]\n    for object_params in create_list:\n        if parent_id:\n            object_params.update({c_def['pid_ref_name']: parent_id})\n        if 'pid_ref_name2' in c_def:\n            object_params.update({c_def['pid_ref_name2']: template_id})\n        _adjust_object_lists(object_params)\n        if not dry_run:\n            object_create = __salt__['zabbix.run_query'](c_def['qtype'] + '.create', object_params, **kwargs)\n            if object_create:\n                object_ids = object_create[c_def['res_id_name']]\n                CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, c_def['filter']: object_params[c_def['filter']], 'object_id': object_ids})\n        else:\n            CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, 'object_id': 'CREATED ' + TEMPLATE_COMPONENT_DEF[component]['qtype'] + ' ID'})\n    delete_list = [item for item in existing if item[compare_key] in delete_set]\n    for object_del in delete_list:\n        object_id_name = zabbix_id_mapper[c_def['qtype']]\n        CHANGE_STACK.append({'component': component, 'action': 'delete', 'params': [object_del[object_id_name]]})\n        if not dry_run:\n            __salt__['zabbix.run_query'](c_def['qtype'] + '.delete', [object_del[object_id_name]], **kwargs)\n    for object_name in update_set:\n        ditem = next((item for item in defined if item[compare_key] == object_name), None)\n        eitem = next((item for item in existing if item[compare_key] == object_name), None)\n        diff_params = __salt__['zabbix.compare_params'](ditem, eitem, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            diff_params['old'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            _adjust_object_lists(diff_params['new'])\n            _adjust_object_lists(diff_params['old'])\n            CHANGE_STACK.append({'component': component, 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                __salt__['zabbix.run_query'](c_def['qtype'] + '.update', diff_params['new'], **kwargs)",
        "mutated": [
            "def _manage_component(component, parent_id, defined, existing, template_id=None, **kwargs):\n    if False:\n        i = 10\n    '\\n    Takes particular component list, compares it with existing, call appropriate API methods - create, update, delete.\\n\\n    :param component: component name\\n    :param parent_id: ID of parent entity under which component should be created\\n    :param defined: list of defined items of named component\\n    :param existing: list of existing items of named component\\n    :param template_id: In case that component need also template ID for creation (although parent_id is given?!?!?)\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    compare_key = c_def['filter']\n    defined_set = {item[compare_key] for item in defined}\n    existing_set = {item[compare_key] for item in existing}\n    create_set = defined_set - existing_set\n    update_set = defined_set & existing_set\n    delete_set = existing_set - defined_set\n    create_list = [item for item in defined if item[compare_key] in create_set]\n    for object_params in create_list:\n        if parent_id:\n            object_params.update({c_def['pid_ref_name']: parent_id})\n        if 'pid_ref_name2' in c_def:\n            object_params.update({c_def['pid_ref_name2']: template_id})\n        _adjust_object_lists(object_params)\n        if not dry_run:\n            object_create = __salt__['zabbix.run_query'](c_def['qtype'] + '.create', object_params, **kwargs)\n            if object_create:\n                object_ids = object_create[c_def['res_id_name']]\n                CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, c_def['filter']: object_params[c_def['filter']], 'object_id': object_ids})\n        else:\n            CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, 'object_id': 'CREATED ' + TEMPLATE_COMPONENT_DEF[component]['qtype'] + ' ID'})\n    delete_list = [item for item in existing if item[compare_key] in delete_set]\n    for object_del in delete_list:\n        object_id_name = zabbix_id_mapper[c_def['qtype']]\n        CHANGE_STACK.append({'component': component, 'action': 'delete', 'params': [object_del[object_id_name]]})\n        if not dry_run:\n            __salt__['zabbix.run_query'](c_def['qtype'] + '.delete', [object_del[object_id_name]], **kwargs)\n    for object_name in update_set:\n        ditem = next((item for item in defined if item[compare_key] == object_name), None)\n        eitem = next((item for item in existing if item[compare_key] == object_name), None)\n        diff_params = __salt__['zabbix.compare_params'](ditem, eitem, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            diff_params['old'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            _adjust_object_lists(diff_params['new'])\n            _adjust_object_lists(diff_params['old'])\n            CHANGE_STACK.append({'component': component, 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                __salt__['zabbix.run_query'](c_def['qtype'] + '.update', diff_params['new'], **kwargs)",
            "def _manage_component(component, parent_id, defined, existing, template_id=None, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    '\\n    Takes particular component list, compares it with existing, call appropriate API methods - create, update, delete.\\n\\n    :param component: component name\\n    :param parent_id: ID of parent entity under which component should be created\\n    :param defined: list of defined items of named component\\n    :param existing: list of existing items of named component\\n    :param template_id: In case that component need also template ID for creation (although parent_id is given?!?!?)\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    compare_key = c_def['filter']\n    defined_set = {item[compare_key] for item in defined}\n    existing_set = {item[compare_key] for item in existing}\n    create_set = defined_set - existing_set\n    update_set = defined_set & existing_set\n    delete_set = existing_set - defined_set\n    create_list = [item for item in defined if item[compare_key] in create_set]\n    for object_params in create_list:\n        if parent_id:\n            object_params.update({c_def['pid_ref_name']: parent_id})\n        if 'pid_ref_name2' in c_def:\n            object_params.update({c_def['pid_ref_name2']: template_id})\n        _adjust_object_lists(object_params)\n        if not dry_run:\n            object_create = __salt__['zabbix.run_query'](c_def['qtype'] + '.create', object_params, **kwargs)\n            if object_create:\n                object_ids = object_create[c_def['res_id_name']]\n                CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, c_def['filter']: object_params[c_def['filter']], 'object_id': object_ids})\n        else:\n            CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, 'object_id': 'CREATED ' + TEMPLATE_COMPONENT_DEF[component]['qtype'] + ' ID'})\n    delete_list = [item for item in existing if item[compare_key] in delete_set]\n    for object_del in delete_list:\n        object_id_name = zabbix_id_mapper[c_def['qtype']]\n        CHANGE_STACK.append({'component': component, 'action': 'delete', 'params': [object_del[object_id_name]]})\n        if not dry_run:\n            __salt__['zabbix.run_query'](c_def['qtype'] + '.delete', [object_del[object_id_name]], **kwargs)\n    for object_name in update_set:\n        ditem = next((item for item in defined if item[compare_key] == object_name), None)\n        eitem = next((item for item in existing if item[compare_key] == object_name), None)\n        diff_params = __salt__['zabbix.compare_params'](ditem, eitem, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            diff_params['old'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            _adjust_object_lists(diff_params['new'])\n            _adjust_object_lists(diff_params['old'])\n            CHANGE_STACK.append({'component': component, 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                __salt__['zabbix.run_query'](c_def['qtype'] + '.update', diff_params['new'], **kwargs)",
            "def _manage_component(component, parent_id, defined, existing, template_id=None, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    '\\n    Takes particular component list, compares it with existing, call appropriate API methods - create, update, delete.\\n\\n    :param component: component name\\n    :param parent_id: ID of parent entity under which component should be created\\n    :param defined: list of defined items of named component\\n    :param existing: list of existing items of named component\\n    :param template_id: In case that component need also template ID for creation (although parent_id is given?!?!?)\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    compare_key = c_def['filter']\n    defined_set = {item[compare_key] for item in defined}\n    existing_set = {item[compare_key] for item in existing}\n    create_set = defined_set - existing_set\n    update_set = defined_set & existing_set\n    delete_set = existing_set - defined_set\n    create_list = [item for item in defined if item[compare_key] in create_set]\n    for object_params in create_list:\n        if parent_id:\n            object_params.update({c_def['pid_ref_name']: parent_id})\n        if 'pid_ref_name2' in c_def:\n            object_params.update({c_def['pid_ref_name2']: template_id})\n        _adjust_object_lists(object_params)\n        if not dry_run:\n            object_create = __salt__['zabbix.run_query'](c_def['qtype'] + '.create', object_params, **kwargs)\n            if object_create:\n                object_ids = object_create[c_def['res_id_name']]\n                CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, c_def['filter']: object_params[c_def['filter']], 'object_id': object_ids})\n        else:\n            CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, 'object_id': 'CREATED ' + TEMPLATE_COMPONENT_DEF[component]['qtype'] + ' ID'})\n    delete_list = [item for item in existing if item[compare_key] in delete_set]\n    for object_del in delete_list:\n        object_id_name = zabbix_id_mapper[c_def['qtype']]\n        CHANGE_STACK.append({'component': component, 'action': 'delete', 'params': [object_del[object_id_name]]})\n        if not dry_run:\n            __salt__['zabbix.run_query'](c_def['qtype'] + '.delete', [object_del[object_id_name]], **kwargs)\n    for object_name in update_set:\n        ditem = next((item for item in defined if item[compare_key] == object_name), None)\n        eitem = next((item for item in existing if item[compare_key] == object_name), None)\n        diff_params = __salt__['zabbix.compare_params'](ditem, eitem, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            diff_params['old'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            _adjust_object_lists(diff_params['new'])\n            _adjust_object_lists(diff_params['old'])\n            CHANGE_STACK.append({'component': component, 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                __salt__['zabbix.run_query'](c_def['qtype'] + '.update', diff_params['new'], **kwargs)",
            "def _manage_component(component, parent_id, defined, existing, template_id=None, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    '\\n    Takes particular component list, compares it with existing, call appropriate API methods - create, update, delete.\\n\\n    :param component: component name\\n    :param parent_id: ID of parent entity under which component should be created\\n    :param defined: list of defined items of named component\\n    :param existing: list of existing items of named component\\n    :param template_id: In case that component need also template ID for creation (although parent_id is given?!?!?)\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    compare_key = c_def['filter']\n    defined_set = {item[compare_key] for item in defined}\n    existing_set = {item[compare_key] for item in existing}\n    create_set = defined_set - existing_set\n    update_set = defined_set & existing_set\n    delete_set = existing_set - defined_set\n    create_list = [item for item in defined if item[compare_key] in create_set]\n    for object_params in create_list:\n        if parent_id:\n            object_params.update({c_def['pid_ref_name']: parent_id})\n        if 'pid_ref_name2' in c_def:\n            object_params.update({c_def['pid_ref_name2']: template_id})\n        _adjust_object_lists(object_params)\n        if not dry_run:\n            object_create = __salt__['zabbix.run_query'](c_def['qtype'] + '.create', object_params, **kwargs)\n            if object_create:\n                object_ids = object_create[c_def['res_id_name']]\n                CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, c_def['filter']: object_params[c_def['filter']], 'object_id': object_ids})\n        else:\n            CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, 'object_id': 'CREATED ' + TEMPLATE_COMPONENT_DEF[component]['qtype'] + ' ID'})\n    delete_list = [item for item in existing if item[compare_key] in delete_set]\n    for object_del in delete_list:\n        object_id_name = zabbix_id_mapper[c_def['qtype']]\n        CHANGE_STACK.append({'component': component, 'action': 'delete', 'params': [object_del[object_id_name]]})\n        if not dry_run:\n            __salt__['zabbix.run_query'](c_def['qtype'] + '.delete', [object_del[object_id_name]], **kwargs)\n    for object_name in update_set:\n        ditem = next((item for item in defined if item[compare_key] == object_name), None)\n        eitem = next((item for item in existing if item[compare_key] == object_name), None)\n        diff_params = __salt__['zabbix.compare_params'](ditem, eitem, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            diff_params['old'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            _adjust_object_lists(diff_params['new'])\n            _adjust_object_lists(diff_params['old'])\n            CHANGE_STACK.append({'component': component, 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                __salt__['zabbix.run_query'](c_def['qtype'] + '.update', diff_params['new'], **kwargs)",
            "def _manage_component(component, parent_id, defined, existing, template_id=None, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    '\\n    Takes particular component list, compares it with existing, call appropriate API methods - create, update, delete.\\n\\n    :param component: component name\\n    :param parent_id: ID of parent entity under which component should be created\\n    :param defined: list of defined items of named component\\n    :param existing: list of existing items of named component\\n    :param template_id: In case that component need also template ID for creation (although parent_id is given?!?!?)\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    c_def = TEMPLATE_COMPONENT_DEF[component]\n    compare_key = c_def['filter']\n    defined_set = {item[compare_key] for item in defined}\n    existing_set = {item[compare_key] for item in existing}\n    create_set = defined_set - existing_set\n    update_set = defined_set & existing_set\n    delete_set = existing_set - defined_set\n    create_list = [item for item in defined if item[compare_key] in create_set]\n    for object_params in create_list:\n        if parent_id:\n            object_params.update({c_def['pid_ref_name']: parent_id})\n        if 'pid_ref_name2' in c_def:\n            object_params.update({c_def['pid_ref_name2']: template_id})\n        _adjust_object_lists(object_params)\n        if not dry_run:\n            object_create = __salt__['zabbix.run_query'](c_def['qtype'] + '.create', object_params, **kwargs)\n            if object_create:\n                object_ids = object_create[c_def['res_id_name']]\n                CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, c_def['filter']: object_params[c_def['filter']], 'object_id': object_ids})\n        else:\n            CHANGE_STACK.append({'component': component, 'action': 'create', 'params': object_params, 'object_id': 'CREATED ' + TEMPLATE_COMPONENT_DEF[component]['qtype'] + ' ID'})\n    delete_list = [item for item in existing if item[compare_key] in delete_set]\n    for object_del in delete_list:\n        object_id_name = zabbix_id_mapper[c_def['qtype']]\n        CHANGE_STACK.append({'component': component, 'action': 'delete', 'params': [object_del[object_id_name]]})\n        if not dry_run:\n            __salt__['zabbix.run_query'](c_def['qtype'] + '.delete', [object_del[object_id_name]], **kwargs)\n    for object_name in update_set:\n        ditem = next((item for item in defined if item[compare_key] == object_name), None)\n        eitem = next((item for item in existing if item[compare_key] == object_name), None)\n        diff_params = __salt__['zabbix.compare_params'](ditem, eitem, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            diff_params['old'][zabbix_id_mapper[c_def['qtype']]] = eitem[zabbix_id_mapper[c_def['qtype']]]\n            _adjust_object_lists(diff_params['new'])\n            _adjust_object_lists(diff_params['old'])\n            CHANGE_STACK.append({'component': component, 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                __salt__['zabbix.run_query'](c_def['qtype'] + '.update', diff_params['new'], **kwargs)"
        ]
    },
    {
        "func_name": "is_present",
        "original": "def is_present(name, **kwargs):\n    \"\"\"\n    Check if Zabbix Template already exists.\n\n    :param name: Zabbix Template name\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\n\n    .. code-block:: yaml\n\n        does_zabbix-template-exist:\n            zabbix_template.is_present:\n                - name: Template OS Linux\n    \"\"\"\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = False\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    else:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" exists.'\n    return ret",
        "mutated": [
            "def is_present(name, **kwargs):\n    if False:\n        i = 10\n    \"\\n    Check if Zabbix Template already exists.\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        does_zabbix-template-exist:\\n            zabbix_template.is_present:\\n                - name: Template OS Linux\\n    \"\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = False\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    else:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" exists.'\n    return ret",
            "def is_present(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    \"\\n    Check if Zabbix Template already exists.\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        does_zabbix-template-exist:\\n            zabbix_template.is_present:\\n                - name: Template OS Linux\\n    \"\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = False\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    else:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" exists.'\n    return ret",
            "def is_present(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    \"\\n    Check if Zabbix Template already exists.\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        does_zabbix-template-exist:\\n            zabbix_template.is_present:\\n                - name: Template OS Linux\\n    \"\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = False\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    else:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" exists.'\n    return ret",
            "def is_present(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    \"\\n    Check if Zabbix Template already exists.\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        does_zabbix-template-exist:\\n            zabbix_template.is_present:\\n                - name: Template OS Linux\\n    \"\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = False\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    else:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" exists.'\n    return ret",
            "def is_present(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    \"\\n    Check if Zabbix Template already exists.\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        does_zabbix-template-exist:\\n            zabbix_template.is_present:\\n                - name: Template OS Linux\\n    \"\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = False\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    else:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" exists.'\n    return ret"
        ]
    },
    {
        "func_name": "present",
        "original": "def present(name, params, static_host_list=True, **kwargs):\n    \"\"\"\n    Creates Zabbix Template object or if differs update it according defined parameters. See Zabbix API documentation.\n\n    Zabbix API version: >3.0\n\n    :param name: Zabbix Template name\n    :param params: Additional parameters according to Zabbix API documentation\n    :param static_host_list: If hosts assigned to the template are controlled\n        only by this state or can be also assigned externally\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\n\n    .. note::\n\n        If there is a need to get a value from current zabbix online (e.g. ids of host groups you want the template\n        to be associated with), put a dictionary with two keys \"query_object\" and \"query_name\" instead of the value.\n        In this example we want to create template named \"Testing Template\", assign it to hostgroup Templates,\n        link it to two ceph nodes and create a macro.\n\n    .. note::\n\n        IMPORTANT NOTE:\n        Objects (except for template name) are identified by name (or by other key in some exceptional cases)\n        so changing name of object means deleting old one and creating new one with new ID !!!\n\n    .. note::\n\n        NOT SUPPORTED FEATURES:\n            - linked templates\n            - trigger dependencies\n            - groups and group prototypes for host prototypes\n\n    SLS Example:\n\n    .. code-block:: yaml\n\n        zabbix-template-present:\n            zabbix_template.present:\n                - name: Testing Template\n                # Do not touch existing assigned hosts\n                # True will detach all other hosts than defined here\n                - static_host_list: False\n                - params:\n                    description: Template for Ceph nodes\n                    groups:\n                        # groups must already exist\n                        # template must be at least in one hostgroup\n                        - groupid:\n                            query_object: hostgroup\n                            query_name: Templates\n                    macros:\n                        - macro: \"{$CEPH_CLUSTER_NAME}\"\n                          value: ceph\n                    hosts:\n                        # hosts must already exist\n                        - hostid:\n                            query_object: host\n                            query_name: ceph-osd-01\n                        - hostid:\n                            query_object: host\n                            query_name: ceph-osd-02\n                    # templates:\n                    # Linked templates - not supported by state module but can be linked manually (will not be touched)\n\n                    applications:\n                        - name: Ceph OSD\n                    items:\n                        - name: Ceph OSD avg fill item\n                          key_: ceph.osd_avg_fill\n                          type: 2\n                          value_type: 0\n                          delay: 60\n                          units: '%'\n                          description: 'Average fill of OSD'\n                          applications:\n                              - applicationid:\n                                  query_object: application\n                                  query_name: Ceph OSD\n                    triggers:\n                        - description: \"Ceph OSD filled more that 90%\"\n                          expression: \"{{'{'}}Testing Template:ceph.osd_avg_fill.last(){{'}'}}>90\"\n                          priority: 4\n                    discoveries:\n                        - name: Mounted filesystem discovery\n                          key_: vfs.fs.discovery\n                          type: 0\n                          delay: 60\n                          itemprototypes:\n                              - name: Free disk space on {{'{#'}}FSNAME}\n                                key_: vfs.fs.size[{{'{#'}}FSNAME},free]\n                                type: 0\n                                value_type: 3\n                                delay: 60\n                                applications:\n                                    - applicationid:\n                                        query_object: application\n                                        query_name: Ceph OSD\n                          triggerprototypes:\n                              - description: \"Free disk space is less than 20% on volume {{'{#'}}FSNAME{{'}'}}\"\n                                expression: \"{{'{'}}Testing Template:vfs.fs.size[{{'{#'}}FSNAME},free].last(){{'}'}}<20\"\n                    graphs:\n                        - name: Ceph OSD avg fill graph\n                          width: 900\n                          height: 200\n                          graphtype: 0\n                          gitems:\n                              - color: F63100\n                                itemid:\n                                  query_object: item\n                                  query_name: Ceph OSD avg fill item\n                    screens:\n                        - name: Ceph\n                          hsize: 1\n                          vsize: 1\n                          screenitems:\n                              - x: 0\n                                y: 0\n                                resourcetype: 0\n                                resourceid:\n                                    query_object: graph\n                                    query_name: Ceph OSD avg fill graph\n    \"\"\"\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    params['host'] = name\n    del CHANGE_STACK[:]\n    template_definition = {}\n    template_components = {}\n    discovery_components = []\n    for attr in params:\n        if attr in TEMPLATE_COMPONENT_ORDER and str(attr) != 'discoveries':\n            template_components[attr] = params[attr]\n        elif str(attr) == 'discoveries':\n            d_rules = []\n            for d_rule in params[attr]:\n                d_rule_components = {'query_pid': {'component': attr, 'filter_val': d_rule[TEMPLATE_COMPONENT_DEF[attr]['filter']]}}\n                for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                    if proto_name in d_rule:\n                        d_rule_components[proto_name] = d_rule[proto_name]\n                        del d_rule[proto_name]\n                discovery_components.append(d_rule_components)\n                d_rules.append(d_rule)\n            template_components[attr] = d_rules\n        else:\n            template_definition[attr] = params[attr]\n    for attr in TEMPLATE_COMPONENT_ORDER:\n        if attr not in template_components:\n            template_components[attr] = []\n    for attr in TEMPLATE_RELATIONS:\n        template_definition[attr] = params[attr] if attr in params and params[attr] else []\n    defined_obj = __salt__['zabbix.substitute_params'](template_definition, **kwargs)\n    log.info('SUBSTITUTED template_definition: %s', str(json.dumps(defined_obj, indent=4)))\n    tmpl_get = __salt__['zabbix.run_query']('template.get', {'output': 'extend', 'selectGroups': 'groupid', 'selectHosts': 'hostid', 'selectTemplates': 'templateid', 'selectMacros': 'extend', 'filter': {'host': name}}, **kwargs)\n    log.info('TEMPLATE get result: %s', str(json.dumps(tmpl_get, indent=4)))\n    existing_obj = __salt__['zabbix.substitute_params'](tmpl_get[0], **kwargs) if tmpl_get and len(tmpl_get) == 1 else False\n    if existing_obj:\n        template_id = existing_obj[zabbix_id_mapper['template']]\n        if not static_host_list:\n            defined_wo_hosts = defined_obj\n            if 'hosts' in defined_obj:\n                defined_hosts = defined_obj['hosts']\n                del defined_wo_hosts['hosts']\n            else:\n                defined_hosts = []\n            existing_wo_hosts = existing_obj\n            if 'hosts' in existing_obj:\n                existing_hosts = existing_obj['hosts']\n                del existing_wo_hosts['hosts']\n            else:\n                existing_hosts = []\n            hosts_list = _diff_and_merge_host_list(defined_hosts, existing_hosts)\n            diff_params = __salt__['zabbix.compare_params'](defined_wo_hosts, existing_wo_hosts, True)\n            if 'new' in diff_params and 'hosts' in diff_params['new'] or hosts_list:\n                diff_params['new']['hosts'] = hosts_list\n        else:\n            diff_params = __salt__['zabbix.compare_params'](defined_obj, existing_obj, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper['template']] = template_id\n            diff_params['old'][zabbix_id_mapper['template']] = template_id\n            log.info('TEMPLATE: update params: %s', str(json.dumps(diff_params, indent=4)))\n            CHANGE_STACK.append({'component': 'template', 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                tmpl_update = __salt__['zabbix.run_query']('template.update', diff_params['new'], **kwargs)\n                log.info('TEMPLATE update result: %s', str(tmpl_update))\n    else:\n        CHANGE_STACK.append({'component': 'template', 'action': 'create', 'params': defined_obj})\n        if not dry_run:\n            tmpl_create = __salt__['zabbix.run_query']('template.create', defined_obj, **kwargs)\n            log.info('TEMPLATE create result: %s', str(tmpl_create))\n            if tmpl_create:\n                template_id = tmpl_create['templateids'][0]\n    log.info('\\n\\ntemplate_components: %s', json.dumps(template_components, indent=4))\n    log.info('\\n\\ndiscovery_components: %s', json.dumps(discovery_components, indent=4))\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if existing_obj or not dry_run:\n        for component in TEMPLATE_COMPONENT_ORDER:\n            log.info('\\n\\n\\n\\n\\nCOMPONENT: %s\\n\\n', str(json.dumps(component)))\n            existing_c_list = _get_existing_template_c_list(component, template_id, **kwargs)\n            existing_c_list_subs = __salt__['zabbix.substitute_params'](existing_c_list, **kwargs) if existing_c_list else []\n            if component in template_components:\n                defined_c_list_subs = __salt__['zabbix.substitute_params'](template_components[component], extend_params={TEMPLATE_COMPONENT_DEF[component]['qselectpid']: template_id}, filter_key=TEMPLATE_COMPONENT_DEF[component]['filter'], **kwargs)\n            else:\n                defined_c_list_subs = []\n            _manage_component(component, template_id, defined_c_list_subs, existing_c_list_subs, **kwargs)\n        log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n        for d_rule_component in discovery_components:\n            q_def = d_rule_component['query_pid']\n            c_def = TEMPLATE_COMPONENT_DEF[q_def['component']]\n            q_object = c_def['qtype']\n            q_params = dict(c_def['output'])\n            q_params.update({c_def['qselectpid']: template_id})\n            q_params.update({'filter': {c_def['filter']: q_def['filter_val']}})\n            parent_id = __salt__['zabbix.get_object_id_by_params'](q_object, q_params, **kwargs)\n            for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                log.info('\\n\\n\\n\\n\\nPROTOTYPE_NAME: %s\\n\\n', str(json.dumps(proto_name)))\n                existing_p_list = _get_existing_template_c_list(proto_name, parent_id, **kwargs)\n                existing_p_list_subs = __salt__['zabbix.substitute_params'](existing_p_list, **kwargs) if existing_p_list else []\n                if proto_name in d_rule_component:\n                    defined_p_list_subs = __salt__['zabbix.substitute_params'](d_rule_component[proto_name], extend_params={c_def['qselectpid']: template_id}, **kwargs)\n                else:\n                    defined_p_list_subs = []\n                _manage_component(proto_name, parent_id, defined_p_list_subs, existing_p_list_subs, template_id=template_id, **kwargs)\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if not CHANGE_STACK:\n        ret['result'] = True\n        ret['comment'] = 'Zabbix Template \"{}\" already exists and corresponds to a definition.'.format(name)\n    else:\n        tmpl_action = next((item for item in CHANGE_STACK if item['component'] == 'template' and item['action'] == 'create'), None)\n        if tmpl_action:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" does not exist.', 'new': 'Zabbix Template \"{}\" would be created according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" did not exist.', 'new': 'Zabbix Template \"{}\" created according definition.'.format(name)}}\n        else:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differs.', 'new': 'Zabbix Template \"{}\" would be updated according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differed.', 'new': 'Zabbix Template \"{}\" updated according definition.'.format(name)}}\n    return ret",
        "mutated": [
            "def present(name, params, static_host_list=True, **kwargs):\n    if False:\n        i = 10\n    '\\n    Creates Zabbix Template object or if differs update it according defined parameters. See Zabbix API documentation.\\n\\n    Zabbix API version: >3.0\\n\\n    :param name: Zabbix Template name\\n    :param params: Additional parameters according to Zabbix API documentation\\n    :param static_host_list: If hosts assigned to the template are controlled\\n        only by this state or can be also assigned externally\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module\\'s docstring)\\n\\n    .. note::\\n\\n        If there is a need to get a value from current zabbix online (e.g. ids of host groups you want the template\\n        to be associated with), put a dictionary with two keys \"query_object\" and \"query_name\" instead of the value.\\n        In this example we want to create template named \"Testing Template\", assign it to hostgroup Templates,\\n        link it to two ceph nodes and create a macro.\\n\\n    .. note::\\n\\n        IMPORTANT NOTE:\\n        Objects (except for template name) are identified by name (or by other key in some exceptional cases)\\n        so changing name of object means deleting old one and creating new one with new ID !!!\\n\\n    .. note::\\n\\n        NOT SUPPORTED FEATURES:\\n            - linked templates\\n            - trigger dependencies\\n            - groups and group prototypes for host prototypes\\n\\n    SLS Example:\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-present:\\n            zabbix_template.present:\\n                - name: Testing Template\\n                # Do not touch existing assigned hosts\\n                # True will detach all other hosts than defined here\\n                - static_host_list: False\\n                - params:\\n                    description: Template for Ceph nodes\\n                    groups:\\n                        # groups must already exist\\n                        # template must be at least in one hostgroup\\n                        - groupid:\\n                            query_object: hostgroup\\n                            query_name: Templates\\n                    macros:\\n                        - macro: \"{$CEPH_CLUSTER_NAME}\"\\n                          value: ceph\\n                    hosts:\\n                        # hosts must already exist\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-01\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-02\\n                    # templates:\\n                    # Linked templates - not supported by state module but can be linked manually (will not be touched)\\n\\n                    applications:\\n                        - name: Ceph OSD\\n                    items:\\n                        - name: Ceph OSD avg fill item\\n                          key_: ceph.osd_avg_fill\\n                          type: 2\\n                          value_type: 0\\n                          delay: 60\\n                          units: \\'%\\'\\n                          description: \\'Average fill of OSD\\'\\n                          applications:\\n                              - applicationid:\\n                                  query_object: application\\n                                  query_name: Ceph OSD\\n                    triggers:\\n                        - description: \"Ceph OSD filled more that 90%\"\\n                          expression: \"{{\\'{\\'}}Testing Template:ceph.osd_avg_fill.last(){{\\'}\\'}}>90\"\\n                          priority: 4\\n                    discoveries:\\n                        - name: Mounted filesystem discovery\\n                          key_: vfs.fs.discovery\\n                          type: 0\\n                          delay: 60\\n                          itemprototypes:\\n                              - name: Free disk space on {{\\'{#\\'}}FSNAME}\\n                                key_: vfs.fs.size[{{\\'{#\\'}}FSNAME},free]\\n                                type: 0\\n                                value_type: 3\\n                                delay: 60\\n                                applications:\\n                                    - applicationid:\\n                                        query_object: application\\n                                        query_name: Ceph OSD\\n                          triggerprototypes:\\n                              - description: \"Free disk space is less than 20% on volume {{\\'{#\\'}}FSNAME{{\\'}\\'}}\"\\n                                expression: \"{{\\'{\\'}}Testing Template:vfs.fs.size[{{\\'{#\\'}}FSNAME},free].last(){{\\'}\\'}}<20\"\\n                    graphs:\\n                        - name: Ceph OSD avg fill graph\\n                          width: 900\\n                          height: 200\\n                          graphtype: 0\\n                          gitems:\\n                              - color: F63100\\n                                itemid:\\n                                  query_object: item\\n                                  query_name: Ceph OSD avg fill item\\n                    screens:\\n                        - name: Ceph\\n                          hsize: 1\\n                          vsize: 1\\n                          screenitems:\\n                              - x: 0\\n                                y: 0\\n                                resourcetype: 0\\n                                resourceid:\\n                                    query_object: graph\\n                                    query_name: Ceph OSD avg fill graph\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    params['host'] = name\n    del CHANGE_STACK[:]\n    template_definition = {}\n    template_components = {}\n    discovery_components = []\n    for attr in params:\n        if attr in TEMPLATE_COMPONENT_ORDER and str(attr) != 'discoveries':\n            template_components[attr] = params[attr]\n        elif str(attr) == 'discoveries':\n            d_rules = []\n            for d_rule in params[attr]:\n                d_rule_components = {'query_pid': {'component': attr, 'filter_val': d_rule[TEMPLATE_COMPONENT_DEF[attr]['filter']]}}\n                for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                    if proto_name in d_rule:\n                        d_rule_components[proto_name] = d_rule[proto_name]\n                        del d_rule[proto_name]\n                discovery_components.append(d_rule_components)\n                d_rules.append(d_rule)\n            template_components[attr] = d_rules\n        else:\n            template_definition[attr] = params[attr]\n    for attr in TEMPLATE_COMPONENT_ORDER:\n        if attr not in template_components:\n            template_components[attr] = []\n    for attr in TEMPLATE_RELATIONS:\n        template_definition[attr] = params[attr] if attr in params and params[attr] else []\n    defined_obj = __salt__['zabbix.substitute_params'](template_definition, **kwargs)\n    log.info('SUBSTITUTED template_definition: %s', str(json.dumps(defined_obj, indent=4)))\n    tmpl_get = __salt__['zabbix.run_query']('template.get', {'output': 'extend', 'selectGroups': 'groupid', 'selectHosts': 'hostid', 'selectTemplates': 'templateid', 'selectMacros': 'extend', 'filter': {'host': name}}, **kwargs)\n    log.info('TEMPLATE get result: %s', str(json.dumps(tmpl_get, indent=4)))\n    existing_obj = __salt__['zabbix.substitute_params'](tmpl_get[0], **kwargs) if tmpl_get and len(tmpl_get) == 1 else False\n    if existing_obj:\n        template_id = existing_obj[zabbix_id_mapper['template']]\n        if not static_host_list:\n            defined_wo_hosts = defined_obj\n            if 'hosts' in defined_obj:\n                defined_hosts = defined_obj['hosts']\n                del defined_wo_hosts['hosts']\n            else:\n                defined_hosts = []\n            existing_wo_hosts = existing_obj\n            if 'hosts' in existing_obj:\n                existing_hosts = existing_obj['hosts']\n                del existing_wo_hosts['hosts']\n            else:\n                existing_hosts = []\n            hosts_list = _diff_and_merge_host_list(defined_hosts, existing_hosts)\n            diff_params = __salt__['zabbix.compare_params'](defined_wo_hosts, existing_wo_hosts, True)\n            if 'new' in diff_params and 'hosts' in diff_params['new'] or hosts_list:\n                diff_params['new']['hosts'] = hosts_list\n        else:\n            diff_params = __salt__['zabbix.compare_params'](defined_obj, existing_obj, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper['template']] = template_id\n            diff_params['old'][zabbix_id_mapper['template']] = template_id\n            log.info('TEMPLATE: update params: %s', str(json.dumps(diff_params, indent=4)))\n            CHANGE_STACK.append({'component': 'template', 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                tmpl_update = __salt__['zabbix.run_query']('template.update', diff_params['new'], **kwargs)\n                log.info('TEMPLATE update result: %s', str(tmpl_update))\n    else:\n        CHANGE_STACK.append({'component': 'template', 'action': 'create', 'params': defined_obj})\n        if not dry_run:\n            tmpl_create = __salt__['zabbix.run_query']('template.create', defined_obj, **kwargs)\n            log.info('TEMPLATE create result: %s', str(tmpl_create))\n            if tmpl_create:\n                template_id = tmpl_create['templateids'][0]\n    log.info('\\n\\ntemplate_components: %s', json.dumps(template_components, indent=4))\n    log.info('\\n\\ndiscovery_components: %s', json.dumps(discovery_components, indent=4))\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if existing_obj or not dry_run:\n        for component in TEMPLATE_COMPONENT_ORDER:\n            log.info('\\n\\n\\n\\n\\nCOMPONENT: %s\\n\\n', str(json.dumps(component)))\n            existing_c_list = _get_existing_template_c_list(component, template_id, **kwargs)\n            existing_c_list_subs = __salt__['zabbix.substitute_params'](existing_c_list, **kwargs) if existing_c_list else []\n            if component in template_components:\n                defined_c_list_subs = __salt__['zabbix.substitute_params'](template_components[component], extend_params={TEMPLATE_COMPONENT_DEF[component]['qselectpid']: template_id}, filter_key=TEMPLATE_COMPONENT_DEF[component]['filter'], **kwargs)\n            else:\n                defined_c_list_subs = []\n            _manage_component(component, template_id, defined_c_list_subs, existing_c_list_subs, **kwargs)\n        log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n        for d_rule_component in discovery_components:\n            q_def = d_rule_component['query_pid']\n            c_def = TEMPLATE_COMPONENT_DEF[q_def['component']]\n            q_object = c_def['qtype']\n            q_params = dict(c_def['output'])\n            q_params.update({c_def['qselectpid']: template_id})\n            q_params.update({'filter': {c_def['filter']: q_def['filter_val']}})\n            parent_id = __salt__['zabbix.get_object_id_by_params'](q_object, q_params, **kwargs)\n            for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                log.info('\\n\\n\\n\\n\\nPROTOTYPE_NAME: %s\\n\\n', str(json.dumps(proto_name)))\n                existing_p_list = _get_existing_template_c_list(proto_name, parent_id, **kwargs)\n                existing_p_list_subs = __salt__['zabbix.substitute_params'](existing_p_list, **kwargs) if existing_p_list else []\n                if proto_name in d_rule_component:\n                    defined_p_list_subs = __salt__['zabbix.substitute_params'](d_rule_component[proto_name], extend_params={c_def['qselectpid']: template_id}, **kwargs)\n                else:\n                    defined_p_list_subs = []\n                _manage_component(proto_name, parent_id, defined_p_list_subs, existing_p_list_subs, template_id=template_id, **kwargs)\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if not CHANGE_STACK:\n        ret['result'] = True\n        ret['comment'] = 'Zabbix Template \"{}\" already exists and corresponds to a definition.'.format(name)\n    else:\n        tmpl_action = next((item for item in CHANGE_STACK if item['component'] == 'template' and item['action'] == 'create'), None)\n        if tmpl_action:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" does not exist.', 'new': 'Zabbix Template \"{}\" would be created according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" did not exist.', 'new': 'Zabbix Template \"{}\" created according definition.'.format(name)}}\n        else:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differs.', 'new': 'Zabbix Template \"{}\" would be updated according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differed.', 'new': 'Zabbix Template \"{}\" updated according definition.'.format(name)}}\n    return ret",
            "def present(name, params, static_host_list=True, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    '\\n    Creates Zabbix Template object or if differs update it according defined parameters. See Zabbix API documentation.\\n\\n    Zabbix API version: >3.0\\n\\n    :param name: Zabbix Template name\\n    :param params: Additional parameters according to Zabbix API documentation\\n    :param static_host_list: If hosts assigned to the template are controlled\\n        only by this state or can be also assigned externally\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module\\'s docstring)\\n\\n    .. note::\\n\\n        If there is a need to get a value from current zabbix online (e.g. ids of host groups you want the template\\n        to be associated with), put a dictionary with two keys \"query_object\" and \"query_name\" instead of the value.\\n        In this example we want to create template named \"Testing Template\", assign it to hostgroup Templates,\\n        link it to two ceph nodes and create a macro.\\n\\n    .. note::\\n\\n        IMPORTANT NOTE:\\n        Objects (except for template name) are identified by name (or by other key in some exceptional cases)\\n        so changing name of object means deleting old one and creating new one with new ID !!!\\n\\n    .. note::\\n\\n        NOT SUPPORTED FEATURES:\\n            - linked templates\\n            - trigger dependencies\\n            - groups and group prototypes for host prototypes\\n\\n    SLS Example:\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-present:\\n            zabbix_template.present:\\n                - name: Testing Template\\n                # Do not touch existing assigned hosts\\n                # True will detach all other hosts than defined here\\n                - static_host_list: False\\n                - params:\\n                    description: Template for Ceph nodes\\n                    groups:\\n                        # groups must already exist\\n                        # template must be at least in one hostgroup\\n                        - groupid:\\n                            query_object: hostgroup\\n                            query_name: Templates\\n                    macros:\\n                        - macro: \"{$CEPH_CLUSTER_NAME}\"\\n                          value: ceph\\n                    hosts:\\n                        # hosts must already exist\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-01\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-02\\n                    # templates:\\n                    # Linked templates - not supported by state module but can be linked manually (will not be touched)\\n\\n                    applications:\\n                        - name: Ceph OSD\\n                    items:\\n                        - name: Ceph OSD avg fill item\\n                          key_: ceph.osd_avg_fill\\n                          type: 2\\n                          value_type: 0\\n                          delay: 60\\n                          units: \\'%\\'\\n                          description: \\'Average fill of OSD\\'\\n                          applications:\\n                              - applicationid:\\n                                  query_object: application\\n                                  query_name: Ceph OSD\\n                    triggers:\\n                        - description: \"Ceph OSD filled more that 90%\"\\n                          expression: \"{{\\'{\\'}}Testing Template:ceph.osd_avg_fill.last(){{\\'}\\'}}>90\"\\n                          priority: 4\\n                    discoveries:\\n                        - name: Mounted filesystem discovery\\n                          key_: vfs.fs.discovery\\n                          type: 0\\n                          delay: 60\\n                          itemprototypes:\\n                              - name: Free disk space on {{\\'{#\\'}}FSNAME}\\n                                key_: vfs.fs.size[{{\\'{#\\'}}FSNAME},free]\\n                                type: 0\\n                                value_type: 3\\n                                delay: 60\\n                                applications:\\n                                    - applicationid:\\n                                        query_object: application\\n                                        query_name: Ceph OSD\\n                          triggerprototypes:\\n                              - description: \"Free disk space is less than 20% on volume {{\\'{#\\'}}FSNAME{{\\'}\\'}}\"\\n                                expression: \"{{\\'{\\'}}Testing Template:vfs.fs.size[{{\\'{#\\'}}FSNAME},free].last(){{\\'}\\'}}<20\"\\n                    graphs:\\n                        - name: Ceph OSD avg fill graph\\n                          width: 900\\n                          height: 200\\n                          graphtype: 0\\n                          gitems:\\n                              - color: F63100\\n                                itemid:\\n                                  query_object: item\\n                                  query_name: Ceph OSD avg fill item\\n                    screens:\\n                        - name: Ceph\\n                          hsize: 1\\n                          vsize: 1\\n                          screenitems:\\n                              - x: 0\\n                                y: 0\\n                                resourcetype: 0\\n                                resourceid:\\n                                    query_object: graph\\n                                    query_name: Ceph OSD avg fill graph\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    params['host'] = name\n    del CHANGE_STACK[:]\n    template_definition = {}\n    template_components = {}\n    discovery_components = []\n    for attr in params:\n        if attr in TEMPLATE_COMPONENT_ORDER and str(attr) != 'discoveries':\n            template_components[attr] = params[attr]\n        elif str(attr) == 'discoveries':\n            d_rules = []\n            for d_rule in params[attr]:\n                d_rule_components = {'query_pid': {'component': attr, 'filter_val': d_rule[TEMPLATE_COMPONENT_DEF[attr]['filter']]}}\n                for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                    if proto_name in d_rule:\n                        d_rule_components[proto_name] = d_rule[proto_name]\n                        del d_rule[proto_name]\n                discovery_components.append(d_rule_components)\n                d_rules.append(d_rule)\n            template_components[attr] = d_rules\n        else:\n            template_definition[attr] = params[attr]\n    for attr in TEMPLATE_COMPONENT_ORDER:\n        if attr not in template_components:\n            template_components[attr] = []\n    for attr in TEMPLATE_RELATIONS:\n        template_definition[attr] = params[attr] if attr in params and params[attr] else []\n    defined_obj = __salt__['zabbix.substitute_params'](template_definition, **kwargs)\n    log.info('SUBSTITUTED template_definition: %s', str(json.dumps(defined_obj, indent=4)))\n    tmpl_get = __salt__['zabbix.run_query']('template.get', {'output': 'extend', 'selectGroups': 'groupid', 'selectHosts': 'hostid', 'selectTemplates': 'templateid', 'selectMacros': 'extend', 'filter': {'host': name}}, **kwargs)\n    log.info('TEMPLATE get result: %s', str(json.dumps(tmpl_get, indent=4)))\n    existing_obj = __salt__['zabbix.substitute_params'](tmpl_get[0], **kwargs) if tmpl_get and len(tmpl_get) == 1 else False\n    if existing_obj:\n        template_id = existing_obj[zabbix_id_mapper['template']]\n        if not static_host_list:\n            defined_wo_hosts = defined_obj\n            if 'hosts' in defined_obj:\n                defined_hosts = defined_obj['hosts']\n                del defined_wo_hosts['hosts']\n            else:\n                defined_hosts = []\n            existing_wo_hosts = existing_obj\n            if 'hosts' in existing_obj:\n                existing_hosts = existing_obj['hosts']\n                del existing_wo_hosts['hosts']\n            else:\n                existing_hosts = []\n            hosts_list = _diff_and_merge_host_list(defined_hosts, existing_hosts)\n            diff_params = __salt__['zabbix.compare_params'](defined_wo_hosts, existing_wo_hosts, True)\n            if 'new' in diff_params and 'hosts' in diff_params['new'] or hosts_list:\n                diff_params['new']['hosts'] = hosts_list\n        else:\n            diff_params = __salt__['zabbix.compare_params'](defined_obj, existing_obj, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper['template']] = template_id\n            diff_params['old'][zabbix_id_mapper['template']] = template_id\n            log.info('TEMPLATE: update params: %s', str(json.dumps(diff_params, indent=4)))\n            CHANGE_STACK.append({'component': 'template', 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                tmpl_update = __salt__['zabbix.run_query']('template.update', diff_params['new'], **kwargs)\n                log.info('TEMPLATE update result: %s', str(tmpl_update))\n    else:\n        CHANGE_STACK.append({'component': 'template', 'action': 'create', 'params': defined_obj})\n        if not dry_run:\n            tmpl_create = __salt__['zabbix.run_query']('template.create', defined_obj, **kwargs)\n            log.info('TEMPLATE create result: %s', str(tmpl_create))\n            if tmpl_create:\n                template_id = tmpl_create['templateids'][0]\n    log.info('\\n\\ntemplate_components: %s', json.dumps(template_components, indent=4))\n    log.info('\\n\\ndiscovery_components: %s', json.dumps(discovery_components, indent=4))\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if existing_obj or not dry_run:\n        for component in TEMPLATE_COMPONENT_ORDER:\n            log.info('\\n\\n\\n\\n\\nCOMPONENT: %s\\n\\n', str(json.dumps(component)))\n            existing_c_list = _get_existing_template_c_list(component, template_id, **kwargs)\n            existing_c_list_subs = __salt__['zabbix.substitute_params'](existing_c_list, **kwargs) if existing_c_list else []\n            if component in template_components:\n                defined_c_list_subs = __salt__['zabbix.substitute_params'](template_components[component], extend_params={TEMPLATE_COMPONENT_DEF[component]['qselectpid']: template_id}, filter_key=TEMPLATE_COMPONENT_DEF[component]['filter'], **kwargs)\n            else:\n                defined_c_list_subs = []\n            _manage_component(component, template_id, defined_c_list_subs, existing_c_list_subs, **kwargs)\n        log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n        for d_rule_component in discovery_components:\n            q_def = d_rule_component['query_pid']\n            c_def = TEMPLATE_COMPONENT_DEF[q_def['component']]\n            q_object = c_def['qtype']\n            q_params = dict(c_def['output'])\n            q_params.update({c_def['qselectpid']: template_id})\n            q_params.update({'filter': {c_def['filter']: q_def['filter_val']}})\n            parent_id = __salt__['zabbix.get_object_id_by_params'](q_object, q_params, **kwargs)\n            for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                log.info('\\n\\n\\n\\n\\nPROTOTYPE_NAME: %s\\n\\n', str(json.dumps(proto_name)))\n                existing_p_list = _get_existing_template_c_list(proto_name, parent_id, **kwargs)\n                existing_p_list_subs = __salt__['zabbix.substitute_params'](existing_p_list, **kwargs) if existing_p_list else []\n                if proto_name in d_rule_component:\n                    defined_p_list_subs = __salt__['zabbix.substitute_params'](d_rule_component[proto_name], extend_params={c_def['qselectpid']: template_id}, **kwargs)\n                else:\n                    defined_p_list_subs = []\n                _manage_component(proto_name, parent_id, defined_p_list_subs, existing_p_list_subs, template_id=template_id, **kwargs)\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if not CHANGE_STACK:\n        ret['result'] = True\n        ret['comment'] = 'Zabbix Template \"{}\" already exists and corresponds to a definition.'.format(name)\n    else:\n        tmpl_action = next((item for item in CHANGE_STACK if item['component'] == 'template' and item['action'] == 'create'), None)\n        if tmpl_action:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" does not exist.', 'new': 'Zabbix Template \"{}\" would be created according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" did not exist.', 'new': 'Zabbix Template \"{}\" created according definition.'.format(name)}}\n        else:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differs.', 'new': 'Zabbix Template \"{}\" would be updated according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differed.', 'new': 'Zabbix Template \"{}\" updated according definition.'.format(name)}}\n    return ret",
            "def present(name, params, static_host_list=True, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    '\\n    Creates Zabbix Template object or if differs update it according defined parameters. See Zabbix API documentation.\\n\\n    Zabbix API version: >3.0\\n\\n    :param name: Zabbix Template name\\n    :param params: Additional parameters according to Zabbix API documentation\\n    :param static_host_list: If hosts assigned to the template are controlled\\n        only by this state or can be also assigned externally\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module\\'s docstring)\\n\\n    .. note::\\n\\n        If there is a need to get a value from current zabbix online (e.g. ids of host groups you want the template\\n        to be associated with), put a dictionary with two keys \"query_object\" and \"query_name\" instead of the value.\\n        In this example we want to create template named \"Testing Template\", assign it to hostgroup Templates,\\n        link it to two ceph nodes and create a macro.\\n\\n    .. note::\\n\\n        IMPORTANT NOTE:\\n        Objects (except for template name) are identified by name (or by other key in some exceptional cases)\\n        so changing name of object means deleting old one and creating new one with new ID !!!\\n\\n    .. note::\\n\\n        NOT SUPPORTED FEATURES:\\n            - linked templates\\n            - trigger dependencies\\n            - groups and group prototypes for host prototypes\\n\\n    SLS Example:\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-present:\\n            zabbix_template.present:\\n                - name: Testing Template\\n                # Do not touch existing assigned hosts\\n                # True will detach all other hosts than defined here\\n                - static_host_list: False\\n                - params:\\n                    description: Template for Ceph nodes\\n                    groups:\\n                        # groups must already exist\\n                        # template must be at least in one hostgroup\\n                        - groupid:\\n                            query_object: hostgroup\\n                            query_name: Templates\\n                    macros:\\n                        - macro: \"{$CEPH_CLUSTER_NAME}\"\\n                          value: ceph\\n                    hosts:\\n                        # hosts must already exist\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-01\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-02\\n                    # templates:\\n                    # Linked templates - not supported by state module but can be linked manually (will not be touched)\\n\\n                    applications:\\n                        - name: Ceph OSD\\n                    items:\\n                        - name: Ceph OSD avg fill item\\n                          key_: ceph.osd_avg_fill\\n                          type: 2\\n                          value_type: 0\\n                          delay: 60\\n                          units: \\'%\\'\\n                          description: \\'Average fill of OSD\\'\\n                          applications:\\n                              - applicationid:\\n                                  query_object: application\\n                                  query_name: Ceph OSD\\n                    triggers:\\n                        - description: \"Ceph OSD filled more that 90%\"\\n                          expression: \"{{\\'{\\'}}Testing Template:ceph.osd_avg_fill.last(){{\\'}\\'}}>90\"\\n                          priority: 4\\n                    discoveries:\\n                        - name: Mounted filesystem discovery\\n                          key_: vfs.fs.discovery\\n                          type: 0\\n                          delay: 60\\n                          itemprototypes:\\n                              - name: Free disk space on {{\\'{#\\'}}FSNAME}\\n                                key_: vfs.fs.size[{{\\'{#\\'}}FSNAME},free]\\n                                type: 0\\n                                value_type: 3\\n                                delay: 60\\n                                applications:\\n                                    - applicationid:\\n                                        query_object: application\\n                                        query_name: Ceph OSD\\n                          triggerprototypes:\\n                              - description: \"Free disk space is less than 20% on volume {{\\'{#\\'}}FSNAME{{\\'}\\'}}\"\\n                                expression: \"{{\\'{\\'}}Testing Template:vfs.fs.size[{{\\'{#\\'}}FSNAME},free].last(){{\\'}\\'}}<20\"\\n                    graphs:\\n                        - name: Ceph OSD avg fill graph\\n                          width: 900\\n                          height: 200\\n                          graphtype: 0\\n                          gitems:\\n                              - color: F63100\\n                                itemid:\\n                                  query_object: item\\n                                  query_name: Ceph OSD avg fill item\\n                    screens:\\n                        - name: Ceph\\n                          hsize: 1\\n                          vsize: 1\\n                          screenitems:\\n                              - x: 0\\n                                y: 0\\n                                resourcetype: 0\\n                                resourceid:\\n                                    query_object: graph\\n                                    query_name: Ceph OSD avg fill graph\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    params['host'] = name\n    del CHANGE_STACK[:]\n    template_definition = {}\n    template_components = {}\n    discovery_components = []\n    for attr in params:\n        if attr in TEMPLATE_COMPONENT_ORDER and str(attr) != 'discoveries':\n            template_components[attr] = params[attr]\n        elif str(attr) == 'discoveries':\n            d_rules = []\n            for d_rule in params[attr]:\n                d_rule_components = {'query_pid': {'component': attr, 'filter_val': d_rule[TEMPLATE_COMPONENT_DEF[attr]['filter']]}}\n                for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                    if proto_name in d_rule:\n                        d_rule_components[proto_name] = d_rule[proto_name]\n                        del d_rule[proto_name]\n                discovery_components.append(d_rule_components)\n                d_rules.append(d_rule)\n            template_components[attr] = d_rules\n        else:\n            template_definition[attr] = params[attr]\n    for attr in TEMPLATE_COMPONENT_ORDER:\n        if attr not in template_components:\n            template_components[attr] = []\n    for attr in TEMPLATE_RELATIONS:\n        template_definition[attr] = params[attr] if attr in params and params[attr] else []\n    defined_obj = __salt__['zabbix.substitute_params'](template_definition, **kwargs)\n    log.info('SUBSTITUTED template_definition: %s', str(json.dumps(defined_obj, indent=4)))\n    tmpl_get = __salt__['zabbix.run_query']('template.get', {'output': 'extend', 'selectGroups': 'groupid', 'selectHosts': 'hostid', 'selectTemplates': 'templateid', 'selectMacros': 'extend', 'filter': {'host': name}}, **kwargs)\n    log.info('TEMPLATE get result: %s', str(json.dumps(tmpl_get, indent=4)))\n    existing_obj = __salt__['zabbix.substitute_params'](tmpl_get[0], **kwargs) if tmpl_get and len(tmpl_get) == 1 else False\n    if existing_obj:\n        template_id = existing_obj[zabbix_id_mapper['template']]\n        if not static_host_list:\n            defined_wo_hosts = defined_obj\n            if 'hosts' in defined_obj:\n                defined_hosts = defined_obj['hosts']\n                del defined_wo_hosts['hosts']\n            else:\n                defined_hosts = []\n            existing_wo_hosts = existing_obj\n            if 'hosts' in existing_obj:\n                existing_hosts = existing_obj['hosts']\n                del existing_wo_hosts['hosts']\n            else:\n                existing_hosts = []\n            hosts_list = _diff_and_merge_host_list(defined_hosts, existing_hosts)\n            diff_params = __salt__['zabbix.compare_params'](defined_wo_hosts, existing_wo_hosts, True)\n            if 'new' in diff_params and 'hosts' in diff_params['new'] or hosts_list:\n                diff_params['new']['hosts'] = hosts_list\n        else:\n            diff_params = __salt__['zabbix.compare_params'](defined_obj, existing_obj, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper['template']] = template_id\n            diff_params['old'][zabbix_id_mapper['template']] = template_id\n            log.info('TEMPLATE: update params: %s', str(json.dumps(diff_params, indent=4)))\n            CHANGE_STACK.append({'component': 'template', 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                tmpl_update = __salt__['zabbix.run_query']('template.update', diff_params['new'], **kwargs)\n                log.info('TEMPLATE update result: %s', str(tmpl_update))\n    else:\n        CHANGE_STACK.append({'component': 'template', 'action': 'create', 'params': defined_obj})\n        if not dry_run:\n            tmpl_create = __salt__['zabbix.run_query']('template.create', defined_obj, **kwargs)\n            log.info('TEMPLATE create result: %s', str(tmpl_create))\n            if tmpl_create:\n                template_id = tmpl_create['templateids'][0]\n    log.info('\\n\\ntemplate_components: %s', json.dumps(template_components, indent=4))\n    log.info('\\n\\ndiscovery_components: %s', json.dumps(discovery_components, indent=4))\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if existing_obj or not dry_run:\n        for component in TEMPLATE_COMPONENT_ORDER:\n            log.info('\\n\\n\\n\\n\\nCOMPONENT: %s\\n\\n', str(json.dumps(component)))\n            existing_c_list = _get_existing_template_c_list(component, template_id, **kwargs)\n            existing_c_list_subs = __salt__['zabbix.substitute_params'](existing_c_list, **kwargs) if existing_c_list else []\n            if component in template_components:\n                defined_c_list_subs = __salt__['zabbix.substitute_params'](template_components[component], extend_params={TEMPLATE_COMPONENT_DEF[component]['qselectpid']: template_id}, filter_key=TEMPLATE_COMPONENT_DEF[component]['filter'], **kwargs)\n            else:\n                defined_c_list_subs = []\n            _manage_component(component, template_id, defined_c_list_subs, existing_c_list_subs, **kwargs)\n        log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n        for d_rule_component in discovery_components:\n            q_def = d_rule_component['query_pid']\n            c_def = TEMPLATE_COMPONENT_DEF[q_def['component']]\n            q_object = c_def['qtype']\n            q_params = dict(c_def['output'])\n            q_params.update({c_def['qselectpid']: template_id})\n            q_params.update({'filter': {c_def['filter']: q_def['filter_val']}})\n            parent_id = __salt__['zabbix.get_object_id_by_params'](q_object, q_params, **kwargs)\n            for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                log.info('\\n\\n\\n\\n\\nPROTOTYPE_NAME: %s\\n\\n', str(json.dumps(proto_name)))\n                existing_p_list = _get_existing_template_c_list(proto_name, parent_id, **kwargs)\n                existing_p_list_subs = __salt__['zabbix.substitute_params'](existing_p_list, **kwargs) if existing_p_list else []\n                if proto_name in d_rule_component:\n                    defined_p_list_subs = __salt__['zabbix.substitute_params'](d_rule_component[proto_name], extend_params={c_def['qselectpid']: template_id}, **kwargs)\n                else:\n                    defined_p_list_subs = []\n                _manage_component(proto_name, parent_id, defined_p_list_subs, existing_p_list_subs, template_id=template_id, **kwargs)\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if not CHANGE_STACK:\n        ret['result'] = True\n        ret['comment'] = 'Zabbix Template \"{}\" already exists and corresponds to a definition.'.format(name)\n    else:\n        tmpl_action = next((item for item in CHANGE_STACK if item['component'] == 'template' and item['action'] == 'create'), None)\n        if tmpl_action:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" does not exist.', 'new': 'Zabbix Template \"{}\" would be created according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" did not exist.', 'new': 'Zabbix Template \"{}\" created according definition.'.format(name)}}\n        else:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differs.', 'new': 'Zabbix Template \"{}\" would be updated according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differed.', 'new': 'Zabbix Template \"{}\" updated according definition.'.format(name)}}\n    return ret",
            "def present(name, params, static_host_list=True, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    '\\n    Creates Zabbix Template object or if differs update it according defined parameters. See Zabbix API documentation.\\n\\n    Zabbix API version: >3.0\\n\\n    :param name: Zabbix Template name\\n    :param params: Additional parameters according to Zabbix API documentation\\n    :param static_host_list: If hosts assigned to the template are controlled\\n        only by this state or can be also assigned externally\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module\\'s docstring)\\n\\n    .. note::\\n\\n        If there is a need to get a value from current zabbix online (e.g. ids of host groups you want the template\\n        to be associated with), put a dictionary with two keys \"query_object\" and \"query_name\" instead of the value.\\n        In this example we want to create template named \"Testing Template\", assign it to hostgroup Templates,\\n        link it to two ceph nodes and create a macro.\\n\\n    .. note::\\n\\n        IMPORTANT NOTE:\\n        Objects (except for template name) are identified by name (or by other key in some exceptional cases)\\n        so changing name of object means deleting old one and creating new one with new ID !!!\\n\\n    .. note::\\n\\n        NOT SUPPORTED FEATURES:\\n            - linked templates\\n            - trigger dependencies\\n            - groups and group prototypes for host prototypes\\n\\n    SLS Example:\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-present:\\n            zabbix_template.present:\\n                - name: Testing Template\\n                # Do not touch existing assigned hosts\\n                # True will detach all other hosts than defined here\\n                - static_host_list: False\\n                - params:\\n                    description: Template for Ceph nodes\\n                    groups:\\n                        # groups must already exist\\n                        # template must be at least in one hostgroup\\n                        - groupid:\\n                            query_object: hostgroup\\n                            query_name: Templates\\n                    macros:\\n                        - macro: \"{$CEPH_CLUSTER_NAME}\"\\n                          value: ceph\\n                    hosts:\\n                        # hosts must already exist\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-01\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-02\\n                    # templates:\\n                    # Linked templates - not supported by state module but can be linked manually (will not be touched)\\n\\n                    applications:\\n                        - name: Ceph OSD\\n                    items:\\n                        - name: Ceph OSD avg fill item\\n                          key_: ceph.osd_avg_fill\\n                          type: 2\\n                          value_type: 0\\n                          delay: 60\\n                          units: \\'%\\'\\n                          description: \\'Average fill of OSD\\'\\n                          applications:\\n                              - applicationid:\\n                                  query_object: application\\n                                  query_name: Ceph OSD\\n                    triggers:\\n                        - description: \"Ceph OSD filled more that 90%\"\\n                          expression: \"{{\\'{\\'}}Testing Template:ceph.osd_avg_fill.last(){{\\'}\\'}}>90\"\\n                          priority: 4\\n                    discoveries:\\n                        - name: Mounted filesystem discovery\\n                          key_: vfs.fs.discovery\\n                          type: 0\\n                          delay: 60\\n                          itemprototypes:\\n                              - name: Free disk space on {{\\'{#\\'}}FSNAME}\\n                                key_: vfs.fs.size[{{\\'{#\\'}}FSNAME},free]\\n                                type: 0\\n                                value_type: 3\\n                                delay: 60\\n                                applications:\\n                                    - applicationid:\\n                                        query_object: application\\n                                        query_name: Ceph OSD\\n                          triggerprototypes:\\n                              - description: \"Free disk space is less than 20% on volume {{\\'{#\\'}}FSNAME{{\\'}\\'}}\"\\n                                expression: \"{{\\'{\\'}}Testing Template:vfs.fs.size[{{\\'{#\\'}}FSNAME},free].last(){{\\'}\\'}}<20\"\\n                    graphs:\\n                        - name: Ceph OSD avg fill graph\\n                          width: 900\\n                          height: 200\\n                          graphtype: 0\\n                          gitems:\\n                              - color: F63100\\n                                itemid:\\n                                  query_object: item\\n                                  query_name: Ceph OSD avg fill item\\n                    screens:\\n                        - name: Ceph\\n                          hsize: 1\\n                          vsize: 1\\n                          screenitems:\\n                              - x: 0\\n                                y: 0\\n                                resourcetype: 0\\n                                resourceid:\\n                                    query_object: graph\\n                                    query_name: Ceph OSD avg fill graph\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    params['host'] = name\n    del CHANGE_STACK[:]\n    template_definition = {}\n    template_components = {}\n    discovery_components = []\n    for attr in params:\n        if attr in TEMPLATE_COMPONENT_ORDER and str(attr) != 'discoveries':\n            template_components[attr] = params[attr]\n        elif str(attr) == 'discoveries':\n            d_rules = []\n            for d_rule in params[attr]:\n                d_rule_components = {'query_pid': {'component': attr, 'filter_val': d_rule[TEMPLATE_COMPONENT_DEF[attr]['filter']]}}\n                for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                    if proto_name in d_rule:\n                        d_rule_components[proto_name] = d_rule[proto_name]\n                        del d_rule[proto_name]\n                discovery_components.append(d_rule_components)\n                d_rules.append(d_rule)\n            template_components[attr] = d_rules\n        else:\n            template_definition[attr] = params[attr]\n    for attr in TEMPLATE_COMPONENT_ORDER:\n        if attr not in template_components:\n            template_components[attr] = []\n    for attr in TEMPLATE_RELATIONS:\n        template_definition[attr] = params[attr] if attr in params and params[attr] else []\n    defined_obj = __salt__['zabbix.substitute_params'](template_definition, **kwargs)\n    log.info('SUBSTITUTED template_definition: %s', str(json.dumps(defined_obj, indent=4)))\n    tmpl_get = __salt__['zabbix.run_query']('template.get', {'output': 'extend', 'selectGroups': 'groupid', 'selectHosts': 'hostid', 'selectTemplates': 'templateid', 'selectMacros': 'extend', 'filter': {'host': name}}, **kwargs)\n    log.info('TEMPLATE get result: %s', str(json.dumps(tmpl_get, indent=4)))\n    existing_obj = __salt__['zabbix.substitute_params'](tmpl_get[0], **kwargs) if tmpl_get and len(tmpl_get) == 1 else False\n    if existing_obj:\n        template_id = existing_obj[zabbix_id_mapper['template']]\n        if not static_host_list:\n            defined_wo_hosts = defined_obj\n            if 'hosts' in defined_obj:\n                defined_hosts = defined_obj['hosts']\n                del defined_wo_hosts['hosts']\n            else:\n                defined_hosts = []\n            existing_wo_hosts = existing_obj\n            if 'hosts' in existing_obj:\n                existing_hosts = existing_obj['hosts']\n                del existing_wo_hosts['hosts']\n            else:\n                existing_hosts = []\n            hosts_list = _diff_and_merge_host_list(defined_hosts, existing_hosts)\n            diff_params = __salt__['zabbix.compare_params'](defined_wo_hosts, existing_wo_hosts, True)\n            if 'new' in diff_params and 'hosts' in diff_params['new'] or hosts_list:\n                diff_params['new']['hosts'] = hosts_list\n        else:\n            diff_params = __salt__['zabbix.compare_params'](defined_obj, existing_obj, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper['template']] = template_id\n            diff_params['old'][zabbix_id_mapper['template']] = template_id\n            log.info('TEMPLATE: update params: %s', str(json.dumps(diff_params, indent=4)))\n            CHANGE_STACK.append({'component': 'template', 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                tmpl_update = __salt__['zabbix.run_query']('template.update', diff_params['new'], **kwargs)\n                log.info('TEMPLATE update result: %s', str(tmpl_update))\n    else:\n        CHANGE_STACK.append({'component': 'template', 'action': 'create', 'params': defined_obj})\n        if not dry_run:\n            tmpl_create = __salt__['zabbix.run_query']('template.create', defined_obj, **kwargs)\n            log.info('TEMPLATE create result: %s', str(tmpl_create))\n            if tmpl_create:\n                template_id = tmpl_create['templateids'][0]\n    log.info('\\n\\ntemplate_components: %s', json.dumps(template_components, indent=4))\n    log.info('\\n\\ndiscovery_components: %s', json.dumps(discovery_components, indent=4))\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if existing_obj or not dry_run:\n        for component in TEMPLATE_COMPONENT_ORDER:\n            log.info('\\n\\n\\n\\n\\nCOMPONENT: %s\\n\\n', str(json.dumps(component)))\n            existing_c_list = _get_existing_template_c_list(component, template_id, **kwargs)\n            existing_c_list_subs = __salt__['zabbix.substitute_params'](existing_c_list, **kwargs) if existing_c_list else []\n            if component in template_components:\n                defined_c_list_subs = __salt__['zabbix.substitute_params'](template_components[component], extend_params={TEMPLATE_COMPONENT_DEF[component]['qselectpid']: template_id}, filter_key=TEMPLATE_COMPONENT_DEF[component]['filter'], **kwargs)\n            else:\n                defined_c_list_subs = []\n            _manage_component(component, template_id, defined_c_list_subs, existing_c_list_subs, **kwargs)\n        log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n        for d_rule_component in discovery_components:\n            q_def = d_rule_component['query_pid']\n            c_def = TEMPLATE_COMPONENT_DEF[q_def['component']]\n            q_object = c_def['qtype']\n            q_params = dict(c_def['output'])\n            q_params.update({c_def['qselectpid']: template_id})\n            q_params.update({'filter': {c_def['filter']: q_def['filter_val']}})\n            parent_id = __salt__['zabbix.get_object_id_by_params'](q_object, q_params, **kwargs)\n            for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                log.info('\\n\\n\\n\\n\\nPROTOTYPE_NAME: %s\\n\\n', str(json.dumps(proto_name)))\n                existing_p_list = _get_existing_template_c_list(proto_name, parent_id, **kwargs)\n                existing_p_list_subs = __salt__['zabbix.substitute_params'](existing_p_list, **kwargs) if existing_p_list else []\n                if proto_name in d_rule_component:\n                    defined_p_list_subs = __salt__['zabbix.substitute_params'](d_rule_component[proto_name], extend_params={c_def['qselectpid']: template_id}, **kwargs)\n                else:\n                    defined_p_list_subs = []\n                _manage_component(proto_name, parent_id, defined_p_list_subs, existing_p_list_subs, template_id=template_id, **kwargs)\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if not CHANGE_STACK:\n        ret['result'] = True\n        ret['comment'] = 'Zabbix Template \"{}\" already exists and corresponds to a definition.'.format(name)\n    else:\n        tmpl_action = next((item for item in CHANGE_STACK if item['component'] == 'template' and item['action'] == 'create'), None)\n        if tmpl_action:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" does not exist.', 'new': 'Zabbix Template \"{}\" would be created according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" did not exist.', 'new': 'Zabbix Template \"{}\" created according definition.'.format(name)}}\n        else:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differs.', 'new': 'Zabbix Template \"{}\" would be updated according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differed.', 'new': 'Zabbix Template \"{}\" updated according definition.'.format(name)}}\n    return ret",
            "def present(name, params, static_host_list=True, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    '\\n    Creates Zabbix Template object or if differs update it according defined parameters. See Zabbix API documentation.\\n\\n    Zabbix API version: >3.0\\n\\n    :param name: Zabbix Template name\\n    :param params: Additional parameters according to Zabbix API documentation\\n    :param static_host_list: If hosts assigned to the template are controlled\\n        only by this state or can be also assigned externally\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module\\'s docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module\\'s docstring)\\n\\n    .. note::\\n\\n        If there is a need to get a value from current zabbix online (e.g. ids of host groups you want the template\\n        to be associated with), put a dictionary with two keys \"query_object\" and \"query_name\" instead of the value.\\n        In this example we want to create template named \"Testing Template\", assign it to hostgroup Templates,\\n        link it to two ceph nodes and create a macro.\\n\\n    .. note::\\n\\n        IMPORTANT NOTE:\\n        Objects (except for template name) are identified by name (or by other key in some exceptional cases)\\n        so changing name of object means deleting old one and creating new one with new ID !!!\\n\\n    .. note::\\n\\n        NOT SUPPORTED FEATURES:\\n            - linked templates\\n            - trigger dependencies\\n            - groups and group prototypes for host prototypes\\n\\n    SLS Example:\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-present:\\n            zabbix_template.present:\\n                - name: Testing Template\\n                # Do not touch existing assigned hosts\\n                # True will detach all other hosts than defined here\\n                - static_host_list: False\\n                - params:\\n                    description: Template for Ceph nodes\\n                    groups:\\n                        # groups must already exist\\n                        # template must be at least in one hostgroup\\n                        - groupid:\\n                            query_object: hostgroup\\n                            query_name: Templates\\n                    macros:\\n                        - macro: \"{$CEPH_CLUSTER_NAME}\"\\n                          value: ceph\\n                    hosts:\\n                        # hosts must already exist\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-01\\n                        - hostid:\\n                            query_object: host\\n                            query_name: ceph-osd-02\\n                    # templates:\\n                    # Linked templates - not supported by state module but can be linked manually (will not be touched)\\n\\n                    applications:\\n                        - name: Ceph OSD\\n                    items:\\n                        - name: Ceph OSD avg fill item\\n                          key_: ceph.osd_avg_fill\\n                          type: 2\\n                          value_type: 0\\n                          delay: 60\\n                          units: \\'%\\'\\n                          description: \\'Average fill of OSD\\'\\n                          applications:\\n                              - applicationid:\\n                                  query_object: application\\n                                  query_name: Ceph OSD\\n                    triggers:\\n                        - description: \"Ceph OSD filled more that 90%\"\\n                          expression: \"{{\\'{\\'}}Testing Template:ceph.osd_avg_fill.last(){{\\'}\\'}}>90\"\\n                          priority: 4\\n                    discoveries:\\n                        - name: Mounted filesystem discovery\\n                          key_: vfs.fs.discovery\\n                          type: 0\\n                          delay: 60\\n                          itemprototypes:\\n                              - name: Free disk space on {{\\'{#\\'}}FSNAME}\\n                                key_: vfs.fs.size[{{\\'{#\\'}}FSNAME},free]\\n                                type: 0\\n                                value_type: 3\\n                                delay: 60\\n                                applications:\\n                                    - applicationid:\\n                                        query_object: application\\n                                        query_name: Ceph OSD\\n                          triggerprototypes:\\n                              - description: \"Free disk space is less than 20% on volume {{\\'{#\\'}}FSNAME{{\\'}\\'}}\"\\n                                expression: \"{{\\'{\\'}}Testing Template:vfs.fs.size[{{\\'{#\\'}}FSNAME},free].last(){{\\'}\\'}}<20\"\\n                    graphs:\\n                        - name: Ceph OSD avg fill graph\\n                          width: 900\\n                          height: 200\\n                          graphtype: 0\\n                          gitems:\\n                              - color: F63100\\n                                itemid:\\n                                  query_object: item\\n                                  query_name: Ceph OSD avg fill item\\n                    screens:\\n                        - name: Ceph\\n                          hsize: 1\\n                          vsize: 1\\n                          screenitems:\\n                              - x: 0\\n                                y: 0\\n                                resourcetype: 0\\n                                resourceid:\\n                                    query_object: graph\\n                                    query_name: Ceph OSD avg fill graph\\n    '\n    zabbix_id_mapper = __salt__['zabbix.get_zabbix_id_mapper']()\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    params['host'] = name\n    del CHANGE_STACK[:]\n    template_definition = {}\n    template_components = {}\n    discovery_components = []\n    for attr in params:\n        if attr in TEMPLATE_COMPONENT_ORDER and str(attr) != 'discoveries':\n            template_components[attr] = params[attr]\n        elif str(attr) == 'discoveries':\n            d_rules = []\n            for d_rule in params[attr]:\n                d_rule_components = {'query_pid': {'component': attr, 'filter_val': d_rule[TEMPLATE_COMPONENT_DEF[attr]['filter']]}}\n                for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                    if proto_name in d_rule:\n                        d_rule_components[proto_name] = d_rule[proto_name]\n                        del d_rule[proto_name]\n                discovery_components.append(d_rule_components)\n                d_rules.append(d_rule)\n            template_components[attr] = d_rules\n        else:\n            template_definition[attr] = params[attr]\n    for attr in TEMPLATE_COMPONENT_ORDER:\n        if attr not in template_components:\n            template_components[attr] = []\n    for attr in TEMPLATE_RELATIONS:\n        template_definition[attr] = params[attr] if attr in params and params[attr] else []\n    defined_obj = __salt__['zabbix.substitute_params'](template_definition, **kwargs)\n    log.info('SUBSTITUTED template_definition: %s', str(json.dumps(defined_obj, indent=4)))\n    tmpl_get = __salt__['zabbix.run_query']('template.get', {'output': 'extend', 'selectGroups': 'groupid', 'selectHosts': 'hostid', 'selectTemplates': 'templateid', 'selectMacros': 'extend', 'filter': {'host': name}}, **kwargs)\n    log.info('TEMPLATE get result: %s', str(json.dumps(tmpl_get, indent=4)))\n    existing_obj = __salt__['zabbix.substitute_params'](tmpl_get[0], **kwargs) if tmpl_get and len(tmpl_get) == 1 else False\n    if existing_obj:\n        template_id = existing_obj[zabbix_id_mapper['template']]\n        if not static_host_list:\n            defined_wo_hosts = defined_obj\n            if 'hosts' in defined_obj:\n                defined_hosts = defined_obj['hosts']\n                del defined_wo_hosts['hosts']\n            else:\n                defined_hosts = []\n            existing_wo_hosts = existing_obj\n            if 'hosts' in existing_obj:\n                existing_hosts = existing_obj['hosts']\n                del existing_wo_hosts['hosts']\n            else:\n                existing_hosts = []\n            hosts_list = _diff_and_merge_host_list(defined_hosts, existing_hosts)\n            diff_params = __salt__['zabbix.compare_params'](defined_wo_hosts, existing_wo_hosts, True)\n            if 'new' in diff_params and 'hosts' in diff_params['new'] or hosts_list:\n                diff_params['new']['hosts'] = hosts_list\n        else:\n            diff_params = __salt__['zabbix.compare_params'](defined_obj, existing_obj, True)\n        if diff_params['new']:\n            diff_params['new'][zabbix_id_mapper['template']] = template_id\n            diff_params['old'][zabbix_id_mapper['template']] = template_id\n            log.info('TEMPLATE: update params: %s', str(json.dumps(diff_params, indent=4)))\n            CHANGE_STACK.append({'component': 'template', 'action': 'update', 'params': diff_params['new']})\n            if not dry_run:\n                tmpl_update = __salt__['zabbix.run_query']('template.update', diff_params['new'], **kwargs)\n                log.info('TEMPLATE update result: %s', str(tmpl_update))\n    else:\n        CHANGE_STACK.append({'component': 'template', 'action': 'create', 'params': defined_obj})\n        if not dry_run:\n            tmpl_create = __salt__['zabbix.run_query']('template.create', defined_obj, **kwargs)\n            log.info('TEMPLATE create result: %s', str(tmpl_create))\n            if tmpl_create:\n                template_id = tmpl_create['templateids'][0]\n    log.info('\\n\\ntemplate_components: %s', json.dumps(template_components, indent=4))\n    log.info('\\n\\ndiscovery_components: %s', json.dumps(discovery_components, indent=4))\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if existing_obj or not dry_run:\n        for component in TEMPLATE_COMPONENT_ORDER:\n            log.info('\\n\\n\\n\\n\\nCOMPONENT: %s\\n\\n', str(json.dumps(component)))\n            existing_c_list = _get_existing_template_c_list(component, template_id, **kwargs)\n            existing_c_list_subs = __salt__['zabbix.substitute_params'](existing_c_list, **kwargs) if existing_c_list else []\n            if component in template_components:\n                defined_c_list_subs = __salt__['zabbix.substitute_params'](template_components[component], extend_params={TEMPLATE_COMPONENT_DEF[component]['qselectpid']: template_id}, filter_key=TEMPLATE_COMPONENT_DEF[component]['filter'], **kwargs)\n            else:\n                defined_c_list_subs = []\n            _manage_component(component, template_id, defined_c_list_subs, existing_c_list_subs, **kwargs)\n        log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n        for d_rule_component in discovery_components:\n            q_def = d_rule_component['query_pid']\n            c_def = TEMPLATE_COMPONENT_DEF[q_def['component']]\n            q_object = c_def['qtype']\n            q_params = dict(c_def['output'])\n            q_params.update({c_def['qselectpid']: template_id})\n            q_params.update({'filter': {c_def['filter']: q_def['filter_val']}})\n            parent_id = __salt__['zabbix.get_object_id_by_params'](q_object, q_params, **kwargs)\n            for proto_name in DISCOVERYRULE_COMPONENT_ORDER:\n                log.info('\\n\\n\\n\\n\\nPROTOTYPE_NAME: %s\\n\\n', str(json.dumps(proto_name)))\n                existing_p_list = _get_existing_template_c_list(proto_name, parent_id, **kwargs)\n                existing_p_list_subs = __salt__['zabbix.substitute_params'](existing_p_list, **kwargs) if existing_p_list else []\n                if proto_name in d_rule_component:\n                    defined_p_list_subs = __salt__['zabbix.substitute_params'](d_rule_component[proto_name], extend_params={c_def['qselectpid']: template_id}, **kwargs)\n                else:\n                    defined_p_list_subs = []\n                _manage_component(proto_name, parent_id, defined_p_list_subs, existing_p_list_subs, template_id=template_id, **kwargs)\n    log.info('\\n\\nCurrent CHANGE_STACK: %s', str(json.dumps(CHANGE_STACK, indent=4)))\n    if not CHANGE_STACK:\n        ret['result'] = True\n        ret['comment'] = 'Zabbix Template \"{}\" already exists and corresponds to a definition.'.format(name)\n    else:\n        tmpl_action = next((item for item in CHANGE_STACK if item['component'] == 'template' and item['action'] == 'create'), None)\n        if tmpl_action:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" does not exist.', 'new': 'Zabbix Template \"{}\" would be created according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" created.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" did not exist.', 'new': 'Zabbix Template \"{}\" created according definition.'.format(name)}}\n        else:\n            ret['result'] = True\n            if dry_run:\n                ret['comment'] = f'Zabbix Template \"{name}\" would be updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differs.', 'new': 'Zabbix Template \"{}\" would be updated according definition.'.format(name)}}\n            else:\n                ret['comment'] = f'Zabbix Template \"{name}\" updated.'\n                ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" differed.', 'new': 'Zabbix Template \"{}\" updated according definition.'.format(name)}}\n    return ret"
        ]
    },
    {
        "func_name": "absent",
        "original": "def absent(name, **kwargs):\n    \"\"\"\n    Makes the Zabbix Template to be absent (either does not exist or delete it).\n\n    :param name: Zabbix Template name\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\n\n    .. code-block:: yaml\n\n        zabbix-template-absent:\n            zabbix_template.absent:\n                - name: Ceph OSD\n    \"\"\"\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    elif dry_run:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" would be deleted.'\n        ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" exists.', 'new': f'Zabbix Template \"{name}\" would be deleted.'}}\n    else:\n        tmpl_delete = __salt__['zabbix.run_query']('template.delete', [object_id], **kwargs)\n        if tmpl_delete:\n            ret['result'] = True\n            ret['comment'] = f'Zabbix Template \"{name}\" deleted.'\n            ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" existed.', 'new': f'Zabbix Template \"{name}\" deleted.'}}\n    return ret",
        "mutated": [
            "def absent(name, **kwargs):\n    if False:\n        i = 10\n    \"\\n    Makes the Zabbix Template to be absent (either does not exist or delete it).\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-absent:\\n            zabbix_template.absent:\\n                - name: Ceph OSD\\n    \"\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    elif dry_run:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" would be deleted.'\n        ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" exists.', 'new': f'Zabbix Template \"{name}\" would be deleted.'}}\n    else:\n        tmpl_delete = __salt__['zabbix.run_query']('template.delete', [object_id], **kwargs)\n        if tmpl_delete:\n            ret['result'] = True\n            ret['comment'] = f'Zabbix Template \"{name}\" deleted.'\n            ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" existed.', 'new': f'Zabbix Template \"{name}\" deleted.'}}\n    return ret",
            "def absent(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    \"\\n    Makes the Zabbix Template to be absent (either does not exist or delete it).\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-absent:\\n            zabbix_template.absent:\\n                - name: Ceph OSD\\n    \"\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    elif dry_run:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" would be deleted.'\n        ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" exists.', 'new': f'Zabbix Template \"{name}\" would be deleted.'}}\n    else:\n        tmpl_delete = __salt__['zabbix.run_query']('template.delete', [object_id], **kwargs)\n        if tmpl_delete:\n            ret['result'] = True\n            ret['comment'] = f'Zabbix Template \"{name}\" deleted.'\n            ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" existed.', 'new': f'Zabbix Template \"{name}\" deleted.'}}\n    return ret",
            "def absent(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    \"\\n    Makes the Zabbix Template to be absent (either does not exist or delete it).\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-absent:\\n            zabbix_template.absent:\\n                - name: Ceph OSD\\n    \"\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    elif dry_run:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" would be deleted.'\n        ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" exists.', 'new': f'Zabbix Template \"{name}\" would be deleted.'}}\n    else:\n        tmpl_delete = __salt__['zabbix.run_query']('template.delete', [object_id], **kwargs)\n        if tmpl_delete:\n            ret['result'] = True\n            ret['comment'] = f'Zabbix Template \"{name}\" deleted.'\n            ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" existed.', 'new': f'Zabbix Template \"{name}\" deleted.'}}\n    return ret",
            "def absent(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    \"\\n    Makes the Zabbix Template to be absent (either does not exist or delete it).\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-absent:\\n            zabbix_template.absent:\\n                - name: Ceph OSD\\n    \"\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    elif dry_run:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" would be deleted.'\n        ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" exists.', 'new': f'Zabbix Template \"{name}\" would be deleted.'}}\n    else:\n        tmpl_delete = __salt__['zabbix.run_query']('template.delete', [object_id], **kwargs)\n        if tmpl_delete:\n            ret['result'] = True\n            ret['comment'] = f'Zabbix Template \"{name}\" deleted.'\n            ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" existed.', 'new': f'Zabbix Template \"{name}\" deleted.'}}\n    return ret",
            "def absent(name, **kwargs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    \"\\n    Makes the Zabbix Template to be absent (either does not exist or delete it).\\n\\n    :param name: Zabbix Template name\\n    :param _connection_user: Optional - zabbix user (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_password: Optional - zabbix password (can also be set in opts or pillar, see module's docstring)\\n    :param _connection_url: Optional - url of zabbix frontend (can also be set in opts, pillar, see module's docstring)\\n\\n    .. code-block:: yaml\\n\\n        zabbix-template-absent:\\n            zabbix_template.absent:\\n                - name: Ceph OSD\\n    \"\n    dry_run = __opts__['test']\n    ret = {'name': name, 'result': False, 'comment': '', 'changes': {}}\n    try:\n        object_id = __salt__['zabbix.get_object_id_by_params']('template', {'filter': {'name': name}}, **kwargs)\n    except SaltException:\n        object_id = False\n    if not object_id:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" does not exist.'\n    elif dry_run:\n        ret['result'] = True\n        ret['comment'] = f'Zabbix Template \"{name}\" would be deleted.'\n        ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" exists.', 'new': f'Zabbix Template \"{name}\" would be deleted.'}}\n    else:\n        tmpl_delete = __salt__['zabbix.run_query']('template.delete', [object_id], **kwargs)\n        if tmpl_delete:\n            ret['result'] = True\n            ret['comment'] = f'Zabbix Template \"{name}\" deleted.'\n            ret['changes'] = {name: {'old': f'Zabbix Template \"{name}\" existed.', 'new': f'Zabbix Template \"{name}\" deleted.'}}\n    return ret"
        ]
    }
]