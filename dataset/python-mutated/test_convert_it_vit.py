"""
Test a couple different classes of trees to check the output of the VIT conversion

A couple representative trees are included, but hopefully not enough
to be a problem in terms of our license.

One of the tests is currently disabled as it relies on tregex & tsurgeon features
not yet released
"""
import io
import os
import tempfile
import pytest
from stanza.server import tsurgeon
from stanza.utils.conll import CoNLL
from stanza.utils.datasets.constituency import convert_it_vit
pytestmark = [pytest.mark.pipeline, pytest.mark.travis]
CON_SAMPLE = "\n#ID=sent_00002\tcp-[sp-[part-negli, sn-[sa-[ag-ultimi], nt-anni]], f-[sn-[art-la, n-dinamica, spd-[partd-dei, sn-[n-polo_di_attrazione]]], ibar-[ause-è, ausep-stata, savv-[savv-[avv-sempre], avv-più], vppt-caratterizzata], compin-[spda-[partda-dall, sn-[n-emergere, spd-[pd-di, sn-[art-una, sa-[ag-crescente], n-concorrenza, f2-[rel-che, f-[ibar-[clit-si, ause-è, avv-progressivamente, vppin-spostata], compin-[spda-[partda-dalle, sn-[sa-[ag-singole], n-imprese]], sp-[part-ai, sn-[n-sistemi, sa-[coord-[ag-economici, cong-e, ag-territoriali]]]], fp-[punt-',', sv5-[vgt-determinando, compt-[sn-[art-l_, nf-esigenza, spd-[pd-di, sn-[art-una, n-riconsiderazione, spd-[partd-dei, sn-[n-rapporti, sv3-[ppre-esistenti, compin-[sp-[p-tra, sn-[n-soggetti, sa-[ag-produttivi]]], cong-e, sn-[n-ambiente, f2-[sp-[p-in, sn-[relob-cui]], f-[sn-[deit-questi], ibar-[vin-operano, punto-.]]]]]]]]]]]]]]]]]]]]]]]]\n\n#ID=sent_00318\tdirsp-[fc-[congf-tuttavia, f-[sn-[sq-[ind-qualche], n-problema], ir_infl-[vsupir-potrebbe, vcl-esserci], compc-[clit-ci, sp-[p-per, sn-[art-la, n-commissione, sa-[ag-esteri], f2-[sp-[part-alla, relob-cui, sn-[n-presidenza]], f-[ibar-[vc-è], compc-[sn-[n-candidato], sn-[art-l, n-esponente, spd-[pd-di, sn-[mw-Alleanza, npro-Nazionale]], sn-[mw-Mirko, nh-Tremaglia]]]]]]]]]], dirs-':', f3-[sn-[art-una, n-candidatura, sc-[q-più, sa-[ppas-subìta], sc-[ccong-che, sa-[ppas-gradita]], compt-[spda-[partda-dalla, sn-[mw-Lega, npro-Nord, punt-',', f2-[rel-che, fc-[congf-tuttavia, f-[ir_infl-[vsupir-dovrebbe, vit-rispettare], compt-[sn-[art-gli, n-accordi]]]]]]]]]], punto-.]]\n\n#ID=sent_00589\tf-[sn-[art-l, n-ottimismo, spd-[pd-di, sn-[nh-Kantor]]], ir_infl-[vsupir-potrebbe, congf-però, vcl-rivelarsi], compc-[sn-[in-ancora, art-una, nt-volta], sa-[ag-prematuro]], punto-.]\n"
UD_SAMPLE = "\n# sent_id = VIT-2\n# text = Negli ultimi anni la dinamica dei polo di attrazione è stata sempre più caratterizzata dall'emergere di una crescente concorrenza che si è progressivamente spostata dalle singole imprese ai sistemi economici e territoriali, determinando l'esigenza di una riconsiderazione dei rapporti esistenti tra soggetti produttivi e ambiente in cui questi operano.\n1-2\tNegli\t_\t_\t_\t_\t_\t_\t_\t_\n1\tIn\tin\tADP\tE\t_\t4\tcase\t_\t_\n2\tgli\til\tDET\tRD\tDefinite=Def|Gender=Masc|Number=Plur|PronType=Art\t4\tdet\t_\t_\n3\tultimi\tultimo\tADJ\tA\tGender=Masc|Number=Plur\t4\tamod\t_\t_\n4\tanni\tanno\tNOUN\tS\tGender=Masc|Number=Plur\t16\tobl\t_\t_\n5\tla\til\tDET\tRD\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t6\tdet\t_\t_\n6\tdinamica\tdinamica\tNOUN\tS\tGender=Fem|Number=Sing\t16\tnsubj:pass\t_\t_\n7-8\tdei\t_\t_\t_\t_\t_\t_\t_\t_\n7\tdi\tdi\tADP\tE\t_\t9\tcase\t_\t_\n8\ti\til\tDET\tRD\tDefinite=Def|Gender=Masc|Number=Plur|PronType=Art\t9\tdet\t_\t_\n9\tpolo\tpolo\tNOUN\tS\tGender=Masc|Number=Sing\t6\tnmod\t_\t_\n10\tdi\tdi\tADP\tE\t_\t11\tcase\t_\t_\n11\tattrazione\tattrazione\tNOUN\tS\tGender=Fem|Number=Sing\t9\tnmod\t_\t_\n12\tè\tessere\tAUX\tVA\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t16\taux\t_\t_\n13\tstata\tessere\tAUX\tVA\tGender=Fem|Number=Sing|Tense=Past|VerbForm=Part\t16\taux:pass\t_\t_\n14\tsempre\tsempre\tADV\tB\t_\t15\tadvmod\t_\t_\n15\tpiù\tpiù\tADV\tB\t_\t16\tadvmod\t_\t_\n16\tcaratterizzata\tcaratterizzare\tVERB\tV\tGender=Fem|Number=Sing|Tense=Past|VerbForm=Part\t0\troot\t_\t_\n17-18\tdall'\t_\t_\t_\t_\t_\t_\t_\tSpaceAfter=No\n17\tda\tda\tADP\tE\t_\t19\tcase\t_\t_\n18\tl'\til\tDET\tRD\tDefinite=Def|Number=Sing|PronType=Art\t19\tdet\t_\t_\n19\temergere\temergere\tNOUN\tS\tGender=Masc|Number=Sing\t16\tobl\t_\t_\n20\tdi\tdi\tADP\tE\t_\t23\tcase\t_\t_\n21\tuna\tuno\tDET\tRI\tDefinite=Ind|Gender=Fem|Number=Sing|PronType=Art\t23\tdet\t_\t_\n22\tcrescente\tcrescente\tADJ\tA\tNumber=Sing\t23\tamod\t_\t_\n23\tconcorrenza\tconcorrenza\tNOUN\tS\tGender=Fem|Number=Sing\t19\tnmod\t_\t_\n24\tche\tche\tPRON\tPR\tPronType=Rel\t28\tnsubj\t_\t_\n25\tsi\tsi\tPRON\tPC\tClitic=Yes|Person=3|PronType=Prs\t28\texpl\t_\t_\n26\tè\tessere\tAUX\tVA\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t28\taux\t_\t_\n27\tprogressivamente\tprogressivamente\tADV\tB\t_\t28\tadvmod\t_\t_\n28\tspostata\tspostare\tVERB\tV\tGender=Fem|Number=Sing|Tense=Past|VerbForm=Part\t23\tacl:relcl\t_\t_\n29-30\tdalle\t_\t_\t_\t_\t_\t_\t_\t_\n29\tda\tda\tADP\tE\t_\t32\tcase\t_\t_\n30\tle\til\tDET\tRD\tDefinite=Def|Gender=Fem|Number=Plur|PronType=Art\t32\tdet\t_\t_\n31\tsingole\tsingolo\tADJ\tA\tGender=Fem|Number=Plur\t32\tamod\t_\t_\n32\timprese\timpresa\tNOUN\tS\tGender=Fem|Number=Plur\t28\tobl\t_\t_\n33-34\tai\t_\t_\t_\t_\t_\t_\t_\t_\n33\ta\ta\tADP\tE\t_\t35\tcase\t_\t_\n34\ti\til\tDET\tRD\tDefinite=Def|Gender=Masc|Number=Plur|PronType=Art\t35\tdet\t_\t_\n35\tsistemi\tsistema\tNOUN\tS\tGender=Masc|Number=Plur\t28\tobl\t_\t_\n36\teconomici\teconomico\tADJ\tA\tGender=Masc|Number=Plur\t35\tamod\t_\t_\n37\te\te\tCCONJ\tCC\t_\t38\tcc\t_\t_\n38\tterritoriali\tterritoriale\tADJ\tA\tNumber=Plur\t36\tconj\t_\tSpaceAfter=No\n39\t,\t,\tPUNCT\tFF\t_\t28\tpunct\t_\t_\n40\tdeterminando\tdeterminare\tVERB\tV\tVerbForm=Ger\t28\tadvcl\t_\t_\n41\tl'\til\tDET\tRD\tDefinite=Def|Number=Sing|PronType=Art\t42\tdet\t_\tSpaceAfter=No\n42\tesigenza\tesigenza\tNOUN\tS\tGender=Fem|Number=Sing\t40\tobj\t_\t_\n43\tdi\tdi\tADP\tE\t_\t45\tcase\t_\t_\n44\tuna\tuno\tDET\tRI\tDefinite=Ind|Gender=Fem|Number=Sing|PronType=Art\t45\tdet\t_\t_\n45\triconsiderazione\triconsiderazione\tNOUN\tS\tGender=Fem|Number=Sing\t42\tnmod\t_\t_\n46-47\tdei\t_\t_\t_\t_\t_\t_\t_\t_\n46\tdi\tdi\tADP\tE\t_\t48\tcase\t_\t_\n47\ti\til\tDET\tRD\tDefinite=Def|Gender=Masc|Number=Plur|PronType=Art\t48\tdet\t_\t_\n48\trapporti\trapporto\tNOUN\tS\tGender=Masc|Number=Plur\t45\tnmod\t_\t_\n49\tesistenti\tesistente\tVERB\tV\tNumber=Plur\t48\tacl\t_\t_\n50\ttra\ttra\tADP\tE\t_\t51\tcase\t_\t_\n51\tsoggetti\tsoggetto\tNOUN\tS\tGender=Masc|Number=Plur\t49\tobl\t_\t_\n52\tproduttivi\tproduttivo\tADJ\tA\tGender=Masc|Number=Plur\t51\tamod\t_\t_\n53\te\te\tCCONJ\tCC\t_\t54\tcc\t_\t_\n54\tambiente\tambiente\tNOUN\tS\tGender=Masc|Number=Sing\t51\tconj\t_\t_\n55\tin\tin\tADP\tE\t_\t56\tcase\t_\t_\n56\tcui\tcui\tPRON\tPR\tPronType=Rel\t58\tobl\t_\t_\n57\tquesti\tquesto\tPRON\tPD\tGender=Masc|Number=Plur|PronType=Dem\t58\tnsubj\t_\t_\n58\toperano\toperare\tVERB\tV\tMood=Ind|Number=Plur|Person=3|Tense=Pres|VerbForm=Fin\t54\tacl:relcl\t_\tSpaceAfter=No\n59\t.\t.\tPUNCT\tFS\t_\t16\tpunct\t_\t_\n\n# sent_id = VIT-318\n# text = Tuttavia qualche problema potrebbe esserci per la commissione esteri alla cui presidenza è candidato l'esponente di Alleanza Nazionale Mirko Tremaglia: una candidatura più subìta che gradita dalla Lega Nord, che tuttavia dovrebbe rispettare gli accordi.\n1\tTuttavia\ttuttavia\tCCONJ\tCC\t_\t5\tcc\t_\t_\n2\tqualche\tqualche\tDET\tDI\tNumber=Sing|PronType=Ind\t3\tdet\t_\t_\n3\tproblema\tproblema\tNOUN\tS\tGender=Masc|Number=Sing\t5\tnsubj\t_\t_\n4\tpotrebbe\tpotere\tAUX\tVA\tMood=Cnd|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t5\taux\t_\t_\n5-6\tesserci\t_\t_\t_\t_\t_\t_\t_\t_\n5\tesser\tessere\tVERB\tV\tVerbForm=Inf\t0\troot\t_\t_\n6\tci\tci\tPRON\tPC\tClitic=Yes|Number=Plur|Person=1|PronType=Prs\t5\texpl\t_\t_\n7\tper\tper\tADP\tE\t_\t9\tcase\t_\t_\n8\tla\til\tDET\tRD\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t9\tdet\t_\t_\n9\tcommissione\tcommissione\tNOUN\tS\tGender=Fem|Number=Sing\t5\tobl\t_\t_\n10\testeri\testero\tADJ\tA\tGender=Masc|Number=Plur\t9\tamod\t_\t_\n11-12\talla\t_\t_\t_\t_\t_\t_\t_\t_\n11\ta\ta\tADP\tE\t_\t14\tcase\t_\t_\n12\tla\til\tDET\tRD\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t14\tdet\t_\t_\n13\tcui\tcui\tDET\tDR\tPronType=Rel\t14\tdet:poss\t_\t_\n14\tpresidenza\tpresidenza\tNOUN\tS\tGender=Fem|Number=Sing\t16\tobl\t_\t_\n15\tè\tessere\tAUX\tVA\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t16\taux:pass\t_\t_\n16\tcandidato\tcandidare\tVERB\tV\tGender=Masc|Number=Sing|Tense=Past|VerbForm=Part\t9\tacl:relcl\t_\t_\n17\tl'\til\tDET\tRD\tDefinite=Def|Number=Sing|PronType=Art\t18\tdet\t_\tSpaceAfter=No\n18\tesponente\tesponente\tNOUN\tS\tNumber=Sing\t16\tnsubj:pass\t_\t_\n19\tdi\tdi\tADP\tE\t_\t20\tcase\t_\t_\n20\tAlleanza\tAlleanza\tPROPN\tSP\t_\t18\tnmod\t_\t_\n21\tNazionale\tNazionale\tPROPN\tSP\t_\t20\tflat:name\t_\t_\n22\tMirko\tMirko\tPROPN\tSP\t_\t18\tnmod\t_\t_\n23\tTremaglia\tTremaglia\tPROPN\tSP\t_\t22\tflat:name\t_\tSpaceAfter=No\n24\t:\t:\tPUNCT\tFC\t_\t22\tpunct\t_\t_\n25\tuna\tuno\tDET\tRI\tDefinite=Ind|Gender=Fem|Number=Sing|PronType=Art\t26\tdet\t_\t_\n26\tcandidatura\tcandidatura\tNOUN\tS\tGender=Fem|Number=Sing\t22\tappos\t_\t_\n27\tpiù\tpiù\tADV\tB\t_\t28\tadvmod\t_\t_\n28\tsubìta\tsubire\tVERB\tV\tGender=Fem|Number=Sing|Tense=Past|VerbForm=Part\t26\tadvcl\t_\t_\n29\tche\tche\tCCONJ\tCC\t_\t30\tcc\t_\t_\n30\tgradita\tgradito\tADJ\tA\tGender=Fem|Number=Sing\t28\tamod\t_\t_\n31-32\tdalla\t_\t_\t_\t_\t_\t_\t_\t_\n31\tda\tda\tADP\tE\t_\t33\tcase\t_\t_\n32\tla\til\tDET\tRD\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t33\tdet\t_\t_\n33\tLega\tLega\tPROPN\tSP\t_\t28\tobl:agent\t_\t_\n34\tNord\tNord\tPROPN\tSP\t_\t33\tflat:name\t_\tSpaceAfter=No\n35\t,\t,\tPUNCT\tFC\t_\t33\tpunct\t_\t_\n36\tche\tche\tPRON\tPR\tPronType=Rel\t39\tnsubj\t_\t_\n37\ttuttavia\ttuttavia\tCCONJ\tCC\t_\t39\tcc\t_\t_\n38\tdovrebbe\tdovere\tAUX\tVM\tMood=Cnd|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t39\taux\t_\t_\n39\trispettare\trispettare\tVERB\tV\tVerbForm=Inf\t33\tacl:relcl\t_\t_\n40\tgli\til\tDET\tRD\tDefinite=Def|Gender=Masc|Number=Plur|PronType=Art\t41\tdet\t_\t_\n41\taccordi\taccordio\tNOUN\tS\tGender=Masc|Number=Plur\t39\tobj\t_\tSpaceAfter=No\n42\t.\t.\tPUNCT\tFS\t_\t5\tpunct\t_\t_\n\n# sent_id = VIT-591\n# text = L'ottimismo di Kantor potrebbe però rivelarsi ancora una volta prematuro.\n1\tL'\til\tDET\tRD\tDefinite=Def|Number=Sing|PronType=Art\t2\tdet\t_\tSpaceAfter=No\n2\tottimismo\tottimismo\tNOUN\tS\tGender=Masc|Number=Sing\t7\tnsubj\t_\t_\n3\tdi\tdi\tADP\tE\t_\t4\tcase\t_\t_\n4\tKantor\tKantor\tPROPN\tSP\t_\t2\tnmod\t_\t_\n5\tpotrebbe\tpotere\tAUX\tVM\tMood=Cnd|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t7\taux\t_\t_\n6\tperò\tperò\tADV\tB\t_\t7\tadvmod\t_\t_\n7-8\trivelarsi\t_\t_\t_\t_\t_\t_\t_\t_\n7\trivelar\trivelare\tVERB\tV\tVerbForm=Inf\t0\troot\t_\t_\n8\tsi\tsi\tPRON\tPC\tClitic=Yes|Person=3|PronType=Prs\t7\texpl\t_\t_\n9\tancora\tancora\tADV\tB\t_\t7\tadvmod\t_\t_\n10\tuna\tuno\tDET\tRI\tDefinite=Ind|Gender=Fem|Number=Sing|PronType=Art\t11\tdet\t_\t_\n11\tvolta\tvolta\tNOUN\tS\tGender=Fem|Number=Sing\t7\tobl\t_\t_\n12\tprematuro\tprematuro\tADJ\tA\tGender=Masc|Number=Sing\t7\txcomp\t_\tSpaceAfter=No\n13\t.\t.\tPUNCT\tFS\t_\t7\tpunct\t_\t_\n"

def test_process_mwts():
    if False:
        i = 10
        return i + 15
    expected_mwts = {'Negli': ('In', 'gli'), 'dei': ('di', 'i'), "dall'": ('da', "l'"), 'dalle': ('da', 'le'), 'ai': ('a', 'i'), 'alla': ('a', 'la'), 'dalla': ('da', 'la')}
    ud_train_data = CoNLL.conll2doc(input_str=UD_SAMPLE)
    mwts = convert_it_vit.get_mwt(ud_train_data)
    assert expected_mwts == mwts

def test_raw_tree():
    if False:
        print('Hello World!')
    con_sentences = convert_it_vit.read_constituency_sentences(io.StringIO(CON_SAMPLE))
    expected_ids = ['#ID=sent_00002', '#ID=sent_00318', '#ID=sent_00589']
    expected_trees = ["(ROOT (cp (sp (part negli) (sn (sa (ag ultimi)) (nt anni))) (f (sn (art la) (n dinamica) (spd (partd dei) (sn (n polo) (n di) (n attrazione)))) (ibar (ause è) (ausep stata) (savv (savv (avv sempre)) (avv più)) (vppt caratterizzata)) (compin (spda (partda dall) (sn (n emergere) (spd (pd di) (sn (art una) (sa (ag crescente)) (n concorrenza) (f2 (rel che) (f (ibar (clit si) (ause è) (avv progressivamente) (vppin spostata)) (compin (spda (partda dalle) (sn (sa (ag singole)) (n imprese))) (sp (part ai) (sn (n sistemi) (sa (coord (ag economici) (cong e) (ag territoriali))))) (fp (punt ,) (sv5 (vgt determinando) (compt (sn (art l') (nf esigenza) (spd (pd di) (sn (art una) (n riconsiderazione) (spd (partd dei) (sn (n rapporti) (sv3 (ppre esistenti) (compin (sp (p tra) (sn (n soggetti) (sa (ag produttivi)))) (cong e) (sn (n ambiente) (f2 (sp (p in) (sn (relob cui))) (f (sn (deit questi)) (ibar (vin operano) (punto .))))))))))))))))))))))))))", '(ROOT (dirsp (fc (congf tuttavia) (f (sn (sq (ind qualche)) (n problema)) (ir_infl (vsupir potrebbe) (vcl esserci)) (compc (clit ci) (sp (p per) (sn (art la) (n commissione) (sa (ag esteri)) (f2 (sp (part alla) (relob cui) (sn (n presidenza))) (f (ibar (vc è)) (compc (sn (n candidato)) (sn (art l) (n esponente) (spd (pd di) (sn (mw Alleanza) (npro Nazionale))) (sn (mw Mirko) (nh Tremaglia))))))))))) (dirs :) (f3 (sn (art una) (n candidatura) (sc (q più) (sa (ppas subìta)) (sc (ccong che) (sa (ppas gradita))) (compt (spda (partda dalla) (sn (mw Lega) (npro Nord) (punt ,) (f2 (rel che) (fc (congf tuttavia) (f (ir_infl (vsupir dovrebbe) (vit rispettare)) (compt (sn (art gli) (n accordi))))))))))) (punto .))))', '(ROOT (f (sn (art l) (n ottimismo) (spd (pd di) (sn (nh Kantor)))) (ir_infl (vsupir potrebbe) (congf però) (vcl rivelarsi)) (compc (sn (in ancora) (art una) (nt volta)) (sa (ag prematuro))) (punto .)))']
    assert len(con_sentences) == 3
    for (sentence, expected_id, expected_tree) in zip(con_sentences, expected_ids, expected_trees):
        assert sentence[0] == expected_id
        tree = convert_it_vit.raw_tree(sentence[1])
        assert str(tree) == expected_tree

def test_update_mwts():
    if False:
        i = 10
        return i + 15
    con_sentences = convert_it_vit.read_constituency_sentences(io.StringIO(CON_SAMPLE))
    ud_train_data = CoNLL.conll2doc(input_str=UD_SAMPLE)
    mwt_map = convert_it_vit.get_mwt(ud_train_data)
    expected_trees = ["(ROOT (cp (sp (part In) (sn (art gli) (sa (ag ultimi)) (nt anni))) (f (sn (art la) (n dinamica) (spd (partd di) (sn (art i) (n polo) (n di) (n attrazione)))) (ibar (ause è) (ausep stata) (savv (savv (avv sempre)) (avv più)) (vppt caratterizzata)) (compin (spda (partda da) (sn (art l') (n emergere) (spd (pd di) (sn (art una) (sa (ag crescente)) (n concorrenza) (f2 (rel che) (f (ibar (clit si) (ause è) (avv progressivamente) (vppin spostata)) (compin (spda (partda da) (sn (art le) (sa (ag singole)) (n imprese))) (sp (part a) (sn (art i) (n sistemi) (sa (coord (ag economici) (cong e) (ag territoriali))))) (fp (punt ,) (sv5 (vgt determinando) (compt (sn (art l') (nf esigenza) (spd (pd di) (sn (art una) (n riconsiderazione) (spd (partd di) (sn (art i) (n rapporti) (sv3 (ppre esistenti) (compin (sp (p tra) (sn (n soggetti) (sa (ag produttivi)))) (cong e) (sn (n ambiente) (f2 (sp (p in) (sn (relob cui))) (f (sn (deit questi)) (ibar (vin operano) (punto .))))))))))))))))))))))))))", '(ROOT (dirsp (fc (congf tuttavia) (f (sn (sq (ind qualche)) (n problema)) (ir_infl (vsupir potrebbe) (vcl esserci)) (compc (clit ci) (sp (p per) (sn (art la) (n commissione) (sa (ag esteri)) (f2 (sp (part a) (art la) (relob cui) (sn (n presidenza))) (f (ibar (vc è)) (compc (sn (n candidato)) (sn (art l) (n esponente) (spd (pd di) (sn (mw Alleanza) (npro Nazionale))) (sn (mw Mirko) (nh Tremaglia))))))))))) (dirs :) (f3 (sn (art una) (n candidatura) (sc (q più) (sa (ppas subìta)) (sc (ccong che) (sa (ppas gradita))) (compt (spda (partda da) (sn (art la) (mw Lega) (npro Nord) (punt ,) (f2 (rel che) (fc (congf tuttavia) (f (ir_infl (vsupir dovrebbe) (vit rispettare)) (compt (sn (art gli) (n accordi))))))))))) (punto .))))', '(ROOT (f (sn (art l) (n ottimismo) (spd (pd di) (sn (nh Kantor)))) (ir_infl (vsupir potrebbe) (congf però) (vcl rivelarsi)) (compc (clit si) (sn (in ancora) (art una) (nt volta)) (sa (ag prematuro))) (punto .)))']
    with tsurgeon.Tsurgeon() as tsurgeon_processor:
        for (con_sentence, ud_sentence, expected_tree) in zip(con_sentences, ud_train_data.sentences, expected_trees):
            con_tree = convert_it_vit.raw_tree(con_sentence[1])
            (updated_tree, _) = convert_it_vit.update_mwts_and_special_cases(con_tree, ud_sentence, mwt_map, tsurgeon_processor)
            assert str(updated_tree) == expected_tree