[
    {
        "func_name": "test_pre_commit_hook_sync_reformat_code_and_markdown",
        "original": "@requires_pandoc\n@skip_pre_commit_tests_on_windows\n@skip_pre_commit_tests_when_jupytext_folder_is_not_a_git_repo\ndef test_pre_commit_hook_sync_reformat_code_and_markdown(tmpdir, cwd_tmpdir, tmp_repo, jupytext_repo_root, jupytext_repo_rev, notebook_with_outputs):\n    \"\"\"Here we sync the ipynb notebook with a py:percent file and also apply black and pandoc to reformat both\n    code and markdown cells.\n\n    Note: the new cell ids introduced in nbformat 5.1.0 are not yet supported by all the programs that treat\n    ipynb files. Consequently we pin the version of nbformat to 5.0.8 in all the environments below (and you\n    will have to do the same on the environment in which you edit the notebooks).\n    \"\"\"\n    pre_commit_config_yaml = f\"\\nrepos:\\n- repo: {jupytext_repo_root}\\n  rev: {jupytext_repo_rev}\\n  hooks:\\n  - id: jupytext\\n    args: [--sync, --pipe-fmt, ipynb, --pipe, 'pandoc --from ipynb --to ipynb --markdown-headings=atx', --show-changes]\\n    additional_dependencies:\\n    - nbformat==5.0.8  # because pandoc 2.11.4 does not preserve yet the new cell ids\\n  - id: jupytext\\n    args: [--sync, --pipe, black, --show-changes]\\n    additional_dependencies:\\n    - black==22.3.0  # Matches black hook below\\n    - nbformat==5.0.8  # for compatibility with the pandoc hook above\\n\\n- repo: https://github.com/psf/black\\n  rev: 22.3.0\\n  hooks:\\n  - id: black\\n\"\n    tmpdir.join('.pre-commit-config.yaml').write(pre_commit_config_yaml)\n    tmp_repo.git.add('.pre-commit-config.yaml')\n    pre_commit(['install', '--install-hooks', '-f'])\n    tmpdir.join('jupytext.toml').write('formats = \"ipynb,py:percent\"')\n    tmp_repo.git.add('jupytext.toml')\n    tmp_repo.index.commit('pair notebooks')\n    notebook = new_notebook(cells=[new_code_cell('1+1'), new_markdown_cell('This is a complex markdown cell\\n\\n# With a h1 header\\n## And a h2 header\\n\\n| And       | A  | Table |\\n| --------- | ---| ----- |\\n| 0         | 1  | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with\\nexplicit paragraph breaks (two spaces at the end of a line).\\n\\nAnd a VERY long line.\\n'.replace('VERY ', 'very ' * 51))], metadata=notebook_with_outputs.metadata)\n    notebook.nbformat = 4\n    notebook.nbformat_minor = 4\n    write(notebook, 'test.ipynb')\n    tmp_repo.git.add('test.ipynb')\n    with pytest.raises(HookExecutionError, match='files were modified by this hook'):\n        tmp_repo.index.commit('failing')\n    tmp_repo.git.add('test.ipynb')\n    tmp_repo.git.add('test.py')\n    tmp_repo.index.commit('passing')\n    assert 'test.ipynb' in tmp_repo.tree()\n    assert 'test.py' in tmp_repo.tree()\n    nb = read('test.ipynb')\n    assert nb.cells[0].source == '1 + 1'\n    print(nb.cells[1].source)\n    assert nb.cells[1].source == 'This is a complex markdown cell\\n\\n# With a h1 header\\n\\n## And a h2 header\\n\\n| And | A   | Table |\\n|-----|-----|-------|\\n| 0   | 1   | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with explicit paragraph\\nbreaks (two spaces at the end of a line).\\n\\nAnd a very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very long line.'",
        "mutated": [
            "@requires_pandoc\n@skip_pre_commit_tests_on_windows\n@skip_pre_commit_tests_when_jupytext_folder_is_not_a_git_repo\ndef test_pre_commit_hook_sync_reformat_code_and_markdown(tmpdir, cwd_tmpdir, tmp_repo, jupytext_repo_root, jupytext_repo_rev, notebook_with_outputs):\n    if False:\n        i = 10\n    'Here we sync the ipynb notebook with a py:percent file and also apply black and pandoc to reformat both\\n    code and markdown cells.\\n\\n    Note: the new cell ids introduced in nbformat 5.1.0 are not yet supported by all the programs that treat\\n    ipynb files. Consequently we pin the version of nbformat to 5.0.8 in all the environments below (and you\\n    will have to do the same on the environment in which you edit the notebooks).\\n    '\n    pre_commit_config_yaml = f\"\\nrepos:\\n- repo: {jupytext_repo_root}\\n  rev: {jupytext_repo_rev}\\n  hooks:\\n  - id: jupytext\\n    args: [--sync, --pipe-fmt, ipynb, --pipe, 'pandoc --from ipynb --to ipynb --markdown-headings=atx', --show-changes]\\n    additional_dependencies:\\n    - nbformat==5.0.8  # because pandoc 2.11.4 does not preserve yet the new cell ids\\n  - id: jupytext\\n    args: [--sync, --pipe, black, --show-changes]\\n    additional_dependencies:\\n    - black==22.3.0  # Matches black hook below\\n    - nbformat==5.0.8  # for compatibility with the pandoc hook above\\n\\n- repo: https://github.com/psf/black\\n  rev: 22.3.0\\n  hooks:\\n  - id: black\\n\"\n    tmpdir.join('.pre-commit-config.yaml').write(pre_commit_config_yaml)\n    tmp_repo.git.add('.pre-commit-config.yaml')\n    pre_commit(['install', '--install-hooks', '-f'])\n    tmpdir.join('jupytext.toml').write('formats = \"ipynb,py:percent\"')\n    tmp_repo.git.add('jupytext.toml')\n    tmp_repo.index.commit('pair notebooks')\n    notebook = new_notebook(cells=[new_code_cell('1+1'), new_markdown_cell('This is a complex markdown cell\\n\\n# With a h1 header\\n## And a h2 header\\n\\n| And       | A  | Table |\\n| --------- | ---| ----- |\\n| 0         | 1  | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with\\nexplicit paragraph breaks (two spaces at the end of a line).\\n\\nAnd a VERY long line.\\n'.replace('VERY ', 'very ' * 51))], metadata=notebook_with_outputs.metadata)\n    notebook.nbformat = 4\n    notebook.nbformat_minor = 4\n    write(notebook, 'test.ipynb')\n    tmp_repo.git.add('test.ipynb')\n    with pytest.raises(HookExecutionError, match='files were modified by this hook'):\n        tmp_repo.index.commit('failing')\n    tmp_repo.git.add('test.ipynb')\n    tmp_repo.git.add('test.py')\n    tmp_repo.index.commit('passing')\n    assert 'test.ipynb' in tmp_repo.tree()\n    assert 'test.py' in tmp_repo.tree()\n    nb = read('test.ipynb')\n    assert nb.cells[0].source == '1 + 1'\n    print(nb.cells[1].source)\n    assert nb.cells[1].source == 'This is a complex markdown cell\\n\\n# With a h1 header\\n\\n## And a h2 header\\n\\n| And | A   | Table |\\n|-----|-----|-------|\\n| 0   | 1   | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with explicit paragraph\\nbreaks (two spaces at the end of a line).\\n\\nAnd a very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very long line.'",
            "@requires_pandoc\n@skip_pre_commit_tests_on_windows\n@skip_pre_commit_tests_when_jupytext_folder_is_not_a_git_repo\ndef test_pre_commit_hook_sync_reformat_code_and_markdown(tmpdir, cwd_tmpdir, tmp_repo, jupytext_repo_root, jupytext_repo_rev, notebook_with_outputs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n    'Here we sync the ipynb notebook with a py:percent file and also apply black and pandoc to reformat both\\n    code and markdown cells.\\n\\n    Note: the new cell ids introduced in nbformat 5.1.0 are not yet supported by all the programs that treat\\n    ipynb files. Consequently we pin the version of nbformat to 5.0.8 in all the environments below (and you\\n    will have to do the same on the environment in which you edit the notebooks).\\n    '\n    pre_commit_config_yaml = f\"\\nrepos:\\n- repo: {jupytext_repo_root}\\n  rev: {jupytext_repo_rev}\\n  hooks:\\n  - id: jupytext\\n    args: [--sync, --pipe-fmt, ipynb, --pipe, 'pandoc --from ipynb --to ipynb --markdown-headings=atx', --show-changes]\\n    additional_dependencies:\\n    - nbformat==5.0.8  # because pandoc 2.11.4 does not preserve yet the new cell ids\\n  - id: jupytext\\n    args: [--sync, --pipe, black, --show-changes]\\n    additional_dependencies:\\n    - black==22.3.0  # Matches black hook below\\n    - nbformat==5.0.8  # for compatibility with the pandoc hook above\\n\\n- repo: https://github.com/psf/black\\n  rev: 22.3.0\\n  hooks:\\n  - id: black\\n\"\n    tmpdir.join('.pre-commit-config.yaml').write(pre_commit_config_yaml)\n    tmp_repo.git.add('.pre-commit-config.yaml')\n    pre_commit(['install', '--install-hooks', '-f'])\n    tmpdir.join('jupytext.toml').write('formats = \"ipynb,py:percent\"')\n    tmp_repo.git.add('jupytext.toml')\n    tmp_repo.index.commit('pair notebooks')\n    notebook = new_notebook(cells=[new_code_cell('1+1'), new_markdown_cell('This is a complex markdown cell\\n\\n# With a h1 header\\n## And a h2 header\\n\\n| And       | A  | Table |\\n| --------- | ---| ----- |\\n| 0         | 1  | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with\\nexplicit paragraph breaks (two spaces at the end of a line).\\n\\nAnd a VERY long line.\\n'.replace('VERY ', 'very ' * 51))], metadata=notebook_with_outputs.metadata)\n    notebook.nbformat = 4\n    notebook.nbformat_minor = 4\n    write(notebook, 'test.ipynb')\n    tmp_repo.git.add('test.ipynb')\n    with pytest.raises(HookExecutionError, match='files were modified by this hook'):\n        tmp_repo.index.commit('failing')\n    tmp_repo.git.add('test.ipynb')\n    tmp_repo.git.add('test.py')\n    tmp_repo.index.commit('passing')\n    assert 'test.ipynb' in tmp_repo.tree()\n    assert 'test.py' in tmp_repo.tree()\n    nb = read('test.ipynb')\n    assert nb.cells[0].source == '1 + 1'\n    print(nb.cells[1].source)\n    assert nb.cells[1].source == 'This is a complex markdown cell\\n\\n# With a h1 header\\n\\n## And a h2 header\\n\\n| And | A   | Table |\\n|-----|-----|-------|\\n| 0   | 1   | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with explicit paragraph\\nbreaks (two spaces at the end of a line).\\n\\nAnd a very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very long line.'",
            "@requires_pandoc\n@skip_pre_commit_tests_on_windows\n@skip_pre_commit_tests_when_jupytext_folder_is_not_a_git_repo\ndef test_pre_commit_hook_sync_reformat_code_and_markdown(tmpdir, cwd_tmpdir, tmp_repo, jupytext_repo_root, jupytext_repo_rev, notebook_with_outputs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n    'Here we sync the ipynb notebook with a py:percent file and also apply black and pandoc to reformat both\\n    code and markdown cells.\\n\\n    Note: the new cell ids introduced in nbformat 5.1.0 are not yet supported by all the programs that treat\\n    ipynb files. Consequently we pin the version of nbformat to 5.0.8 in all the environments below (and you\\n    will have to do the same on the environment in which you edit the notebooks).\\n    '\n    pre_commit_config_yaml = f\"\\nrepos:\\n- repo: {jupytext_repo_root}\\n  rev: {jupytext_repo_rev}\\n  hooks:\\n  - id: jupytext\\n    args: [--sync, --pipe-fmt, ipynb, --pipe, 'pandoc --from ipynb --to ipynb --markdown-headings=atx', --show-changes]\\n    additional_dependencies:\\n    - nbformat==5.0.8  # because pandoc 2.11.4 does not preserve yet the new cell ids\\n  - id: jupytext\\n    args: [--sync, --pipe, black, --show-changes]\\n    additional_dependencies:\\n    - black==22.3.0  # Matches black hook below\\n    - nbformat==5.0.8  # for compatibility with the pandoc hook above\\n\\n- repo: https://github.com/psf/black\\n  rev: 22.3.0\\n  hooks:\\n  - id: black\\n\"\n    tmpdir.join('.pre-commit-config.yaml').write(pre_commit_config_yaml)\n    tmp_repo.git.add('.pre-commit-config.yaml')\n    pre_commit(['install', '--install-hooks', '-f'])\n    tmpdir.join('jupytext.toml').write('formats = \"ipynb,py:percent\"')\n    tmp_repo.git.add('jupytext.toml')\n    tmp_repo.index.commit('pair notebooks')\n    notebook = new_notebook(cells=[new_code_cell('1+1'), new_markdown_cell('This is a complex markdown cell\\n\\n# With a h1 header\\n## And a h2 header\\n\\n| And       | A  | Table |\\n| --------- | ---| ----- |\\n| 0         | 1  | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with\\nexplicit paragraph breaks (two spaces at the end of a line).\\n\\nAnd a VERY long line.\\n'.replace('VERY ', 'very ' * 51))], metadata=notebook_with_outputs.metadata)\n    notebook.nbformat = 4\n    notebook.nbformat_minor = 4\n    write(notebook, 'test.ipynb')\n    tmp_repo.git.add('test.ipynb')\n    with pytest.raises(HookExecutionError, match='files were modified by this hook'):\n        tmp_repo.index.commit('failing')\n    tmp_repo.git.add('test.ipynb')\n    tmp_repo.git.add('test.py')\n    tmp_repo.index.commit('passing')\n    assert 'test.ipynb' in tmp_repo.tree()\n    assert 'test.py' in tmp_repo.tree()\n    nb = read('test.ipynb')\n    assert nb.cells[0].source == '1 + 1'\n    print(nb.cells[1].source)\n    assert nb.cells[1].source == 'This is a complex markdown cell\\n\\n# With a h1 header\\n\\n## And a h2 header\\n\\n| And | A   | Table |\\n|-----|-----|-------|\\n| 0   | 1   | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with explicit paragraph\\nbreaks (two spaces at the end of a line).\\n\\nAnd a very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very long line.'",
            "@requires_pandoc\n@skip_pre_commit_tests_on_windows\n@skip_pre_commit_tests_when_jupytext_folder_is_not_a_git_repo\ndef test_pre_commit_hook_sync_reformat_code_and_markdown(tmpdir, cwd_tmpdir, tmp_repo, jupytext_repo_root, jupytext_repo_rev, notebook_with_outputs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        n = 10\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n    'Here we sync the ipynb notebook with a py:percent file and also apply black and pandoc to reformat both\\n    code and markdown cells.\\n\\n    Note: the new cell ids introduced in nbformat 5.1.0 are not yet supported by all the programs that treat\\n    ipynb files. Consequently we pin the version of nbformat to 5.0.8 in all the environments below (and you\\n    will have to do the same on the environment in which you edit the notebooks).\\n    '\n    pre_commit_config_yaml = f\"\\nrepos:\\n- repo: {jupytext_repo_root}\\n  rev: {jupytext_repo_rev}\\n  hooks:\\n  - id: jupytext\\n    args: [--sync, --pipe-fmt, ipynb, --pipe, 'pandoc --from ipynb --to ipynb --markdown-headings=atx', --show-changes]\\n    additional_dependencies:\\n    - nbformat==5.0.8  # because pandoc 2.11.4 does not preserve yet the new cell ids\\n  - id: jupytext\\n    args: [--sync, --pipe, black, --show-changes]\\n    additional_dependencies:\\n    - black==22.3.0  # Matches black hook below\\n    - nbformat==5.0.8  # for compatibility with the pandoc hook above\\n\\n- repo: https://github.com/psf/black\\n  rev: 22.3.0\\n  hooks:\\n  - id: black\\n\"\n    tmpdir.join('.pre-commit-config.yaml').write(pre_commit_config_yaml)\n    tmp_repo.git.add('.pre-commit-config.yaml')\n    pre_commit(['install', '--install-hooks', '-f'])\n    tmpdir.join('jupytext.toml').write('formats = \"ipynb,py:percent\"')\n    tmp_repo.git.add('jupytext.toml')\n    tmp_repo.index.commit('pair notebooks')\n    notebook = new_notebook(cells=[new_code_cell('1+1'), new_markdown_cell('This is a complex markdown cell\\n\\n# With a h1 header\\n## And a h2 header\\n\\n| And       | A  | Table |\\n| --------- | ---| ----- |\\n| 0         | 1  | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with\\nexplicit paragraph breaks (two spaces at the end of a line).\\n\\nAnd a VERY long line.\\n'.replace('VERY ', 'very ' * 51))], metadata=notebook_with_outputs.metadata)\n    notebook.nbformat = 4\n    notebook.nbformat_minor = 4\n    write(notebook, 'test.ipynb')\n    tmp_repo.git.add('test.ipynb')\n    with pytest.raises(HookExecutionError, match='files were modified by this hook'):\n        tmp_repo.index.commit('failing')\n    tmp_repo.git.add('test.ipynb')\n    tmp_repo.git.add('test.py')\n    tmp_repo.index.commit('passing')\n    assert 'test.ipynb' in tmp_repo.tree()\n    assert 'test.py' in tmp_repo.tree()\n    nb = read('test.ipynb')\n    assert nb.cells[0].source == '1 + 1'\n    print(nb.cells[1].source)\n    assert nb.cells[1].source == 'This is a complex markdown cell\\n\\n# With a h1 header\\n\\n## And a h2 header\\n\\n| And | A   | Table |\\n|-----|-----|-------|\\n| 0   | 1   | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with explicit paragraph\\nbreaks (two spaces at the end of a line).\\n\\nAnd a very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very long line.'",
            "@requires_pandoc\n@skip_pre_commit_tests_on_windows\n@skip_pre_commit_tests_when_jupytext_folder_is_not_a_git_repo\ndef test_pre_commit_hook_sync_reformat_code_and_markdown(tmpdir, cwd_tmpdir, tmp_repo, jupytext_repo_root, jupytext_repo_rev, notebook_with_outputs):\n    if False:\n        i = 10\n        while True:\n            print('Mutation')\n        dp = [0, 1]\n        for i in range(2, n + 1):\n            dp.append(dp[i - 1] + dp[i - 2])\n        print(dp[n])\n\n        def dfs(node):\n            if node == None:\n                return []\n            left = dfs(node.left)\n            right = dfs(node.right)\n        length = 15\n        if length <= 0:\n            return []\n        elif length == 1:\n            return [0]\n        sequence = [0, 1]\n        while len(sequence) < length:\n            next_value = sequence[-1] + sequence[-2]\n            sequence.append(next_value)\n        return sequence\n    'Here we sync the ipynb notebook with a py:percent file and also apply black and pandoc to reformat both\\n    code and markdown cells.\\n\\n    Note: the new cell ids introduced in nbformat 5.1.0 are not yet supported by all the programs that treat\\n    ipynb files. Consequently we pin the version of nbformat to 5.0.8 in all the environments below (and you\\n    will have to do the same on the environment in which you edit the notebooks).\\n    '\n    pre_commit_config_yaml = f\"\\nrepos:\\n- repo: {jupytext_repo_root}\\n  rev: {jupytext_repo_rev}\\n  hooks:\\n  - id: jupytext\\n    args: [--sync, --pipe-fmt, ipynb, --pipe, 'pandoc --from ipynb --to ipynb --markdown-headings=atx', --show-changes]\\n    additional_dependencies:\\n    - nbformat==5.0.8  # because pandoc 2.11.4 does not preserve yet the new cell ids\\n  - id: jupytext\\n    args: [--sync, --pipe, black, --show-changes]\\n    additional_dependencies:\\n    - black==22.3.0  # Matches black hook below\\n    - nbformat==5.0.8  # for compatibility with the pandoc hook above\\n\\n- repo: https://github.com/psf/black\\n  rev: 22.3.0\\n  hooks:\\n  - id: black\\n\"\n    tmpdir.join('.pre-commit-config.yaml').write(pre_commit_config_yaml)\n    tmp_repo.git.add('.pre-commit-config.yaml')\n    pre_commit(['install', '--install-hooks', '-f'])\n    tmpdir.join('jupytext.toml').write('formats = \"ipynb,py:percent\"')\n    tmp_repo.git.add('jupytext.toml')\n    tmp_repo.index.commit('pair notebooks')\n    notebook = new_notebook(cells=[new_code_cell('1+1'), new_markdown_cell('This is a complex markdown cell\\n\\n# With a h1 header\\n## And a h2 header\\n\\n| And       | A  | Table |\\n| --------- | ---| ----- |\\n| 0         | 1  | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with\\nexplicit paragraph breaks (two spaces at the end of a line).\\n\\nAnd a VERY long line.\\n'.replace('VERY ', 'very ' * 51))], metadata=notebook_with_outputs.metadata)\n    notebook.nbformat = 4\n    notebook.nbformat_minor = 4\n    write(notebook, 'test.ipynb')\n    tmp_repo.git.add('test.ipynb')\n    with pytest.raises(HookExecutionError, match='files were modified by this hook'):\n        tmp_repo.index.commit('failing')\n    tmp_repo.git.add('test.ipynb')\n    tmp_repo.git.add('test.py')\n    tmp_repo.index.commit('passing')\n    assert 'test.ipynb' in tmp_repo.tree()\n    assert 'test.py' in tmp_repo.tree()\n    nb = read('test.ipynb')\n    assert nb.cells[0].source == '1 + 1'\n    print(nb.cells[1].source)\n    assert nb.cells[1].source == 'This is a complex markdown cell\\n\\n# With a h1 header\\n\\n## And a h2 header\\n\\n| And | A   | Table |\\n|-----|-----|-------|\\n| 0   | 1   | 2     |\\n\\n!!!WARNING!!! This hook does not seem compatible with explicit paragraph\\nbreaks (two spaces at the end of a line).\\n\\nAnd a very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very very very very very\\nvery very very very very very very very very very long line.'"
        ]
    }
]