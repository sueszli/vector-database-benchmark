import pytest
import stanza
from stanza.tests import *
from stanza.utils.datasets import prepare_tokenizer_treebank
pytestmark = [pytest.mark.travis, pytest.mark.pipeline]

def test_has_space_after_no():
    if False:
        return 10
    assert prepare_tokenizer_treebank.has_space_after_no('SpaceAfter=No')
    assert prepare_tokenizer_treebank.has_space_after_no('UnbanMoxOpal=Yes|SpaceAfter=No')
    assert prepare_tokenizer_treebank.has_space_after_no('SpaceAfter=No|UnbanMoxOpal=Yes')
    assert not prepare_tokenizer_treebank.has_space_after_no('SpaceAfter=Yes')
    assert not prepare_tokenizer_treebank.has_space_after_no('CorrectSpaceAfter=No')
    assert not prepare_tokenizer_treebank.has_space_after_no('_')

def test_add_space_after_no():
    if False:
        while True:
            i = 10
    assert prepare_tokenizer_treebank.add_space_after_no('_') == 'SpaceAfter=No'
    assert prepare_tokenizer_treebank.add_space_after_no('MoxOpal=Unban') == 'MoxOpal=Unban|SpaceAfter=No'
    with pytest.raises(ValueError):
        prepare_tokenizer_treebank.add_space_after_no('SpaceAfter=No')

def test_remove_space_after_no():
    if False:
        for i in range(10):
            print('nop')
    assert prepare_tokenizer_treebank.remove_space_after_no('SpaceAfter=No') == '_'
    assert prepare_tokenizer_treebank.remove_space_after_no('SpaceAfter=No|MoxOpal=Unban') == 'MoxOpal=Unban'
    assert prepare_tokenizer_treebank.remove_space_after_no('MoxOpal=Unban|SpaceAfter=No') == 'MoxOpal=Unban'
    with pytest.raises(ValueError):
        prepare_tokenizer_treebank.remove_space_after_no('_')

def read_test_doc(doc):
    if False:
        for i in range(10):
            print('nop')
    sentences = [x.strip().split('\n') for x in doc.split('\n\n')]
    return sentences
SPANISH_QM_TEST_CASE = '\n# sent_id = train-s7914\n# text = ¿Cómo explicarles entonces que el mar tiene varios dueños y que a partir de la frontera de aquella ola el pescado ya no es tuyo?.\n# orig_file_sentence 080#14\n# this sentence will have the intiial ¿ removed.  an MWT should be preserved\n1\t¿\t¿\tPUNCT\t_\tPunctSide=Ini|PunctType=Qest\t3\tpunct\t_\tSpaceAfter=No\n2\tCómo\tcómo\tPRON\t_\tPronType=Ind\t3\tobl\t_\t_\n3-4\texplicarles\t_\t_\t_\t_\t_\t_\t_\t_\n3\texplicar\texplicar\tVERB\t_\tVerbForm=Inf\t0\troot\t_\t_\n4\tles\tél\tPRON\t_\tCase=Dat|Number=Plur|Person=3|PronType=Prs\t3\tobj\t_\t_\n5\tentonces\tentonces\tADV\t_\t_\t3\tadvmod\t_\t_\n6\tque\tque\tSCONJ\t_\t_\t9\tmark\t_\t_\n7\tel\tel\tDET\t_\tDefinite=Def|Gender=Masc|Number=Sing|PronType=Art\t8\tdet\t_\t_\n8\tmar\tmar\tNOUN\t_\tNumber=Sing\t9\tnsubj\t_\t_\n9\ttiene\ttener\tVERB\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t3\tccomp\t_\t_\n10\tvarios\tvarios\tDET\t_\tGender=Masc|Number=Plur|PronType=Ind\t11\tdet\t_\t_\n11\tdueños\tdueño\tNOUN\t_\tGender=Masc|Number=Plur\t9\tobj\t_\t_\n12\ty\ty\tCCONJ\t_\t_\t27\tcc\t_\t_\n13\tque\tque\tSCONJ\t_\t_\t27\tmark\t_\t_\n14\ta\ta\tADP\t_\t_\t18\tcase\t_\tMWE=a_partir_de|MWEPOS=ADP\n15\tpartir\tpartir\tNOUN\t_\t_\t14\tfixed\t_\t_\n16\tde\tde\tADP\t_\t_\t14\tfixed\t_\t_\n17\tla\tel\tDET\t_\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t18\tdet\t_\t_\n18\tfrontera\tfrontera\tNOUN\t_\tGender=Fem|Number=Sing\t27\tobl\t_\t_\n19\tde\tde\tADP\t_\t_\t21\tcase\t_\t_\n20\taquella\taquel\tDET\t_\tGender=Fem|Number=Sing|PronType=Dem\t21\tdet\t_\t_\n21\tola\tola\tNOUN\t_\tGender=Fem|Number=Sing\t18\tnmod\t_\t_\n22\tel\tel\tDET\t_\tDefinite=Def|Gender=Masc|Number=Sing|PronType=Art\t23\tdet\t_\t_\n23\tpescado\tpescado\tNOUN\t_\tGender=Masc|Number=Sing\t27\tnsubj\t_\t_\n24\tya\tya\tADV\t_\t_\t27\tadvmod\t_\t_\n25\tno\tno\tADV\t_\tPolarity=Neg\t27\tadvmod\t_\t_\n26\tes\tser\tAUX\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t27\tcop\t_\t_\n27\ttuyo\ttuyo\tPRON\t_\tGender=Masc|Number=Sing|Number[psor]=Sing|Person=2|Poss=Yes|PronType=Ind\t9\tconj\t_\tSpaceAfter=No\n28\t?\t?\tPUNCT\t_\tPunctSide=Fin|PunctType=Qest\t3\tpunct\t_\tSpaceAfter=No\n29\t.\t.\tPUNCT\t_\tPunctType=Peri\t3\tpunct\t_\t_\n\n# sent_id = train-s8516\n# text = ¿ Pero es divertido en la vida real? - -.\n# orig_file_sentence 086#16\n# this sentence will have the ¿ removed even with no SpaceAfter=No\n1\t¿\t¿\tPUNCT\t_\tPunctSide=Ini|PunctType=Qest\t4\tpunct\t_\t_\n2\tPero\tpero\tCCONJ\t_\t_\t4\tadvmod\t_\t_\n3\tes\tser\tAUX\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t4\tcop\t_\t_\n4\tdivertido\tdivertido\tADJ\t_\tGender=Masc|Number=Sing|VerbForm=Part\t0\troot\t_\t_\n5\ten\ten\tADP\t_\t_\t7\tcase\t_\t_\n6\tla\tel\tDET\t_\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t7\tdet\t_\t_\n7\tvida\tvida\tNOUN\t_\tGender=Fem|Number=Sing\t4\tobl\t_\t_\n8\treal\treal\tADJ\t_\tNumber=Sing\t7\tamod\t_\tSpaceAfter=No\n9\t?\t?\tPUNCT\t_\tPunctSide=Fin|PunctType=Qest\t4\tpunct\t_\t_\n10\t-\t-\tPUNCT\t_\tPunctType=Dash\t4\tpunct\t_\t_\n11\t-\t-\tPUNCT\t_\tPunctType=Dash\t4\tpunct\t_\tSpaceAfter=No\n12\t.\t.\tPUNCT\t_\tPunctType=Peri\t4\tpunct\t_\t_\n\n# sent_id = train-s2337\n# text = Es imposible.\n# orig_file_sentence 024#37\n# Also included is a sentence which should be skipped (note that it does not show up in the expected result)\n1\tEs\tser\tAUX\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t2\tcop\t_\t_\n2\timposible\timposible\tADJ\t_\tNumber=Sing\t0\troot\t_\tSpaceAfter=No\n3\t.\t.\tPUNCT\t_\tPunctType=Peri\t2\tpunct\t_\t_\n\n# sent_id = 3LB-CAST-a1-2-s6\n# text = ¿Para qué seguir?\n# orig_file_sentence 006#22\n# The treebank now includes basic dependencies in the additional dependencies column\n1\t¿\t¿\tPUNCT\tfia\tPunctSide=Ini|PunctType=Qest\t4\tpunct\t4:punct\tSpaceAfter=No\n2\tPara\tpara\tADP\tsps00\t_\t3\tcase\t3:case\t_\n3\tqué\tqué\tPRON\tpt0cs000\tNumber=Sing|PronType=Int,Rel\t4\tobl\t4:obl\t_\n4\tseguir\tseguir\tVERB\tvmn0000\tVerbForm=Inf\t0\troot\t0:root\tSpaceAfter=No\n5\t?\t?\tPUNCT\tfit\tPunctSide=Fin|PunctType=Qest\t4\tpunct\t4:punct\t_\n\n# sent_id = CESS-CAST-P-19990901-16-s19\n# text = ¿Estará fingiendo?.\n# orig_file_sentence 097#24\n# also it includes some copy nodes\n1\t¿\t¿\tPUNCT\tfia\tPunctSide=Ini|PunctType=Qest\t3\tpunct\t3:punct\tSpaceAfter=No\n2\tEstará\testar\tAUX\tvmif3s0\tMood=Ind|Number=Sing|Person=3|Tense=Fut|VerbForm=Fin\t3\taux\t3:aux\t_\n3\tfingiendo\tfingir\tVERB\tvmg0000\tVerbForm=Ger\t0\troot\t0:root\tSpaceAfter=No\n3.1\t_\t_\tPRON\tp\t_\t_\t_\t3:nsubj\tEntity=(CESSCASTP1999090116c2-person-1-CorefType:ident,gstype:spec)\n4\t?\t?\tPUNCT\tfit\tPunctSide=Fin|PunctType=Qest\t3\tpunct\t3:punct\tSpaceAfter=No\n5\t.\t.\tPUNCT\tfp\tPunctType=Peri\t3\tpunct\t3:punct\t_\n\n# sent_id = CESS-CAST-P-20000401-126-s31\n# text = ¿Qué pensó cuando se quedó\n# orig_file_sentence 087#37\n# this one has a colon in the dependency name\n1\t¿\t¿\tPUNCT\tfia\tPunctSide=Ini|PunctType=Qest\t3\tpunct\t3:punct\tSpaceAfter=No|Entity=(CESSCASTP20000401126c27--3\n2\tQué\tqué\tPRON\tpt0cs000\tNumber=Sing|PronType=Int,Rel\t3\tobj\t3:obj\t_\n3\tpensó\tpensar\tVERB\tvmis3s0\tMood=Ind|Number=Sing|Person=3|Tense=Past|VerbForm=Fin\t0\troot\t0:root\t_\n3.1\t_\t_\tPRON\tp\t_\t_\t_\t3:nsubj\tEntity=(CESSCASTP20000401126c1-person-1-CorefType:ident,gstype:spec)\n4\tcuando\tcuando\tSCONJ\tcs\t_\t6\tmark\t6:mark\t_\n4.1\t_\t_\tPRON\tp\t_\t_\t_\t6:nsubj\tEntity=(CESSCASTP20000401126c1-person-1-CorefType:ident,gstype:spec)\n5\tse\tél\tPRON\tp0300000\tCase=Acc|Person=3|PrepCase=Npr|PronType=Prs|Reflex=Yes\t6\texpl:pv\t6:expl:pv\t_\n6\tquedó\tquedar\tVERB\tvmis3s0\tMood=Ind|Number=Sing|Person=3|Tense=Past|VerbForm=Fin\t3\tadvcl\t3:advcl\t_\n'
SPANISH_QM_RESULT = '\n# sent_id = train-s7914\n# text = Cómo explicarles entonces que el mar tiene varios dueños y que a partir de la frontera de aquella ola el pescado ya no es tuyo?.\n# orig_file_sentence 080#14\n# this sentence will have the intiial ¿ removed.  an MWT should be preserved\n1\tCómo\tcómo\tPRON\t_\tPronType=Ind\t2\tobl\t_\t_\n2-3\texplicarles\t_\t_\t_\t_\t_\t_\t_\t_\n2\texplicar\texplicar\tVERB\t_\tVerbForm=Inf\t0\troot\t_\t_\n3\tles\tél\tPRON\t_\tCase=Dat|Number=Plur|Person=3|PronType=Prs\t2\tobj\t_\t_\n4\tentonces\tentonces\tADV\t_\t_\t2\tadvmod\t_\t_\n5\tque\tque\tSCONJ\t_\t_\t8\tmark\t_\t_\n6\tel\tel\tDET\t_\tDefinite=Def|Gender=Masc|Number=Sing|PronType=Art\t7\tdet\t_\t_\n7\tmar\tmar\tNOUN\t_\tNumber=Sing\t8\tnsubj\t_\t_\n8\ttiene\ttener\tVERB\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t2\tccomp\t_\t_\n9\tvarios\tvarios\tDET\t_\tGender=Masc|Number=Plur|PronType=Ind\t10\tdet\t_\t_\n10\tdueños\tdueño\tNOUN\t_\tGender=Masc|Number=Plur\t8\tobj\t_\t_\n11\ty\ty\tCCONJ\t_\t_\t26\tcc\t_\t_\n12\tque\tque\tSCONJ\t_\t_\t26\tmark\t_\t_\n13\ta\ta\tADP\t_\t_\t17\tcase\t_\tMWE=a_partir_de|MWEPOS=ADP\n14\tpartir\tpartir\tNOUN\t_\t_\t13\tfixed\t_\t_\n15\tde\tde\tADP\t_\t_\t13\tfixed\t_\t_\n16\tla\tel\tDET\t_\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t17\tdet\t_\t_\n17\tfrontera\tfrontera\tNOUN\t_\tGender=Fem|Number=Sing\t26\tobl\t_\t_\n18\tde\tde\tADP\t_\t_\t20\tcase\t_\t_\n19\taquella\taquel\tDET\t_\tGender=Fem|Number=Sing|PronType=Dem\t20\tdet\t_\t_\n20\tola\tola\tNOUN\t_\tGender=Fem|Number=Sing\t17\tnmod\t_\t_\n21\tel\tel\tDET\t_\tDefinite=Def|Gender=Masc|Number=Sing|PronType=Art\t22\tdet\t_\t_\n22\tpescado\tpescado\tNOUN\t_\tGender=Masc|Number=Sing\t26\tnsubj\t_\t_\n23\tya\tya\tADV\t_\t_\t26\tadvmod\t_\t_\n24\tno\tno\tADV\t_\tPolarity=Neg\t26\tadvmod\t_\t_\n25\tes\tser\tAUX\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t26\tcop\t_\t_\n26\ttuyo\ttuyo\tPRON\t_\tGender=Masc|Number=Sing|Number[psor]=Sing|Person=2|Poss=Yes|PronType=Ind\t8\tconj\t_\tSpaceAfter=No\n27\t?\t?\tPUNCT\t_\tPunctSide=Fin|PunctType=Qest\t2\tpunct\t_\tSpaceAfter=No\n28\t.\t.\tPUNCT\t_\tPunctType=Peri\t2\tpunct\t_\t_\n\n# sent_id = train-s8516\n# text = Pero es divertido en la vida real? - -.\n# orig_file_sentence 086#16\n# this sentence will have the ¿ removed even with no SpaceAfter=No\n1\tPero\tpero\tCCONJ\t_\t_\t3\tadvmod\t_\t_\n2\tes\tser\tAUX\t_\tMood=Ind|Number=Sing|Person=3|Tense=Pres|VerbForm=Fin\t3\tcop\t_\t_\n3\tdivertido\tdivertido\tADJ\t_\tGender=Masc|Number=Sing|VerbForm=Part\t0\troot\t_\t_\n4\ten\ten\tADP\t_\t_\t6\tcase\t_\t_\n5\tla\tel\tDET\t_\tDefinite=Def|Gender=Fem|Number=Sing|PronType=Art\t6\tdet\t_\t_\n6\tvida\tvida\tNOUN\t_\tGender=Fem|Number=Sing\t3\tobl\t_\t_\n7\treal\treal\tADJ\t_\tNumber=Sing\t6\tamod\t_\tSpaceAfter=No\n8\t?\t?\tPUNCT\t_\tPunctSide=Fin|PunctType=Qest\t3\tpunct\t_\t_\n9\t-\t-\tPUNCT\t_\tPunctType=Dash\t3\tpunct\t_\t_\n10\t-\t-\tPUNCT\t_\tPunctType=Dash\t3\tpunct\t_\tSpaceAfter=No\n11\t.\t.\tPUNCT\t_\tPunctType=Peri\t3\tpunct\t_\t_\n\n# sent_id = 3LB-CAST-a1-2-s6\n# text = Para qué seguir?\n# orig_file_sentence 006#22\n# The treebank now includes basic dependencies in the additional dependencies column\n1\tPara\tpara\tADP\tsps00\t_\t2\tcase\t2:case\t_\n2\tqué\tqué\tPRON\tpt0cs000\tNumber=Sing|PronType=Int,Rel\t3\tobl\t3:obl\t_\n3\tseguir\tseguir\tVERB\tvmn0000\tVerbForm=Inf\t0\troot\t0:root\tSpaceAfter=No\n4\t?\t?\tPUNCT\tfit\tPunctSide=Fin|PunctType=Qest\t3\tpunct\t3:punct\t_\n\n# sent_id = CESS-CAST-P-19990901-16-s19\n# text = Estará fingiendo?.\n# orig_file_sentence 097#24\n# also it includes some copy nodes\n1\tEstará\testar\tAUX\tvmif3s0\tMood=Ind|Number=Sing|Person=3|Tense=Fut|VerbForm=Fin\t2\taux\t2:aux\t_\n2\tfingiendo\tfingir\tVERB\tvmg0000\tVerbForm=Ger\t0\troot\t0:root\tSpaceAfter=No\n2.1\t_\t_\tPRON\tp\t_\t_\t_\t2:nsubj\tEntity=(CESSCASTP1999090116c2-person-1-CorefType:ident,gstype:spec)\n3\t?\t?\tPUNCT\tfit\tPunctSide=Fin|PunctType=Qest\t2\tpunct\t2:punct\tSpaceAfter=No\n4\t.\t.\tPUNCT\tfp\tPunctType=Peri\t2\tpunct\t2:punct\t_\n\n# sent_id = CESS-CAST-P-20000401-126-s31\n# text = Qué pensó cuando se quedó\n# orig_file_sentence 087#37\n# this one has a colon in the dependency name\n1\tQué\tqué\tPRON\tpt0cs000\tNumber=Sing|PronType=Int,Rel\t2\tobj\t2:obj\t_\n2\tpensó\tpensar\tVERB\tvmis3s0\tMood=Ind|Number=Sing|Person=3|Tense=Past|VerbForm=Fin\t0\troot\t0:root\t_\n2.1\t_\t_\tPRON\tp\t_\t_\t_\t2:nsubj\tEntity=(CESSCASTP20000401126c1-person-1-CorefType:ident,gstype:spec)\n3\tcuando\tcuando\tSCONJ\tcs\t_\t5\tmark\t5:mark\t_\n3.1\t_\t_\tPRON\tp\t_\t_\t_\t5:nsubj\tEntity=(CESSCASTP20000401126c1-person-1-CorefType:ident,gstype:spec)\n4\tse\tél\tPRON\tp0300000\tCase=Acc|Person=3|PrepCase=Npr|PronType=Prs|Reflex=Yes\t5\texpl:pv\t5:expl:pv\t_\n5\tquedó\tquedar\tVERB\tvmis3s0\tMood=Ind|Number=Sing|Person=3|Tense=Past|VerbForm=Fin\t2\tadvcl\t2:advcl\t_\n'

def test_augment_initial_punct():
    if False:
        for i in range(10):
            print('nop')
    doc = read_test_doc(SPANISH_QM_TEST_CASE)
    doc2 = prepare_tokenizer_treebank.augment_initial_punct(doc, ratio=1.0)
    expected = doc + read_test_doc(SPANISH_QM_RESULT)
    assert doc2 == expected
SPANISH_SHOULD_THROW = '\n# sent_id = 3LB-CAST-a1-2-s6\n# text = ¿Para qué seguir?\n# orig_file_sentence 006#22\n# multiple heads are not handled yet in the augmented dependencies column\n1\t¿\t¿\tPUNCT\tfia\tPunctSide=Ini|PunctType=Qest\t4\tpunct\t4:punct\tSpaceAfter=No\n2\tPara\tpara\tADP\tsps00\t_\t3\tcase\t3:case\t_\n3\tqué\tqué\tPRON\tpt0cs000\tNumber=Sing|PronType=Int,Rel\t4\tobl\t4:obl,3:foo\t_\n4\tseguir\tseguir\tVERB\tvmn0000\tVerbForm=Inf\t0\troot\t0:root\tSpaceAfter=No\n5\t?\t?\tPUNCT\tfit\tPunctSide=Fin|PunctType=Qest\t4\tpunct\t4:punct\t_\n'

def test_augment_initial_punct_error():
    if False:
        return 10
    '\n    The augment script should protect against the single dependency assumption changing in the future\n    '
    doc = read_test_doc(SPANISH_SHOULD_THROW)
    with pytest.raises(NotImplementedError):
        doc2 = prepare_tokenizer_treebank.augment_initial_punct(doc, ratio=1.0)
ARABIC_SPACE_AFTER_TEST_CASE = '\n# newpar id = afp.20000815.0079:p6\n# sent_id = afp.20000815.0079:p6u1\n# text = وتتميز امسية الاربعاء الدولية باقامة 16 مباراة ودية.\n# orig_file_sentence AFP_ARB_20000815.0079#6\n1-2\tوتتميز\t_\t_\t_\t_\t_\t_\t_\t_\n1\tو\tوَ\tCCONJ\tC---------\t_\t0\troot\t0:root\tVform=وَ|Gloss=and|Root=wa|Translit=wa|LTranslit=wa\n2\tتتميز\tتَمَيَّز\tVERB\tVIIA-3FS--\tAspect=Imp|Gender=Fem|Mood=Ind|Number=Sing|Person=3|VerbForm=Fin|Voice=Act\t1\tparataxis\t1:parataxis\tVform=تَتَمَيَّزُ|Gloss=be_distinguished,stand_out,discern,distinguish|Root=m_y_z|Translit=tatamayyazu|LTranslit=tamayyaz\n3\tامسية\tأُمسِيَّة\tNOUN\tN------S1R\tCase=Nom|Definite=Cons|Number=Sing\t2\tnsubj\t2:nsubj\tVform=أُمسِيَّةُ|Gloss=evening,soiree|Root=m_s_w|Translit=ʾumsīyatu|LTranslit=ʾumsīyat\n4\tالاربعاء\tأَربِعَاء\tNOUN\tN------S2D\tCase=Gen|Definite=Def|Number=Sing\t3\tnmod\t3:nmod:gen\tVform=اَلأَربِعَاءِ|Gloss=Wednesday|Root=r_b_`|Translit=al-ʾarbiʿāʾi|LTranslit=ʾarbiʿāʾ\n5\tالدولية\tدُوَلِيّ\tADJ\tA-----FS1D\tCase=Nom|Definite=Def|Gender=Fem|Number=Sing\t3\tamod\t3:amod\tVform=اَلدُّوَلِيَّةُ|Gloss=international,world|Root=d_w_l|Translit=ad-duwalīyatu|LTranslit=duwalīy\n6-7\tباقامة\t_\t_\t_\t_\t_\t_\t_\t_\n6\tب\tبِ\tADP\tP---------\tAdpType=Prep\t7\tcase\t7:case\tVform=بِ|Gloss=by,with|Root=bi|Translit=bi|LTranslit=bi\n7\tإقامة\tإِقَامَة\tNOUN\tN------S2R\tCase=Gen|Definite=Cons|Number=Sing\t2\tobl\t2:obl:بِ:gen\tVform=إِقَامَةِ|Gloss=residency,setting_up|Root=q_w_m|Translit=ʾiqāmati|LTranslit=ʾiqāmat\n8\t16\t16\tNUM\tQ---------\tNumForm=Digit\t7\tnummod\t7:nummod\tVform=١٦|Translit=16\n9\tمباراة\tمُبَارَاة\tNOUN\tN------S4I\tCase=Acc|Definite=Ind|Number=Sing\t8\tnmod\t8:nmod:acc\tVform=مُبَارَاةً|Gloss=match,game,competition|Root=b_r_y|Translit=mubārātan|LTranslit=mubārāt\n10\tودية\tوُدِّيّ\tADJ\tA-----FS4I\tCase=Acc|Definite=Ind|Gender=Fem|Number=Sing\t9\tamod\t9:amod\tSpaceAfter=No|Vform=وُدِّيَّةً|Gloss=friendly,amicable|Root=w_d_d|Translit=wuddīyatan|LTranslit=wuddīy\n11\t.\t.\tPUNCT\tG---------\t_\t1\tpunct\t1:punct\tVform=.|Translit=.\n\n# newdoc id = afp.20000715.0075\n# newpar id = afp.20000715.0075:p1\n# sent_id = afp.20000715.0075:p1u1\n# text = برلين ترفض حصول شركة اميركية على رخصة تصنيع دبابة "ليوبارد" الالمانية\n# orig_file_sentence AFP_ARB_20000715.0075#1\n1\tبرلين\tبَرلِين\tX\tX---------\tForeign=Yes\t2\tnsubj\t2:nsubj\tVform=بَرلِين|Gloss=Berlin|Root=barlIn|Translit=barlīn|LTranslit=barlīn\n2\tترفض\tرَفَض\tVERB\tVIIA-3FS--\tAspect=Imp|Gender=Fem|Mood=Ind|Number=Sing|Person=3|VerbForm=Fin|Voice=Act\t0\troot\t0:root\tVform=تَرفُضُ|Gloss=reject,refuse|Root=r_f_.d|Translit=tarfuḍu|LTranslit=rafaḍ\n3\tحصول\tحُصُول\tNOUN\tN------S4R\tCase=Acc|Definite=Cons|Number=Sing\t2\tobj\t2:obj\tVform=حُصُولَ|Gloss=acquisition,obtaining,occurrence,happening|Root=.h_.s_l|Translit=ḥuṣūla|LTranslit=ḥuṣūl\n4\tشركة\tشَرِكَة\tNOUN\tN------S2I\tCase=Gen|Definite=Ind|Number=Sing\t3\tnmod\t3:nmod:gen\tVform=شَرِكَةٍ|Gloss=company,corporation|Root=^s_r_k|Translit=šarikatin|LTranslit=šarikat\n5\tاميركية\tأَمِيرِكِيّ\tADJ\tA-----FS2I\tCase=Gen|Definite=Ind|Gender=Fem|Number=Sing\t4\tamod\t4:amod\tVform=أَمِيرِكِيَّةٍ|Gloss=American|Root=\'amIrik|Translit=ʾamīrikīyatin|LTranslit=ʾamīrikīy\n6\tعلى\tعَلَى\tADP\tP---------\tAdpType=Prep\t7\tcase\t7:case\tVform=عَلَى|Gloss=on,above|Root=`_l_w|Translit=ʿalā|LTranslit=ʿalā\n7\tرخصة\tرُخصَة\tNOUN\tN------S2R\tCase=Gen|Definite=Cons|Number=Sing\t3\tobl:arg\t3:obl:arg:عَلَى:gen\tVform=رُخصَةِ|Gloss=license,permit|Root=r__h_.s|Translit=ruḫṣati|LTranslit=ruḫṣat\n8\tتصنيع\tتَصنِيع\tNOUN\tN------S2R\tCase=Gen|Definite=Cons|Number=Sing\t7\tnmod\t7:nmod:gen\tVform=تَصنِيعِ|Gloss=fabrication,industrialization,processing|Root=.s_n_`|Translit=taṣnīʿi|LTranslit=taṣnīʿ\n9\tدبابة\tدَبَّابَة\tNOUN\tN------S2R\tCase=Gen|Definite=Cons|Number=Sing\t8\tnmod\t8:nmod:gen\tVform=دَبَّابَةِ|Gloss=tank|Root=d_b_b|Translit=dabbābati|LTranslit=dabbābat\n10\t"\t"\tPUNCT\tG---------\t_\t11\tpunct\t11:punct\tSpaceAfter=No|Vform="|Translit="\n11\tليوبارد\tلِيُوبَارد\tX\tX---------\tForeign=Yes\t9\tnmod\t9:nmod\tSpaceAfter=No|Vform=لِيُوبَارد|Gloss=Leopard|Root=liyUbArd|Translit=liyūbārd|LTranslit=liyūbārd\n12\t"\t"\tPUNCT\tG---------\t_\t11\tpunct\t11:punct\tVform="|Translit="\n13\tالالمانية\tأَلمَانِيّ\tADJ\tA-----FS2D\tCase=Gen|Definite=Def|Gender=Fem|Number=Sing\t9\tamod\t9:amod\tVform=اَلأَلمَانِيَّةِ|Gloss=German|Root=\'almAn|Translit=al-ʾalmānīyati|LTranslit=ʾalmānīy\n'
ARABIC_SPACE_AFTER_RESULT = '\n# newpar id = afp.20000815.0079:p6\n# sent_id = afp.20000815.0079:p6u1\n# text = وتتميز امسية الاربعاء الدولية باقامة 16 مباراة ودية .\n# orig_file_sentence AFP_ARB_20000815.0079#6\n1-2\tوتتميز\t_\t_\t_\t_\t_\t_\t_\t_\n1\tو\tوَ\tCCONJ\tC---------\t_\t0\troot\t0:root\tVform=وَ|Gloss=and|Root=wa|Translit=wa|LTranslit=wa\n2\tتتميز\tتَمَيَّز\tVERB\tVIIA-3FS--\tAspect=Imp|Gender=Fem|Mood=Ind|Number=Sing|Person=3|VerbForm=Fin|Voice=Act\t1\tparataxis\t1:parataxis\tVform=تَتَمَيَّزُ|Gloss=be_distinguished,stand_out,discern,distinguish|Root=m_y_z|Translit=tatamayyazu|LTranslit=tamayyaz\n3\tامسية\tأُمسِيَّة\tNOUN\tN------S1R\tCase=Nom|Definite=Cons|Number=Sing\t2\tnsubj\t2:nsubj\tVform=أُمسِيَّةُ|Gloss=evening,soiree|Root=m_s_w|Translit=ʾumsīyatu|LTranslit=ʾumsīyat\n4\tالاربعاء\tأَربِعَاء\tNOUN\tN------S2D\tCase=Gen|Definite=Def|Number=Sing\t3\tnmod\t3:nmod:gen\tVform=اَلأَربِعَاءِ|Gloss=Wednesday|Root=r_b_`|Translit=al-ʾarbiʿāʾi|LTranslit=ʾarbiʿāʾ\n5\tالدولية\tدُوَلِيّ\tADJ\tA-----FS1D\tCase=Nom|Definite=Def|Gender=Fem|Number=Sing\t3\tamod\t3:amod\tVform=اَلدُّوَلِيَّةُ|Gloss=international,world|Root=d_w_l|Translit=ad-duwalīyatu|LTranslit=duwalīy\n6-7\tباقامة\t_\t_\t_\t_\t_\t_\t_\t_\n6\tب\tبِ\tADP\tP---------\tAdpType=Prep\t7\tcase\t7:case\tVform=بِ|Gloss=by,with|Root=bi|Translit=bi|LTranslit=bi\n7\tإقامة\tإِقَامَة\tNOUN\tN------S2R\tCase=Gen|Definite=Cons|Number=Sing\t2\tobl\t2:obl:بِ:gen\tVform=إِقَامَةِ|Gloss=residency,setting_up|Root=q_w_m|Translit=ʾiqāmati|LTranslit=ʾiqāmat\n8\t16\t16\tNUM\tQ---------\tNumForm=Digit\t7\tnummod\t7:nummod\tVform=١٦|Translit=16\n9\tمباراة\tمُبَارَاة\tNOUN\tN------S4I\tCase=Acc|Definite=Ind|Number=Sing\t8\tnmod\t8:nmod:acc\tVform=مُبَارَاةً|Gloss=match,game,competition|Root=b_r_y|Translit=mubārātan|LTranslit=mubārāt\n10\tودية\tوُدِّيّ\tADJ\tA-----FS4I\tCase=Acc|Definite=Ind|Gender=Fem|Number=Sing\t9\tamod\t9:amod\tVform=وُدِّيَّةً|Gloss=friendly,amicable|Root=w_d_d|Translit=wuddīyatan|LTranslit=wuddīy\n11\t.\t.\tPUNCT\tG---------\t_\t1\tpunct\t1:punct\tVform=.|Translit=.\n'

def test_augment_space_final_punct():
    if False:
        for i in range(10):
            print('nop')
    doc = read_test_doc(ARABIC_SPACE_AFTER_TEST_CASE)
    doc2 = prepare_tokenizer_treebank.augment_arabic_padt(doc, ratio=1.0)
    expected = doc + read_test_doc(ARABIC_SPACE_AFTER_RESULT)
    assert doc2 == expected
ENGLISH_COMMA_SWAP_TEST_CASE = '\n# sent_id = reviews-086839-0004\n# text = Approx 4 months later, the compressor went out.\n1\tApprox\tapprox\tADV\tRB\t_\t3\tadvmod\t3:advmod\t_\n2\t4\t4\tNUM\tCD\tNumType=Card\t3\tnummod\t3:nummod\t_\n3\tmonths\tmonth\tNOUN\tNNS\tNumber=Plur\t4\tobl:npmod\t4:obl:npmod\t_\n4\tlater\tlate\tADV\tRBR\tDegree=Cmp\t8\tadvmod\t8:advmod\tSpaceAfter=No\n5\t,\t,\tPUNCT\t,\t_\t8\tpunct\t8:punct\t_\n6\tthe\tthe\tDET\tDT\tDefinite=Def|PronType=Art\t7\tdet\t7:det\t_\n7\tcompressor\tcompressor\tNOUN\tNN\tNumber=Sing\t8\tnsubj\t8:nsubj\t_\n8\twent\tgo\tVERB\tVBD\tMood=Ind|Tense=Past|VerbForm=Fin\t0\troot\t0:root\t_\n9\tout\tout\tADP\tRP\t_\t8\tcompound:prt\t8:compound:prt\tSpaceAfter=No\n10\t.\t.\tPUNCT\t.\t_\t8\tpunct\t8:punct\t_\n\n# sent_id = reviews-086839-0004b\n# text = Approx 4 months later , the compressor went out.\n1\tApprox\tapprox\tADV\tRB\t_\t3\tadvmod\t3:advmod\t_\n2\t4\t4\tNUM\tCD\tNumType=Card\t3\tnummod\t3:nummod\t_\n3\tmonths\tmonth\tNOUN\tNNS\tNumber=Plur\t4\tobl:npmod\t4:obl:npmod\t_\n4\tlater\tlate\tADV\tRBR\tDegree=Cmp\t8\tadvmod\t8:advmod\t_\n5\t,\t,\tPUNCT\t,\t_\t8\tpunct\t8:punct\t_\n6\tthe\tthe\tDET\tDT\tDefinite=Def|PronType=Art\t7\tdet\t7:det\t_\n7\tcompressor\tcompressor\tNOUN\tNN\tNumber=Sing\t8\tnsubj\t8:nsubj\t_\n8\twent\tgo\tVERB\tVBD\tMood=Ind|Tense=Past|VerbForm=Fin\t0\troot\t0:root\t_\n9\tout\tout\tADP\tRP\t_\t8\tcompound:prt\t8:compound:prt\tSpaceAfter=No\n10\t.\t.\tPUNCT\t.\t_\t8\tpunct\t8:punct\t_\n'
ENGLISH_COMMA_SWAP_RESULT = '\n# sent_id = reviews-086839-0004\n# text = Approx 4 months later ,the compressor went out.\n1\tApprox\tapprox\tADV\tRB\t_\t3\tadvmod\t3:advmod\t_\n2\t4\t4\tNUM\tCD\tNumType=Card\t3\tnummod\t3:nummod\t_\n3\tmonths\tmonth\tNOUN\tNNS\tNumber=Plur\t4\tobl:npmod\t4:obl:npmod\t_\n4\tlater\tlate\tADV\tRBR\tDegree=Cmp\t8\tadvmod\t8:advmod\t_\n5\t,\t,\tPUNCT\t,\t_\t8\tpunct\t8:punct\tSpaceAfter=No\n6\tthe\tthe\tDET\tDT\tDefinite=Def|PronType=Art\t7\tdet\t7:det\t_\n7\tcompressor\tcompressor\tNOUN\tNN\tNumber=Sing\t8\tnsubj\t8:nsubj\t_\n8\twent\tgo\tVERB\tVBD\tMood=Ind|Tense=Past|VerbForm=Fin\t0\troot\t0:root\t_\n9\tout\tout\tADP\tRP\t_\t8\tcompound:prt\t8:compound:prt\tSpaceAfter=No\n10\t.\t.\tPUNCT\t.\t_\t8\tpunct\t8:punct\t_\n\n# sent_id = reviews-086839-0004b\n# text = Approx 4 months later , the compressor went out.\n1\tApprox\tapprox\tADV\tRB\t_\t3\tadvmod\t3:advmod\t_\n2\t4\t4\tNUM\tCD\tNumType=Card\t3\tnummod\t3:nummod\t_\n3\tmonths\tmonth\tNOUN\tNNS\tNumber=Plur\t4\tobl:npmod\t4:obl:npmod\t_\n4\tlater\tlate\tADV\tRBR\tDegree=Cmp\t8\tadvmod\t8:advmod\t_\n5\t,\t,\tPUNCT\t,\t_\t8\tpunct\t8:punct\t_\n6\tthe\tthe\tDET\tDT\tDefinite=Def|PronType=Art\t7\tdet\t7:det\t_\n7\tcompressor\tcompressor\tNOUN\tNN\tNumber=Sing\t8\tnsubj\t8:nsubj\t_\n8\twent\tgo\tVERB\tVBD\tMood=Ind|Tense=Past|VerbForm=Fin\t0\troot\t0:root\t_\n9\tout\tout\tADP\tRP\t_\t8\tcompound:prt\t8:compound:prt\tSpaceAfter=No\n10\t.\t.\tPUNCT\t.\t_\t8\tpunct\t8:punct\t_\n'

def test_augment_space_final_punct():
    if False:
        return 10
    doc = read_test_doc(ENGLISH_COMMA_SWAP_TEST_CASE)
    doc2 = prepare_tokenizer_treebank.augment_move_comma(doc, ratio=1.0)
    expected = read_test_doc(ENGLISH_COMMA_SWAP_RESULT)
    assert doc2 == expected
COMMA_SEP_TEST_CASE = '\n# text = Fuzzy people, floating people\n1\tFuzzy\tfuzzy\tADJ\tJJ\tDegree=Pos\t2\tamod\t2:amod\t_\n2\tpeople\tpeople\tNOUN\tNNS\tNumber=Plur\t0\troot\t0:root\tSpaceAfter=No\n3\t,\t,\tPUNCT\t,\t_\t2\tpunct\t2:punct\t_\n4\tfloating\tfloat\tVERB\tVBG\tVerbForm=Ger\t5\tamod\t5:amod\t_\n5\tpeople\tpeople\tNOUN\tNNS\tNumber=Plur\t2\tappos\t2:appos\t_\n'
COMMA_SEP_TEST_EXPECTED = '\n# text = Fuzzy people,floating people\n1\tFuzzy\tfuzzy\tADJ\tJJ\tDegree=Pos\t2\tamod\t2:amod\t_\n2\tpeople\tpeople\tNOUN\tNNS\tNumber=Plur\t0\troot\t0:root\tSpaceAfter=No\n3\t,\t,\tPUNCT\t,\t_\t2\tpunct\t2:punct\tSpaceAfter=No\n4\tfloating\tfloat\tVERB\tVBG\tVerbForm=Ger\t5\tamod\t5:amod\t_\n5\tpeople\tpeople\tNOUN\tNNS\tNumber=Plur\t2\tappos\t2:appos\t_\n'

def test_augment_comma_separations():
    if False:
        return 10
    doc = read_test_doc(COMMA_SEP_TEST_CASE)
    doc2 = prepare_tokenizer_treebank.augment_comma_separations(doc, ratio=1.0)
    assert len(doc2) == 2
    expected = read_test_doc(COMMA_SEP_TEST_EXPECTED)
    assert doc2[1] == expected[0]