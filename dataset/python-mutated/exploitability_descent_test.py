"""Tests for open_spiel.python.algorithms.exploitability_descent."""
import numpy as np
import tensorflow.compat.v1 as tf
from open_spiel.python.algorithms import exploitability_descent
import pyspiel
tf.disable_v2_behavior()

class ExploitabilityDescentTest(tf.test.TestCase):

    def test_solver_kuhn_poker_first_10_steps_convergence(self):
        if False:
            while True:
                i = 10
        solver = exploitability_descent.Solver(pyspiel.load_game('kuhn_poker'))
        with self.session() as session:
            session.run(tf.global_variables_initializer())
            nash_conv = [solver.step(session, learning_rate=1.0) for _ in range(11)]
        np.testing.assert_allclose(nash_conv, [0.9166666666666665, 0.6789300480121345, 0.4810914883635474, 0.4006142092325581, 0.3661724216146872, 0.3367699644349956, 0.3092508151239813, 0.28827843035940964, 0.2683004220685875, 0.2441859784679929, 0.22168699344791482])

    def test_solver_leduc_poker_first_10_steps_convergence(self):
        if False:
            while True:
                i = 10
        solver = exploitability_descent.Solver(pyspiel.load_game('leduc_poker'))
        with self.session() as session:
            session.run(tf.global_variables_initializer())
            nash_conv = [solver.step(session, learning_rate=1.0) for _ in range(11)]
        np.testing.assert_allclose(nash_conv, [4.7472224, 4.3147216, 3.9900389, 3.7576618, 3.5771275, 3.4414644, 3.3272073, 3.1898201, 3.1089299, 3.0108435, 2.8992782])
if __name__ == '__main__':
    tf.test.main()