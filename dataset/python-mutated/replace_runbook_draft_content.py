from azure.identity import DefaultAzureCredential
from azure.mgmt.automation import AutomationClient
'\n# PREREQUISITES\n    pip install azure-identity\n    pip install azure-mgmt-automation\n# USAGE\n    python replace_runbook_draft_content.py\n\n    Before run the sample, please set the values of the client ID, tenant ID and client secret\n    of the AAD application as environment variables: AZURE_CLIENT_ID, AZURE_TENANT_ID,\n    AZURE_CLIENT_SECRET. For more info about how to get the value, please see:\n    https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal\n'

def main():
    if False:
        return 10
    client = AutomationClient(credential=DefaultAzureCredential(), subscription_id='subid')
    response = client.runbook_draft.begin_replace_content(resource_group_name='rg', automation_account_name='ContoseAutomationAccount', runbook_name='Get-AzureVMTutorial', runbook_content='<#\n                .DESCRIPTION\n                    An example runbook which prints out the first10 Azure VMs in your subscription (ordered alphabetically).\n                    For more information about how this runbook authenticates to your Azure subscription, see our documentation here: http: //aka.ms/fxu3mn\n\n                .NOTES\n                    AUTHOR: Azure Automation Team\n                    LASTEDIT: Mar27,\n                    2015\n            #>\n            workflow Get-AzureVMTutorial{\n                #The name of the Automation Credential Asset this runbook will use to authenticate to Azure.\n                $CredentialAssetName = \'DefaultAzureCredential\'\n\n                #Get the credential with the above name from the Automation Asset store\n                $Cred = Get-AutomationPSCredential -Name $CredentialAssetName\n                if(!$Cred){\n                    Throw"Could not find an Automation Credential Asset named \'${CredentialAssetName}\'. Make sure you have created one in this Automation Account."\n                        }\n\n                #Connect to your Azure Account\n                $Account = Add-AzureAccount -Credential $Cred\n                if(!$Account){\n                    Throw"Could not authenticate to Azure using the credential asset \'${CredentialAssetName}\'. Make sure the user name and password are correct."\n                        }\n\n                #TODO (optional): pick the right subscription to use. Without this line, the default subscription for your Azure Account will be used.\n                #Select-AzureSubscription -SubscriptionName"TODO: your Azure subscription name here"\n                \n                #Get all the VMs you have in your Azure subscription\n                $VMs = Get-AzureVM\n\n                #Print out up to10 of those VMs\n                if(!$VMs){\n                    Write-Output"No VMs were found in your subscription."\n                        } else{\n                    Write-Output $VMs[0..9\n                            ]\n                        }\n                    }').result()
    print(response)
if __name__ == '__main__':
    main()