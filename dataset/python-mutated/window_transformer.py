"""
Window Transformer
------------------
"""
from typing import Any, List, Mapping, Optional, Union
from darts.dataprocessing.transformers import BaseDataTransformer
from darts.logging import get_logger
from darts.timeseries import TimeSeries
logger = get_logger(__name__)

class WindowTransformer(BaseDataTransformer):

    def __init__(self, transforms: Union[dict, List[dict]], treat_na: Optional[Union[str, Union[int, float]]]=None, forecasting_safe: Optional[bool]=True, keep_non_transformed: Optional[bool]=False, include_current: Optional[bool]=True, name: str='WindowTransformer', n_jobs: int=1, verbose: bool=False):
        if False:
            return 10
        '\n        A transformer that applies window transformation to a TimeSeries or a Sequence of TimeSeries. It expects a\n        dictionary or a list of dictionaries specifying the window transformation(s) to be applied. All series in the\n        sequence will be transformed with the same transformations.\n\n        Parameters\n        ----------\n        transforms\n            A dictionary or a list of dictionaries.\n            Each dictionary specifies a different window transform.\n\n            The dictionaries can contain the following keys:\n\n            :``"function"``: Mandatory. The name of one of the pandas builtin transformation functions,\n                            or a callable function that can be applied to the input series.\n                            Pandas\' functions can be found in the\n                            `documentation <https://pandas.pydata.org/docs/reference/window.html>`_.\n\n            :``"mode"``: Optional. The name of the pandas windowing mode on which the ``"function"`` is going to be\n                        applied. The options are "rolling", "expanding" and "ewm".\n                        If not provided, Darts defaults to "expanding".\n                        User defined functions can use either "rolling" or "expanding" modes.\n                        More information on pandas windowing operations can be found in the `documentation\n                        <https://pandas.pydata.org/pandas-docs/stable/user_guide/window.html>`_.\n\n            :``"components"``: Optional. A string or list of strings specifying the TimeSeries components on which the\n                               transformation should be applied. If not specified, the transformation will be\n                               applied on all components.\n\n            :``"function_name"``: Optional. A string specifying the function name referenced as part of\n                                  the transformation output name. For example, given a user-provided function\n                                  transformation on rolling window size of 5 on the component "comp", the\n                                  default transformation output name is "rolling_udf_5_comp" whereby "udf"\n                                  refers to "user defined function". If specified, the ``"function_name"`` will\n                                  replace the default name "udf". Similarly, the ``"function_name"`` will replace\n                                  the name of the pandas builtin transformation function name in the output name.\n\n            All other dictionary items provided will be treated as keyword arguments for the windowing mode\n            (i.e., ``rolling/ewm/expanding``) or for the specific function\n            in that mode (i.e., ``pandas.DataFrame.rolling.mean/std/max/min...`` or\n            ``pandas.DataFrame.ewm.mean/std/sum``).\n            This allows for more flexibility in configuring the transformation, by providing for\n            example:\n\n            * :``"window"``: Size of the moving window for the "rolling" mode.\n                            If an integer, the fixed number of observations used for each window.\n                            If an offset, the time period of each window with data type :class:`pandas.Timedelta`\n                            representing a fixed duration.\n            * :``"min_periods"``: The minimum number of observations in the window required to have a value (otherwise\n                NaN). Darts reuses pandas defaults of 1 for "rolling" and "expanding" modes and of 0 for "ewm" mode.\n            * :``"win_type"``: The type of weigthing to apply to the window elements.\n                If provided, it should be one of `scipy.signal.windows\n                <https://docs.scipy.org/doc/scipy/reference/signal.windows.html#module-scipy.signal.windows>`_.\n            * :``"center"``: ``True``/``False`` to set the observation at the current timestep at the center of the\n                window (when ``forecasting_safe`` is `True`, Darts enforces ``"center"`` to ``False``).\n            * :``"closed"``: ``"right"``/``"left"``/``"both"``/``"neither"`` to specify whether the right,\n                left or both ends of the window are included in the window, or neither of them.\n                Darts defaults to ``"both"``.\n\n            More information on the available functions and their parameters can be found in the\n            `Pandas documentation <https://pandas.pydata.org/docs/reference/window.html>`_.\n\n            For user-provided functions, extra keyword arguments in the transformation dictionary are passed to the\n            user-defined function.\n            By default, Darts expects user-defined functions to receive numpy arrays as input.\n            This can be modified by adding item ``"raw": False`` in the transformation dictionary.\n            It is expected that the function returns a single\n            value for each window. Other possible configurations can be found in the\n            `pandas.DataFrame.rolling().apply() documentation\n            <https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rolling.html>`_\n            and `pandas.DataFrame.expanding().apply() documentation\n            <https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.expanding.html>`_.\n\n        treat_na\n            Specifies how to treat missing values that were added by the window transformations\n            at the beginning of the resulting TimeSeries. By default, Darts will leave NaNs in the resulting TimeSeries.\n            This parameter can be one of the following:\n\n            * :``"dropna"``: to truncate the TimeSeries and drop time steps containing missing values.\n                If multiple columns contain different numbers of missing values, only the minimum number\n                of rows is dropped. This operation might reduce the length of the resulting TimeSeries.\n\n            * :``"bfill"`` or ``"backfill"``: to specify that NaNs should be filled with the last transformed\n                and valid observation. If the original TimeSeries starts with NaNs, those are kept.\n                When ``forecasting_safe`` is ``True``, this option returns an exception to avoid future observation\n                contaminating the past.\n\n            * :an integer or float: in which case NaNs will be filled with this value.\n                All columns will be filled with the same provided value.\n\n        forecasting_safe\n            If True, Darts enforces that the resulting TimeSeries is safe to be used in forecasting models as target\n            or as feature. The window transformation will not allow future values to be included in the computations\n            at their corresponding current timestep. Default is ``True``.\n            "ewm" and "expanding" modes are forecasting safe by default.\n            "rolling" mode is forecasting safe if ``"center": False`` is guaranteed.\n\n        keep_non_transformed\n            ``False`` to return the transformed components only, ``True`` to return all original components along\n            the transformed ones. Default is ``False``.\n\n        include_current\n            ``True`` to include the current time step in the window, ``False`` to exclude it. Default is ``True``.\n\n        name\n            A specific name for the transformer.\n\n        n_jobs\n            The number of jobs to run in parallel. Parallel jobs are created only when a ``Sequence[TimeSeries]`` is\n            passed as input to a method, parallelising operations regarding different ``TimeSeries``. Defaults to `1`.\n\n        verbose\n            Whether to print operations progress.\n        '
        self.transforms = transforms
        self.keep_non_transformed = keep_non_transformed
        self.treat_na = treat_na
        self.forecasting_safe = forecasting_safe
        self.include_current = include_current
        super().__init__(name, n_jobs, verbose)

    @staticmethod
    def ts_transform(series: TimeSeries, params: Mapping[str, Any]) -> TimeSeries:
        if False:
            return 10
        return series.window_transform(**params['fixed'])