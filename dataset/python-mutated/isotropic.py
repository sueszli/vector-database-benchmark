"""
Binary morphological operations
"""
import numpy as np
from scipy import ndimage as ndi

def isotropic_erosion(image, radius, out=None, spacing=None):
    if False:
        print('Hello World!')
    'Return binary morphological erosion of an image.\n\n    This function returns the same result as :func:`skimage.morphology.binary_erosion`\n    but performs faster for large circular structuring elements.\n    This works by applying a threshold to the exact Euclidean distance map\n    of the image [1]_, [2]_.\n    The implementation is based on: func:`scipy.ndimage.distance_transform_edt`.\n\n    Parameters\n    ----------\n    image : ndarray\n        Binary input image.\n    radius : float\n        The radius by which regions should be eroded.\n    out : ndarray of bool, optional\n        The array to store the result of the morphology. If None,\n        a new array will be allocated.\n    spacing : float, or sequence of float, optional\n        Spacing of elements along each dimension.\n        If a sequence, must be of length equal to the input\'s dimension (number of axes).\n        If a single number, this value is used for all axes.\n        If not specified, a grid spacing of unity is implied.\n\n    Returns\n    -------\n    eroded : ndarray of bool\n        The result of the morphological erosion taking values in\n        ``[False, True]``.\n\n    References\n    ----------\n    .. [1] Cuisenaire, O. and Macq, B., "Fast Euclidean morphological operators\n        using local distance transformation by propagation, and applications,"\n        Image Processing And Its Applications, 1999. Seventh International\n        Conference on (Conf. Publ. No. 465), 1999, pp. 856-860 vol.2.\n        :DOI:`10.1049/cp:19990446`\n\n    .. [2] Ingemar Ragnemalm, Fast erosion and dilation by contour processing\n        and thresholding of distance maps, Pattern Recognition Letters,\n        Volume 13, Issue 3, 1992, Pages 161-166.\n        :DOI:`10.1016/0167-8655(92)90055-5`\n    '
    dist = ndi.distance_transform_edt(image, sampling=spacing)
    return np.greater(dist, radius, out=out)

def isotropic_dilation(image, radius, out=None, spacing=None):
    if False:
        i = 10
        return i + 15
    'Return binary morphological dilation of an image.\n\n    This function returns the same result as :func:`skimage.morphology.binary_dilation`\n    but performs faster for large circular structuring elements.\n    This works by applying a threshold to the exact Euclidean distance map\n    of the inverted image [1]_, [2]_.\n    The implementation is based on: func:`scipy.ndimage.distance_transform_edt`.\n\n    Parameters\n    ----------\n    image : ndarray\n        Binary input image.\n    radius : float\n        The radius by which regions should be dilated.\n    out : ndarray of bool, optional\n        The array to store the result of the morphology. If None is\n        passed, a new array will be allocated.\n    spacing : float, or sequence of float, optional\n        Spacing of elements along each dimension.\n        If a sequence, must be of length equal to the input\'s dimension (number of axes).\n        If a single number, this value is used for all axes.\n        If not specified, a grid spacing of unity is implied.\n\n    Returns\n    -------\n    dilated : ndarray of bool\n        The result of the morphological dilation with values in\n        ``[False, True]``.\n\n    References\n    ----------\n    .. [1] Cuisenaire, O. and Macq, B., "Fast Euclidean morphological operators\n        using local distance transformation by propagation, and applications,"\n        Image Processing And Its Applications, 1999. Seventh International\n        Conference on (Conf. Publ. No. 465), 1999, pp. 856-860 vol.2.\n        :DOI:`10.1049/cp:19990446`\n\n    .. [2] Ingemar Ragnemalm, Fast erosion and dilation by contour processing\n        and thresholding of distance maps, Pattern Recognition Letters,\n        Volume 13, Issue 3, 1992, Pages 161-166.\n        :DOI:`10.1016/0167-8655(92)90055-5`\n    '
    dist = ndi.distance_transform_edt(np.logical_not(image), sampling=spacing)
    return np.less_equal(dist, radius, out=out)

def isotropic_opening(image, radius, out=None, spacing=None):
    if False:
        i = 10
        return i + 15
    'Return binary morphological opening of an image.\n\n    This function returns the same result as :func:`skimage.morphology.binary_opening`\n    but performs faster for large circular structuring elements.\n    This works by thresholding the exact Euclidean distance map [1]_, [2]_.\n    The implementation is based on: func:`scipy.ndimage.distance_transform_edt`.\n\n    Parameters\n    ----------\n    image : ndarray\n        Binary input image.\n    radius : float\n        The radius with which the regions should be opened.\n    out : ndarray of bool, optional\n        The array to store the result of the morphology. If None\n        is passed, a new array will be allocated.\n    spacing : float, or sequence of float, optional\n        Spacing of elements along each dimension.\n        If a sequence, must be of length equal to the input\'s dimension (number of axes).\n        If a single number, this value is used for all axes.\n        If not specified, a grid spacing of unity is implied.\n\n    Returns\n    -------\n    opened : ndarray of bool\n        The result of the morphological opening.\n\n    References\n    ----------\n    .. [1] Cuisenaire, O. and Macq, B., "Fast Euclidean morphological operators\n        using local distance transformation by propagation, and applications,"\n        Image Processing And Its Applications, 1999. Seventh International\n        Conference on (Conf. Publ. No. 465), 1999, pp. 856-860 vol.2.\n        :DOI:`10.1049/cp:19990446`\n\n    .. [2] Ingemar Ragnemalm, Fast erosion and dilation by contour processing\n        and thresholding of distance maps, Pattern Recognition Letters,\n        Volume 13, Issue 3, 1992, Pages 161-166.\n        :DOI:`10.1016/0167-8655(92)90055-5`\n    '
    eroded = isotropic_erosion(image, radius, out=out, spacing=spacing)
    return isotropic_dilation(eroded, radius, out=out, spacing=spacing)

def isotropic_closing(image, radius, out=None, spacing=None):
    if False:
        while True:
            i = 10
    'Return binary morphological closing of an image.\n\n    This function returns the same result as binary :func:`skimage.morphology.binary_closing`\n    but performs faster for large circular structuring elements.\n    This works by thresholding the exact Euclidean distance map [1]_, [2]_.\n    The implementation is based on: func:`scipy.ndimage.distance_transform_edt`.\n\n    Parameters\n    ----------\n    image : ndarray\n        Binary input image.\n    radius : float\n        The radius with which the regions should be closed.\n    out : ndarray of bool, optional\n        The array to store the result of the morphology. If None,\n        is passed, a new array will be allocated.\n    spacing : float, or sequence of float, optional\n        Spacing of elements along each dimension.\n        If a sequence, must be of length equal to the input\'s dimension (number of axes).\n        If a single number, this value is used for all axes.\n        If not specified, a grid spacing of unity is implied.\n\n    Returns\n    -------\n    closed : ndarray of bool\n        The result of the morphological closing.\n\n    References\n    ----------\n    .. [1] Cuisenaire, O. and Macq, B., "Fast Euclidean morphological operators\n        using local distance transformation by propagation, and applications,"\n        Image Processing And Its Applications, 1999. Seventh International\n        Conference on (Conf. Publ. No. 465), 1999, pp. 856-860 vol.2.\n        :DOI:`10.1049/cp:19990446`\n\n    .. [2] Ingemar Ragnemalm, Fast erosion and dilation by contour processing\n        and thresholding of distance maps, Pattern Recognition Letters,\n        Volume 13, Issue 3, 1992, Pages 161-166.\n        :DOI:`10.1016/0167-8655(92)90055-5`\n    '
    dilated = isotropic_dilation(image, radius, out=out, spacing=spacing)
    return isotropic_erosion(dilated, radius, out=out, spacing=spacing)